$(function(){var d=new BuildingData();var c=new SetDetail();c.setTitle(d.name,d.dadd);c.setName(d.name);c.setPrice(d.price);c.setAdd(d.dadd);c.setSize(d.size);c.setBackground(d.pic);c.setDescription(d.desc);c.setUnits(d.units.length,d.units);c.setMap(d);c.setImages(d.images.length,d.images);bindImgClicked()});function BuildingData(){var b=initData();this.id=b.bid;this.data=b.bData;this.name=b.bData.dog_name;this.district=getDistrict(b.bData.dog_district);this.area=b.bData.dog_area;this.add=b.bData.dog_add;this.dadd=this.district+"-"+this.area+"-"+this.add;this.pos=b.bData.dog_pos.split("|");this.size=b.bData.dog_size.split("|").join("-");this.price=b.bData.dog_price.split("|").join("-");this.pic=b.bData.dog_pic;this.desc=b.bData.dog_desc;this.images_num=b.bData.pic_num;this.images=getImages(this.id);this.units_num=b.bData.units_num;this.units=getUnits(this.id)}function UnitData(b){this.name=b.unit_name;this.id=b.unit_id;this.price=b.unit_price;this.size=b.unit_size;this.pic=b.unit_pic;this.deco=b.unit_deco}function ImageData(b){this.name=b.image_name;this.url=b.image_url}function initData(){var b=getBID();return{bid:b,bData:getData(b)}}function getBID(){var f=parseURL(location.href);var d=f.params;var e=d.id;return e}function getData(e){var f={};var d=$.ajax("http://api.mzapp.info/item",{method:"GET",async:false,data:{protocol:"json",id:e}});d.complete(function(b){var a=b.responseText;f=$.parseJSON(a);if(f.status!=="success"){alert("获取数据失败: "+f.error_info);window.location.href=location.origin+"/list";return}});return f.overview}function getUnits(e){var f={};var d=$.ajax("http://api.mzapp.info/item/units",{method:"GET",async:false,data:{protocol:"json",id:e}});d.complete(function(b){var a=b.responseText;f=$.parseJSON(a)});return f.overview}function getImages(e){var f={};var d=$.ajax("http://api.mzapp.info/item/images",{method:"GET",async:false,data:{protocol:"json",id:e}});d.complete(function(b){var a=b.responseText;f=$.parseJSON(a)});return f.overview}function getDistrict(d,e){var f;if(e===1){switch(d){case"上城区":f="310002";break;case"下城区":f="310006";break;case"江干区":f="310016";break;case"310011":f="拱墅区";break;case"西湖区":f="310013";break;case"滨江区":f="310051";break;case"萧山区":f="311201";break;case"余杭区":f="311100";break;default:f="0";break}}else{switch(d){case"310002":f="上城区";break;case"310006":f="下城区";break;case"310016":f="江干区";break;case"310011":f="拱墅区";break;case"310013":f="西湖区";break;case"310051":f="滨江区";break;case"311201":f="萧山区";break;case"311100":f="余杭区";break;default:f="杭州市";break}}return f}function SetDetail(){this.setTitle=function(d,c){$("title").text(d+" | "+c+" | "+$("title").text())};this.setName=function(b){$(".ye-detail .segament .intro-wrapper .intro.title h1 span.bname").text(b);$(".ye-detail .appointment .form#building_name span").text(b)};this.setPrice=function(b){$(".ye-detail .segament .intro-wrapper .intro.info h1 span").text(b)};this.setAdd=function(b){$(".ye-detail .segament .intro-wrapper .intro.title h2").text(b)};this.setSize=function(b){$(".ye-detail .segament .intro-wrapper .intro.info h2 span").text(b)};this.setBackground=function(b){$(".ye-detail .segament").css("background-image","url("+b+")");$(".ye-detail .appointment .appointment-preview").css("background-image","url("+b+")")};this.setDescription=function(b){$(".ye-detail .detail-desc .desc-content").html(b)};this.setMap=function(b){initMap(b.pos[0],b.pos[1],b)};this.setUnits=function(l,i){$(".ye-detail .detail-units .detail-title h2 span").text(l);for(var k=0;k<=l-1;k++){var h=i[k];var j=new UnitData(h);var g="<li class='row'><ul>";g+="<li><span>"+j.name+"</span></li>";g+="<li><span>"+j.size+"</span> 平方米</li>";g+="<li><span>"+j.price+"</span> 元/天/平方米</li>";g+="<li>"+j.deco+"</li>";g+="<li><span><img src='"+j.pic+"'></span></li>";g+="</ul></li>";$(".ye-detail .detail-units .units-list .col").append(g)}resetUnitsListUI()};this.setImages=function(g,j){if(g==0){var i="<div class='no-img'>";i+="<div class='no-img-content'>";i+="<p>暂无图片</p>";i+="</div></div>";$($(".ye-detail .detail-img .img-list").parent()).html(i)}else{for(var l=0;l<=g-1;l++){var h=j[l];var k=new ImageData(h);var i="<div class='ui segment'>";i+="<div class='ui bottom attached label'>"+k.name+"</div>";i+="<img class='ui image' src='"+k.url+"'>";i+="</div>";$(".ye-detail .detail-img .img-list .images").append(i)}}}};