$(function(){var a=new BuildingData();var b=new SetDetail();b.setTitle(a.name,a.dadd);b.setName(a.name);b.setPrice(a.price);b.setAdd(a.dadd);b.setSize(a.size);b.setBackground(a.pic);b.setDescription(a.desc);b.setUnits(a.units.length,a.units);b.setMap(a);b.setImages(a.images.length,a.images);bindImgClicked()});function BuildingData(){var a=initData();this.id=a.bid;this.data=a.bData;this.name=a.bData.dog_name;this.district=getDistrict(a.bData.dog_district);this.area=a.bData.dog_area;this.add=a.bData.dog_add;this.dadd=this.district+"-"+this.area+"-"+this.add;this.pos=a.bData.dog_pos.split("|");this.size=a.bData.dog_size.split("|").join("-");this.price=a.bData.dog_price.split("|").join("-");this.pic=a.bData.dog_pic;this.desc=a.bData.dog_desc;this.images_num=a.bData.pic_num;this.images=getImages(this.id);this.units_num=a.bData.units_num;this.units=getUnits(this.id)}function UnitData(a){this.name=a.unit_name;this.id=a.unit_id;this.price=a.unit_price;this.size=a.unit_size;this.pic=a.unit_pic;this.deco=a.unit_deco}function ImageData(a){this.name=a.image_name;this.url=a.image_url}function initData(){var a=getBID();return{bid:a,bData:getData(a)}}function getBID(){var c=parseURL(location.href);var b=c.params;var a=b.id;return a}function getData(a){var c={};var b=$.ajax("http://api.dev.mzapp.info/item",{method:"GET",async:false,data:{protocol:"json",id:a}});b.complete(function(d){var e=d.responseText;c=$.parseJSON(e);if(c.status!=="success"){alert("获取数据失败: "+c.error_info);window.location.href=location.origin+"/list";return}});return c.overview}function getUnits(a){var c={};var b=$.ajax("http://api.dev.mzapp.info/item/units",{method:"GET",async:false,data:{protocol:"json",id:a}});b.complete(function(d){var e=d.responseText;c=$.parseJSON(e)});return c.overview}function getImages(a){var c={};var b=$.ajax("http://api.dev.mzapp.info/item/images",{method:"GET",async:false,data:{protocol:"json",id:a}});b.complete(function(d){var e=d.responseText;c=$.parseJSON(e)});return c.overview}function getDistrict(b,a){var c;if(a===1){switch(b){case"上城区":c="310002";break;case"下城区":c="310006";break;case"江干区":c="310016";break;case"310011":c="拱墅区";break;case"西湖区":c="310013";break;case"滨江区":c="310051";break;case"萧山区":c="311201";break;case"余杭区":c="311100";break;default:c="0";break}}else{switch(b){case"310002":c="上城区";break;case"310006":c="下城区";break;case"310016":c="江干区";break;case"310011":c="拱墅区";break;case"310013":c="西湖区";break;case"310051":c="滨江区";break;case"311201":c="萧山区";break;case"311100":c="余杭区";break;default:c="杭州市";break}}return c}function SetDetail(){this.setTitle=function(a,b){$("title").text(a+" | "+b+" | "+$("title").text())};this.setName=function(a){$(".ye-detail .segament .intro-wrapper .intro.title h1 span.bname").text(a);$(".ye-detail .appointment .form#building_name span").text(a)};this.setPrice=function(a){$(".ye-detail .segament .intro-wrapper .intro.info h1 span").text(a)};this.setAdd=function(a){$(".ye-detail .segament .intro-wrapper .intro.title h2").text(a)};this.setSize=function(a){$(".ye-detail .segament .intro-wrapper .intro.info h2 span").text(a)};this.setBackground=function(a){$(".ye-detail .segament").css("background-image","url("+a+")");$(".ye-detail .appointment .appointment-preview").css("background-image","url("+a+")")};this.setDescription=function(a){$(".ye-detail .detail-desc .desc-content").html(a)};this.setMap=function(a){initMap(a.pos[0],a.pos[1],a)};this.setUnits=function(c,f){$(".ye-detail .detail-units .detail-title h2 span").text(c);for(var d=0;d<=c-1;d++){var a=f[d];var e=new UnitData(a);var b="<li class='row'><ul>";b+="<li><span>"+e.name+"</span></li>";b+="<li><span>"+e.size+"</span> 平方米</li>";b+="<li><span>"+e.price+"</span> 元/天/平方米</li>";b+="<li>"+e.deco+"</li>";b+="<li><span><img src='"+e.pic+"'></span></li>";b+="</ul></li>";$(".ye-detail .detail-units .units-list .col").append(b)}resetUnitsListUI()};this.setImages=function(b,e){if(b==0){var f="<div class='no-img'>";f+="<div class='no-img-content'>";f+="<p>暂无图片</p>";f+="</div></div>";$($(".ye-detail .detail-img .img-list").parent()).html(f)}else{for(var c=0;c<=b-1;c++){var a=e[c];var d=new ImageData(a);var f="<div class='ui segment'>";f+="<div class='ui bottom attached label'>"+d.name+"</div>";f+="<img class='ui image' src='"+d.url+"'>";f+="</div>";$(".ye-detail .detail-img .img-list .images").append(f)}}}};