function userExisted(d){var c=$.ajax(location.origin+"/api/appointuser/userLogin?protocol=json",{method:"POST",async:false,data:{uid:d}});c.complete(function(b){var a=$.parseJSON(b.responseText);if(a.status==="success"){loginSuccess(d)}else{alert("暂时无法登陆,请重试");window.location.reload()}})}function userNotExisted(b){$("#register-male").dropdown();$("#team-size").dropdown();$("#register-team-type .ui.checkbox").checkbox({onChecked:function(){$("#appointment-register .personal").hide();$("#appointment-register .team").show();$("#appointment-register .selection").removeClass("selected");$($("#appointment-register .selection")[2]).addClass("selected")},onUnchecked:function(){$("#appointment-register .team").hide();$("#appointment-register .personal").show();$("#appointment-register .selection").removeClass("selected");$($("#appointment-register .selection")[1]).addClass("selected")}});$("#register-extracts select").dropdown({direction:"upward"});$("#register-emailsupport .ui.checkbox").checkbox();$("#register-agreement .ui.checkbox").checkbox();$("#register-phone input").val(b);$("#appointment-register").modal("setting","closable",false).modal("show");$("#appointment-register .actions .cancel.button").click(function(){window.location.reload()});$("#appointment-register .actions .primary.button").click(function(){var d=registerData();if(dataCheck(d)){var a=dataSend(d);if(a.status==="success"){$("#appointment-register").modal("hide");userExisted(a.overview.uid)}else{registerFailed(a.overview.uid);alert("注册失败,"+a.error_info);location.reload()}}})}function registerData(){return{phone:$("#register-phone input").val(),personal:{name:userName.name,title:userName.title},contacts:{email:$($("#register-contacts input")[0]).val(),phone:$($("#register-contacts input")[1]).val()},team:{team:(($("#register-team-type .ui.checkbox").checkbox("is checked"))?"yes":"no"),info:(($("#register-team-type .ui.checkbox").checkbox("is checked"))?{size:$("#team-size").dropdown("get value")[0]}:{})},extract:{district:$($("#register-extracts input")[0]).val(),address:$($("#register-extracts input")[1]).val()},selection:{ads:(($("#register-emailsupport .ui.checkbox").checkbox("is checked"))?"yes":"no"),agreement:$("#register-agreement .ui.checkbox").checkbox("is checked")}}}function dataCheck(b){if(b.personal.name==""||b.personal.title==""){alert("必须填写名字以及称谓");return false}if(b.contacts.email==""){alert("邮箱为必填项");return false}if(b.selection.agreement===false){alert("请同意许可协议");return false}if(b.team.info!=""&&b.team.info.size==""){alert("您选择了团队创业,请选择当前团队规模")}return true}function dataSend(f){var e;var d=$.ajax("http://api.mzapp.info/appointuser/userSave?protocol=json",{method:"POST",async:false,data:f});d.complete(function(a){e=$.parseJSON(a.responseText)});return e}var userName={name:"",title:""};function nameChaned(d,c){switch(c){case 1:userName.name=d;break;case 2:userName.title=d;break}if(userName.name!==""){$("#appointment-register .header span").text(" "+userName.name+userName.title+" ")}}function registerFailed(c){var d=$.ajax("http://api.mzapp.info/appointuser/registerFailed?protocol=json",{method:"POST",async:false,data:{id:c}});d.complete(function(){});return true}function logout(){var b=$.ajax("http://api.mzapp.info/appointuser/userLogout",{method:"GET",async:false,data:{protocol:"json"}});b.complete(function(){location.reload()});return true}function setAppointmentUserInfo(i){if(!getAppointStatus(i)){$("#appoint_info .field").hide();$("#appoint_info .field.appoint.loading").show();var h=getUserInfo(i);console.log(h);$("#appoint_info .field.appoint.id label span").text(h.user_id);$("#appoint_info .field.appoint.user label span").text(h.user_name);$("#appoint_info .field.appoint.address label span").text(h.extract_district+" "+h.extract_address);$($("#appoint_info .field.appoint.contacts label span")[0]).text(h.user_phone);$($("#appoint_info .field.appoint.contacts label span")[1]).text(h.contacts_email);(h.contacts_phone)?($($("#appoint_info .field.appoint.contacts label span")[2]).text(h.contacts_phone)):($($("#appoint_info .field.appoint.contacts label span")[2]).hide());var f=getDate();console.log(f);var g="";for(var j=0;j<7;j++){g+="<div class='item' value='"+f[j]+"'>"+f[j]+"号</div>"}g+="<div class='item' value='0'>其他</div>";$("#data-select .menu").html(g);$("#data-select").dropdown({onChange:function(a){dataSelected(a)},direction:"upward"}).dropdown("set selected",f[0]+"号");$("#time-select").dropdown("set selected","上午").dropdown({direction:"upward"});$("#appoint_info .field").show();$("#appoint_info .field.appoint.loading").hide();$("#appoint_info .field.appoint.appointed").hide()}}function getUserInfo(e){var f;var d=$.ajax("http://api.mzapp.info/appointuser/userInfo",{method:"GET",async:false,data:{id:e,protocol:"json"}});d.complete(function(a){f=$.parseJSON(a.responseText);if(f.status==="success"){f=f.overview}else{alert("用户信息获取失败,请重新登录");logout()}});return f}function getDate(){var h=new Date();var f=new Array();for(var g=0;g<7;g++){var e=new Date();e.setDate((h.getDate()+(g+1)));f[g]=e.getDate()}return f}function dataSelected(b){console.log(b);if(b==="其他"){$("#time-select .menu").html("<div class='item' value='待定'>待定</div>");$("#time-select").dropdown("set selected","待定").dropdown({direction:"upward"})}else{$("#time-select .menu").html("<div class='item' value='上午'>上午</div><div class = 'item'>下午</div><div class ='item'>晚上</div><div class='ui divider'></div><div class ='item'>待定</div>");$("#time-select").dropdown("set selected","上午").dropdown({direction:"upward"})}};