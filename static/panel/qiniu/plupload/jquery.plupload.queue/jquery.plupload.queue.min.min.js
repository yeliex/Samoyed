(function(j,h){var i={};function g(a){return plupload.translate(a)||a}function f(a,b){b.contents().each(function(d,c){c=j(c);if(!c.is(".plupload")){c.remove()}});b.prepend('<div class="plupload_wrapper plupload_scroll"><div id="'+a+'_container" class="plupload_container"><div class="plupload"><div class="plupload_header"><div class="plupload_header_content"><div class="plupload_header_title">'+g("Select files")+'</div><div class="plupload_header_text">'+g("Add files to the upload queue and click the start button.")+'</div></div></div><div class="plupload_content"><div class="plupload_filelist_header"><div class="plupload_file_name">'+g("Filename")+'</div><div class="plupload_file_action">&nbsp;</div><div class="plupload_file_status"><span>'+g("Status")+'</span></div><div class="plupload_file_size">'+g("Size")+'</div><div class="plupload_clearer">&nbsp;</div></div><ul id="'+a+'_filelist" class="plupload_filelist"></ul><div class="plupload_filelist_footer"><div class="plupload_file_name"><div class="plupload_buttons"><a href="#" class="plupload_button plupload_add" id="'+a+'_browse">'+g("Add Files")+'</a><a href="#" class="plupload_button plupload_start">'+g("Start Upload")+'</a></div><span class="plupload_upload_status"></span></div><div class="plupload_file_action"></div><div class="plupload_file_status"><span class="plupload_total_status">0%</span></div><div class="plupload_file_size"><span class="plupload_total_file_size">0 b</span></div><div class="plupload_progress"><div class="plupload_progress_container"><div class="plupload_progress_bar"></div></div></div><div class="plupload_clearer">&nbsp;</div></div></div></div></div><input type="hidden" id="'+a+'_count" name="'+a+'_count" value="0" /></div>')}j.fn.pluploadQueue=function(a){if(a){this.each(function(){var b,c,r,p;c=j(this);r=c.attr("id");if(!r){r=plupload.guid();c.attr("id",r)}p=c.html();f(r,c);a=j.extend({dragdrop:true,browse_button:r+"_browse",container:r},a);if(a.dragdrop){a.drop_element=r+"_filelist"}b=new plupload.Uploader(a);i[r]=b;function d(m){var k;if(m.status==plupload.DONE){k="plupload_done"}if(m.status==plupload.FAILED){k="plupload_failed"}if(m.status==plupload.QUEUED){k="plupload_delete"}if(m.status==plupload.UPLOADING){k="plupload_uploading"}var l=j("#"+m.id).attr("class",k).find("a").css("display","block");if(m.hint){l.attr("title",m.hint)}}function q(){j("span.plupload_total_status",c).html(b.total.percent+"%");j("div.plupload_progress_bar",c).css("width",b.total.percent+"%");j("span.plupload_upload_status",c).html(h.sprintf(g("Uploaded %d/%d files"),b.total.uploaded,b.files.length))}function o(){var l=j("ul.plupload_filelist",c).html(""),k=0,m;j.each(b.files,function(n,t){m="";if(t.status==plupload.DONE){if(t.target_name){m+='<input type="hidden" name="'+r+"_"+k+'_tmpname" value="'+plupload.xmlEncode(t.target_name)+'" />'}m+='<input type="hidden" name="'+r+"_"+k+'_name" value="'+plupload.xmlEncode(t.name)+'" />';m+='<input type="hidden" name="'+r+"_"+k+'_status" value="'+(t.status==plupload.DONE?"done":"failed")+'" />';k++;j("#"+r+"_count").val(k)}l.append('<li id="'+t.id+'"><div class="plupload_file_name"><span>'+t.name+'</span></div><div class="plupload_file_action"><a href="#"></a></div><div class="plupload_file_status">'+t.percent+'%</div><div class="plupload_file_size">'+plupload.formatSize(t.size)+'</div><div class="plupload_clearer">&nbsp;</div>'+m+"</li>");d(t);j("#"+t.id+".plupload_delete a").click(function(s){j("#"+t.id).remove();b.removeFile(t);s.preventDefault()})});j("span.plupload_total_file_size",c).html(plupload.formatSize(b.total.size));if(b.total.queued===0){j("span.plupload_add_text",c).html(g("Add Files"))}else{j("span.plupload_add_text",c).html(h.sprintf(g("%d files queued"),b.total.queued))}j("a.plupload_start",c).toggleClass("plupload_disabled",b.files.length==(b.total.uploaded+b.total.failed));l[0].scrollTop=l[0].scrollHeight;q();if(!b.files.length&&b.features.dragdrop&&b.settings.dragdrop){j("#"+r+"_filelist").append('<li class="plupload_droptext">'+g("Drag files here.")+"</li>")}}function e(){delete i[r];b.destroy();c.html(p);b=c=p=null}b.bind("UploadFile",function(l,k){j("#"+k.id).addClass("plupload_current_file")});b.bind("Init",function(l,k){if(!a.unique_names&&a.rename){c.on("click","#"+r+"_filelist div.plupload_file_name span",function(m){var w=j(m.target),y,n,z,x="";y=l.getFile(w.parents("li")[0].id);z=y.name;n=/^(.+)(\.[^.]+)$/.exec(z);if(n){z=n[1];x=n[2]}w.hide().after('<input type="text" />');w.next().val(z).focus().blur(function(){w.show().next().remove()}).keydown(function(s){var t=j(this);if(s.keyCode==13){s.preventDefault();y.name=t.val()+x;w.html(y.name);t.blur()}})})}j("#"+r+"_container").attr("title","Using runtime: "+k.runtime);j("a.plupload_start",c).click(function(m){if(!j(this).hasClass("plupload_disabled")){b.start()}m.preventDefault()});j("a.plupload_stop",c).click(function(m){m.preventDefault();b.stop()});j("a.plupload_start",c).addClass("plupload_disabled")});b.bind("Error",function(n,k){var m=k.file,l;if(m){l=k.message;if(k.details){l+=" ("+k.details+")"}if(k.code==plupload.FILE_SIZE_ERROR){alert(g("Error: File too large:")+" "+m.name)}if(k.code==plupload.FILE_EXTENSION_ERROR){alert(g("Error: Invalid file extension:")+" "+m.name)}m.hint=l;j("#"+m.id).attr("class","plupload_failed").find("a").css("display","block").attr("title",l)}if(k.code===plupload.INIT_ERROR){setTimeout(function(){e()},1)}});b.bind("PostInit",function(k){if(k.settings.dragdrop&&k.features.dragdrop){j("#"+r+"_filelist").append('<li class="plupload_droptext">'+g("Drag files here.")+"</li>")}});b.init();b.bind("StateChanged",function(){if(b.state===plupload.STARTED){j("li.plupload_delete a,div.plupload_buttons",c).hide();b.disableBrowse(true);j("span.plupload_upload_status,div.plupload_progress,a.plupload_stop",c).css("display","block");j("span.plupload_upload_status",c).html("Uploaded "+b.total.uploaded+"/"+b.files.length+" files");if(a.multiple_queues){j("span.plupload_total_status,span.plupload_total_file_size",c).show()}}else{o();j("a.plupload_stop,div.plupload_progress",c).hide();j("a.plupload_delete",c).css("display","block");if(a.multiple_queues&&b.total.uploaded+b.total.failed==b.files.length){j(".plupload_buttons,.plupload_upload_status",c).css("display","inline");b.disableBrowse(false);j(".plupload_start",c).addClass("plupload_disabled");j("span.plupload_total_status,span.plupload_total_file_size",c).hide()}}});b.bind("FilesAdded",o);b.bind("FilesRemoved",function(){var k=j("#"+r+"_filelist").scrollTop();o();j("#"+r+"_filelist").scrollTop(k)});b.bind("FileUploaded",function(l,k){d(k)});b.bind("UploadProgress",function(l,k){j("#"+k.id+" div.plupload_file_status",c).html(k.percent+"%");d(k);q()});if(a.setup){a.setup(b)}});return this}else{return i[j(this[0]).attr("id")]}}})(jQuery,mOxie);