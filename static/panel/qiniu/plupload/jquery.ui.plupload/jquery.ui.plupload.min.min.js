(function(g,c,j,f,b){function h(i){return j.translate(i)||i}function a(i){i.id=i.attr("id"),i.html('<div class="plupload_wrapper"><div class="ui-widget-content plupload_container"><div class="ui-state-default ui-widget-header plupload_header"><div class="plupload_header_content"><div class="plupload_logo"> </div><div class="plupload_header_title">'+h("Select files")+'</div><div class="plupload_header_text">'+h("Add files to the upload queue and click the start button.")+'</div><div class="plupload_view_switch"><input type="radio" id="'+i.id+'_view_list" name="view_mode_'+i.id+'" checked="checked" /><label class="plupload_button" for="'+i.id+'_view_list" data-view="list">'+h("List")+'</label><input type="radio" id="'+i.id+'_view_thumbs" name="view_mode_'+i.id+'" /><label class="plupload_button"  for="'+i.id+'_view_thumbs" data-view="thumbs">'+h("Thumbnails")+'</label></div></div></div><table class="plupload_filelist plupload_filelist_header ui-widget-header"><tr><td class="plupload_cell plupload_file_name">'+h("Filename")+'</td><td class="plupload_cell plupload_file_status">'+h("Status")+'</td><td class="plupload_cell plupload_file_size">'+h("Size")+'</td><td class="plupload_cell plupload_file_action">&nbsp;</td></tr></table><div class="plupload_content"><div class="plupload_droptext">'+h("Drag files here.")+'</div><ul class="plupload_filelist_content"> </ul><div class="plupload_clearer">&nbsp;</div></div><table class="plupload_filelist plupload_filelist_footer ui-widget-header"><tr><td class="plupload_cell plupload_file_name"><div class="plupload_buttons"><!-- Visible --><a class="plupload_button plupload_add">'+h("Add Files")+'</a>&nbsp;<a class="plupload_button plupload_start">'+h("Start Upload")+'</a>&nbsp;<a class="plupload_button plupload_stop plupload_hidden">'+h("Stop Upload")+'</a>&nbsp;</div><div class="plupload_started plupload_hidden"><!-- Hidden --><div class="plupload_progress plupload_right"><div class="plupload_progress_container"></div></div><div class="plupload_cell plupload_upload_status"></div><div class="plupload_clearer">&nbsp;</div></div></td><td class="plupload_file_status"><span class="plupload_total_status">0%</span></td><td class="plupload_file_size"><span class="plupload_total_file_size">0 kb</span></td><td class="plupload_file_action"></td></tr></table></div><input class="plupload_count" value="0" type="hidden"></div>')}var d={};b.widget("ui.plupload",{widgetEventPrefix:"",contents_bak:"",options:{browse_button_hover:"ui-state-hover",browse_button_active:"ui-state-active",filters:{},buttons:{browse:!0,start:!0,stop:!0},views:{list:!0,thumbs:!1,active:"list",remember:!0},thumb_width:100,thumb_height:60,multiple_queues:!0,dragdrop:!0,autostart:!1,sortable:!1,rename:!1},FILE_COUNT_ERROR:-9001,_create:function(){var i=this.element.attr("id");i||(i=j.guid(),this.element.attr("id",i)),this.id=i,this.contents_bak=this.element.html(),a(this.element),this.container=b(".plupload_container",this.element).attr("id",i+"_container"),this.content=b(".plupload_content",this.element),b.fn.resizable&&this.container.resizable({handles:"s",minHeight:300}),this.filelist=b(".plupload_filelist_content",this.container).attr({id:i+"_filelist",unselectable:"on"}),this.browse_button=b(".plupload_add",this.container).attr("id",i+"_browse"),this.start_button=b(".plupload_start",this.container).attr("id",i+"_start"),this.stop_button=b(".plupload_stop",this.container).attr("id",i+"_stop"),this.thumbs_switcher=b("#"+i+"_view_thumbs"),this.list_switcher=b("#"+i+"_view_list"),b.ui.button&&(this.browse_button.button({icons:{primary:"ui-icon-circle-plus"},disabled:!0}),this.start_button.button({icons:{primary:"ui-icon-circle-arrow-e"},disabled:!0}),this.stop_button.button({icons:{primary:"ui-icon-circle-close"}}),this.list_switcher.button({text:!1,icons:{secondary:"ui-icon-grip-dotted-horizontal"}}),this.thumbs_switcher.button({text:!1,icons:{secondary:"ui-icon-image"}})),this.progressbar=b(".plupload_progress_container",this.container),b.ui.progressbar&&this.progressbar.progressbar(),this.counter=b(".plupload_count",this.element).attr({id:i+"_count",name:i+"_count"}),this._initUploader()},_initUploader:function(){var m=this,l=this.id,k,i={container:l+"_buttons",browse_button:l+"_browse"};b(".plupload_buttons",this.element).attr("id",l+"_buttons"),m.options.dragdrop&&(this.filelist.parent().attr("id",this.id+"_dropbox"),i.drop_element=this.id+"_dropbox"),this.filelist.on("click",function(e){b(e.target).hasClass("plupload_action_icon")&&(m.removeFile(b(e.target).closest(".plupload_file").attr("id")),e.preventDefault())}),k=this.uploader=d[l]=new j.Uploader(b.extend(this.options,i)),this.options=k.getOption(),m.options.views.thumbs&&(k.settings.required_features.display_media=!0),m.options.max_file_count&&j.extend(k.getOption("filters"),{max_file_count:m.options.max_file_count}),j.addFileFilter("max_file_count",function(e,p,o){e<=this.files.length-(this.total.uploaded+this.total.failed)?(m.browse_button.button("disable"),this.disableBrowse(),this.trigger("Error",{code:m.FILE_COUNT_ERROR,message:h("File count error."),file:p}),o(!1)):o(!0)}),k.bind("Error",function(o,n){var p,e="";p="<strong>"+n.message+"</strong>";switch(n.code){case j.FILE_EXTENSION_ERROR:e=f.sprintf(h("File: %s"),n.file.name);break;case j.FILE_SIZE_ERROR:e=f.sprintf(h("File: %s, size: %d, max file size: %d"),n.file.name,j.formatSize(n.file.size),j.formatSize(j.parseSize(o.getOption("filters").max_file_size)));break;case j.FILE_DUPLICATE_ERROR:e=f.sprintf(h("%s already present in the queue."),n.file.name);break;case m.FILE_COUNT_ERROR:e=f.sprintf(h("Upload element accepts only %d file(s) at a time. Extra files were stripped."),o.getOption("filters").max_file_count||0);break;case j.IMAGE_FORMAT_ERROR:e=h("Image format either wrong or not supported.");break;case j.IMAGE_MEMORY_ERROR:e=h("Runtime ran out of available memory.");break;case j.HTTP_ERROR:e=h("Upload URL might be wrong or doesn't exist.")}p+=" <br /><i>"+e+"</i>",m._trigger("error",null,{up:o,error:n}),n.code===j.INIT_ERROR?setTimeout(function(){m.destroy()},1):m.notify("error",p)}),k.bind("PostInit",function(e){m.options.buttons.browse?m.browse_button.button("enable"):(m.browse_button.button("disable").hide(),e.disableBrowse(!0)),m.options.buttons.start||m.start_button.button("disable").hide(),m.options.buttons.stop||m.stop_button.button("disable").hide(),!m.options.unique_names&&m.options.rename&&m._enableRenaming(),m.options.dragdrop&&e.features.dragdrop&&m.filelist.parent().addClass("plupload_dropbox"),m._enableViewSwitcher(),m.start_button.click(function(n){b(this).button("option","disabled")||m.start(),n.preventDefault()}),m.stop_button.click(function(n){m.stop(),n.preventDefault()}),m._trigger("ready",null,{up:e})}),k.init(),k.bind("FileFiltered",function(e,o){m._addFiles(o)}),k.bind("FilesAdded",function(e,o){m._trigger("selected",null,{up:e,files:o}),m.options.sortable&&b.ui.sortable&&m._enableSortingList(),m._trigger("updatelist",null,{filelist:m.filelist}),m.options.autostart&&setTimeout(function(){m.start()},10)}),k.bind("FilesRemoved",function(e,o){b.ui.sortable&&m.options.sortable&&b("tbody",m.filelist).sortable("destroy"),b.each(o,function(p,n){b("#"+n.id).toggle("highlight",function(){b(this).remove()})}),e.files.length&&m.options.sortable&&b.ui.sortable&&m._enableSortingList(),m._trigger("updatelist",null,{filelist:m.filelist}),m._trigger("removed",null,{up:e,files:o})}),k.bind("QueueChanged StateChanged",function(){m._handleState()}),k.bind("UploadFile",function(e,o){m._handleFileStatus(o)}),k.bind("FileUploaded",function(e,o){m._handleFileStatus(o),m._trigger("uploaded",null,{up:e,file:o})}),k.bind("UploadProgress",function(e,o){m._handleFileStatus(o),m._updateTotalProgress(),m._trigger("progress",null,{up:e,file:o})}),k.bind("UploadComplete",function(e,o){m._addFormFields(),m._trigger("complete",null,{up:e,files:o})})},_setOption:function(k,i){var l=this;k=="buttons"&&typeof i=="object"&&(i=b.extend(l.options.buttons,i),i.browse?(l.browse_button.button("enable").show(),l.uploader.disableBrowse(!1)):(l.browse_button.button("disable").hide(),l.uploader.disableBrowse(!0)),i.start?l.start_button.button("enable").show():l.start_button.button("disable").hide(),i.stop?l.start_button.button("enable").show():l.stop_button.button("disable").hide()),l.uploader.setOption(k,i)},start:function(){this.uploader.start(),this._trigger("start",null,{up:this.uploader})},stop:function(){this.uploader.stop(),this._trigger("stop",null,{up:this.uploader})},enable:function(){this.browse_button.button("enable"),this.uploader.disableBrowse(!1)},disable:function(){this.browse_button.button("disable"),this.uploader.disableBrowse(!0)},getFile:function(k){var i;return typeof k=="number"?i=this.uploader.files[k]:i=this.uploader.getFile(k),i},getFiles:function(){return this.uploader.files},removeFile:function(i){j.typeOf(i)==="string"&&(i=this.getFile(i)),this.uploader.removeFile(i)},clearQueue:function(){this.uploader.splice()},getUploader:function(){return this.uploader},refresh:function(){this.uploader.refresh()},notify:function(k,i){var l=b('<div class="plupload_message"><span class="plupload_message_close ui-icon ui-icon-circle-close" title="'+h("Close")+'"></span><p><span class="ui-icon"></span>'+i+"</p></div>");l.addClass("ui-state-"+(k==="error"?"error":"highlight")).find("p .ui-icon").addClass("ui-icon-"+(k==="error"?"alert":"info")).end().find(".plupload_message_close").click(function(){l.remove()}).end(),b(".plupload_header",this.container).append(l)},destroy:function(){this.uploader.destroy(),b(".plupload_button",this.element).unbind(),b.ui.button&&b(".plupload_add, .plupload_start, .plupload_stop",this.container).button("destroy"),b.ui.progressbar&&this.progressbar.progressbar("destroy"),b.ui.sortable&&this.options.sortable&&b("tbody",this.filelist).sortable("destroy"),this.element.empty().html(this.contents_bak),this.contents_bak="",b.Widget.prototype.destroy.apply(this)},_handleState:function(){var l=this.uploader,i=l.files.length-(l.total.uploaded+l.total.failed),k=l.getOption("filters").max_file_count||0;j.STARTED===l.state?(b([]).add(this.stop_button).add(".plupload_started").removeClass("plupload_hidden"),this.start_button.button("disable"),this.options.multiple_queues||(this.browse_button.button("disable"),l.disableBrowse()),b(".plupload_upload_status",this.element).html(f.sprintf(h("Uploaded %d/%d files"),l.total.uploaded,l.files.length)),b(".plupload_header_content",this.element).addClass("plupload_header_content_bw")):j.STOPPED===l.state&&(b([]).add(this.stop_button).add(".plupload_started").addClass("plupload_hidden"),i?this.start_button.button("enable"):this.start_button.button("disable"),this.options.multiple_queues&&b(".plupload_header_content",this.element).removeClass("plupload_header_content_bw"),this.options.multiple_queues&&k&&k>i&&(this.browse_button.button("enable"),l.disableBrowse(!1)),this._updateTotalProgress()),l.total.queued===0?b(".ui-button-text",this.browse_button).html(h("Add Files")):b(".ui-button-text",this.browse_button).html(f.sprintf(h("%d files queued"),l.total.queued)),l.refresh()},_handleFileStatus:function(q){var l=b("#"+q.id),n,m;if(!l.length){return}switch(q.status){case j.DONE:n="plupload_done",m="plupload_action_icon ui-icon ui-icon-circle-check";break;case j.FAILED:n="ui-state-error plupload_failed",m="plupload_action_icon ui-icon ui-icon-alert";break;case j.QUEUED:n="plupload_delete",m="plupload_action_icon ui-icon ui-icon-circle-minus";break;case j.UPLOADING:n="ui-state-highlight plupload_uploading",m="plupload_action_icon ui-icon ui-icon-circle-arrow-w";var v=b(".plupload_scroll",this.container),k=v.scrollTop(),i=v.height(),p=l.position().top+l.height();i<p&&v.scrollTop(k+p-i),l.find(".plupload_file_percent").html(q.percent+"%").end().find(".plupload_file_progress").css("width",q.percent+"%").end().find(".plupload_file_size").html(j.formatSize(q.size))}n+=" ui-state-default plupload_file",l.attr("class",n).find(".plupload_action_icon").attr("class",m)},_updateTotalProgress:function(){var i=this.uploader;this.filelist[0].scrollTop=this.filelist[0].scrollHeight,this.progressbar.progressbar("value",i.total.percent),this.element.find(".plupload_total_status").html(i.total.percent+"%").end().find(".plupload_total_file_size").html(j.formatSize(i.total.size)).end().find(".plupload_upload_status").html(f.sprintf(h("Uploaded %d/%d files"),i.total.uploaded,i.files.length))},_displayThumbs:function(){function w(p,l,s){var o;p.on(l,function(){clearTimeout(o),o=setTimeout(function(){clearTimeout(o),s()},300)})}function q(){if(!D||!m){var n=b(".plupload_file:eq(0)",x.filelist);D=n.outerWidth(!0),m=n.outerHeight(!0)}var l=x.content.width(),e=x.content.height();E=Math.floor(l/D),k=E*(Math.ceil(e/m)+1)}function z(){var e=Math.floor(x.content.scrollTop()/m)*E;C=b(".plupload_file .plupload_file_thumb",x.filelist).slice(e,e+k).filter(".plupload_thumb_toload").get()}function r(){function e(){if(x.view_mode!=="thumbs"){return}q(),z(),y()}b.fn.resizable&&w(x.container,"resize",e),w(x.window,"resize",e),w(x.content,"scroll",e),x.element.on("viewchanged selected",e),e()}function i(e,o){var l=new f.Image;l.onload=function(){var p=b("#"+e.id+" .plupload_file_thumb",x.filelist);this.embed(p[0],{width:x.options.thumb_width,height:x.options.thumb_height,crop:!0,preserveHeaders:!1,swf_url:f.resolveUrl(x.options.flash_swf_url),xap_url:f.resolveUrl(x.options.silverlight_xap_url)})},l.bind("embedded error",function(n){b("#"+e.id,x.filelist).find(".plupload_file_thumb").removeClass("plupload_thumb_loading").addClass("plupload_thumb_"+n.type),this.destroy(),setTimeout(o,1)}),b("#"+e.id,x.filelist).find(".plupload_file_thumb").removeClass("plupload_thumb_toload").addClass("plupload_thumb_loading"),l.load(e.getSource())}function y(){if(x.view_mode!=="thumbs"||A){return}z();if(!C.length){return}A=!0,i(x.getFile(b(C.shift()).closest(".plupload_file").attr("id")),function(){A=!1,y()})}var x=this,D,m,E,k=0,C=[],A=!1;if(!this.options.views.thumbs){return}this.element.on("selected",function B(){x.element.off("selected",B),r()})},_addFiles:function(l){var i=this,k,m="";k='<li class="plupload_file ui-state-default plupload_delete" id="{id}" style="width:{thumb_width}px;"><div class="plupload_file_thumb plupload_thumb_toload" style="width: {thumb_width}px; height: {thumb_height}px;"><div class="plupload_file_dummy ui-widget-content" style="line-height: {thumb_height}px;"><span class="ui-state-disabled">{ext} </span></div></div><div class="plupload_file_status"><div class="plupload_file_progress ui-widget-header" style="width: 0%"> </div><span class="plupload_file_percent">{percent} </span></div><div class="plupload_file_name" title="{name}"><span class="plupload_file_name_wrapper">{name} </span></div><div class="plupload_file_action"><div class="plupload_action_icon ui-icon ui-icon-circle-minus"> </div></div><div class="plupload_file_size">{size} </div><div class="plupload_file_fields"> </div></li>',j.typeOf(l)!=="array"&&(l=[l]),b.each(l,function(p,o){var n=f.Mime.getFileExtension(o.name)||"none";m+=k.replace(/\{(\w+)\}/g,function(s,q){switch(q){case"thumb_width":case"thumb_height":return i.options[q];case"size":return j.formatSize(o.size);case"ext":return n;default:return o[q]||""}})}),i.filelist.append(m)},_addFormFields:function(){var i=this;b(".plupload_file_fields",this.filelist).html(""),j.each(this.uploader.files,function(e,l){var k="",m=i.id+"_"+l;e.target_name&&(k+='<input type="hidden" name="'+m+'_tmpname" value="'+j.xmlEncode(e.target_name)+'" />'),k+='<input type="hidden" name="'+m+'_name" value="'+j.xmlEncode(e.name)+'" />',k+='<input type="hidden" name="'+m+'_status" value="'+(e.status===j.DONE?"done":"failed")+'" />',b("#"+e.id).find(".plupload_file_fields").html(k)}),this.counter.val(this.uploader.files.length)},_viewChanged:function(i){this.options.views.remember&&b.cookie&&b.cookie("plupload_ui_view",i,{expires:7,path:"/"}),f.Env.browser==="IE"&&f.Env.version<7&&this.content.attr("style",'height:expression(document.getElementById("'+this.id+'_container").clientHeight - '+(i==="list"?132:102)+")"),this.container.removeClass("plupload_view_list plupload_view_thumbs").addClass("plupload_view_"+i),this.view_mode=i,this._trigger("viewchanged",null,{view:i})},_enableViewSwitcher:function(){var m=this,i,l=b(".plupload_view_switch",this.container),k,n;j.each(["list","thumbs"],function(e){m.options.views[e]||l.find('[for="'+m.id+"_view_"+e+'"], #'+m.id+"_view_"+e).remove()}),k=l.find(".plupload_button"),k.length===1?(l.hide(),i=k.eq(0).data("view"),this._viewChanged(i)):b.ui.button&&k.length>1?(this.options.views.remember&&b.cookie&&(i=b.cookie("plupload_ui_view")),~j.inArray(i,["list","thumbs"])||(i=this.options.views.active),l.show().buttonset().find(".ui-button").click(function(e){i=b(this).data("view"),m._viewChanged(i),e.preventDefault()}),n=l.find('[for="'+m.id+"_view_"+i+'"]'),n.length&&n.trigger("click")):(l.show(),this._viewChanged(this.options.views.active)),this.options.views.thumbs&&this._displayThumbs()},_enableRenaming:function(){var i=this;this.filelist.dblclick(function(l){var v=b(l.target),p,m,q,k,e="";if(!v.hasClass("plupload_file_name_wrapper")){return}m=i.uploader.getFile(v.closest(".plupload_file")[0].id),k=m.name,q=/^(.+)(\.[^.]+)$/.exec(k),q&&(k=q[1],e=q[2]),p=b('<input class="plupload_file_rename" type="text" />').width(v.width()).insertAfter(v.hide()),p.val(k).blur(function(){v.show().parent().scrollLeft(0).end().next().remove()}).keydown(function(o){var n=b(this);b.inArray(o.keyCode,[13,27])!==-1&&(o.preventDefault(),o.keyCode===13&&(m.name=n.val()+e,v.html(m.name)),n.blur())})[0].focus()})},_enableSortingList:function(){var i=this;if(b(".plupload_file",this.filelist).length<2){return}b("tbody",this.filelist).sortable("destroy"),this.filelist.sortable({items:".plupload_delete",cancel:"object, .plupload_clearer",stop:function(){var e=[];b.each(b(this).sortable("toArray"),function(l,k){e[e.length]=i.uploader.getFile(k)}),e.unshift(e.length),e.unshift(0),Array.prototype.splice.apply(i.uploader.files,e)}})}})})(window,document,plupload,mOxie,jQuery);