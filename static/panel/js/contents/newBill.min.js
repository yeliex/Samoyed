function onNewBillLoaded(){onNewBillCreate_BillTime();onMapLoaded();onOtherUILoading();onNewUnitClicked();onNewImageClicked()}function onNewBillCreate_BillTime(){var a=new Date();$("#bill_time span").text(a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+"   "+a.getHours()+":"+a.getMinutes())}function onNewBillCreate_BillID(b){var c;var a=$.ajax("http://api.panel.mzapp.info/newbill/billid/",{method:"GET",data:{protocol:"json",district:b}});a.complete(function(d){d=$.parseJSON(d.responseText);if(d.status=="failed"){c="无法生成ID,请重试. ".returnData.error_info}else{c=d.data.bid}$("#bill_id span").text(c)})}function onOtherUILoading(){$(".ui.checkbox").checkbox();$("select.dropdown").dropdown()}function onNewBillClear(){location.href=location.origin+"/新建"}function onNewBillSave(){var a=new NewBillData();if(onNewBillCheck(a)){onDataSend(a)}}function NewBillData(){this.id=$("#bill_id span").text();this.ctime=$("#bill_time span").text();this.name=$("#basic input").val();this.extract={metro:{line_1:$($("#metro .checkbox")[0]).checkbox("is checked"),line_2:$($("#metro .checkbox")[1]).checkbox("is checked"),line_4:$($("#metro .checkbox")[2]).checkbox("is checked"),line_5:$($("#metro .checkbox")[3]).checkbox("is checked"),line_6:$($("#metro .checkbox")[4]).checkbox("is checked")},description:$("#description textarea").val()};this.address={district:$("#district").val(),area:$("#area").val(),address:$("#add").val(),pos:{posx:$("#posx").val(),posy:$("#posy").val()}};this.units={units_num:$("#units_num label span").text()[0],ulist:getUnits($("#units_num label span").text()[0])};this.images={main:$("#main-image img").attr("src"),contents_num:$("#images_num label span").text()[0],contents:getImages($("#images_num label span").text()[0])}}function getUnits(a){var c={};for(i=0;i<a;i++){var b={name:$($("#unit_"+(i+1)).children()[1].children[0].children[0].children[0]).children("input").val(),size:$($("#unit_"+(i+1)).children()[1].children[0].children[0].children[1]).children("input").val(),price:$($("#unit_"+(i+1)).children()[1].children[0].children[1].children[0]).children("input").val(),decoration:$($("#unit_"+(i+1)).children()[1].children[0].children[1].children[1]).children("select").val(),image:$("#unit_"+(i+1)).find("img").attr("src")};c[i]=b}return c}function getImages(a){var b={};for(i=0;i<a;i++){var c={name:$("#image_"+(i+1)+" input").val(),url:$("#image_"+(i+1)+" img").attr("src")};b[i]=c}return b}function onNewBillCheck(c){if(c.name===""){alert("请输入名称");return false}else{if(c.address.district===""||c.address.area===""||c.address.address===""||c.address.pos.posx===""||c.address.pos.posy===""){alert("请将地址分类下所有内容填写完整");return false}else{if(c.images.main==="http://7xked6.com2.z0.glb.qiniucdn.com/default_unit.png"){alert("房源大图不能使用默认");return false}else{for(var a=0;a<c.units.ulist.length;a++){var b=c.units.ulist[a];if(b.size===""){alert("第"+(a+1)+"个户型的面积不能为空");return false}else{if(b.price===""){alert("第"+(a+1)+"个户型的价格不能为空");return false}else{if(b.decoration===""){alert("必须为第"+(a+1)+"个户型选择一个装修类型");return false}else{continue}}}return true}return true}}}}function onDataSend(b){var a=$.ajax("http://api.panel.mzapp.info/newbill/create/?protocol=json",{method:"POST",data:{data:b}});a.complete(function(c){c=$.parseJSON(c.responseText);if(c.status==="success"){alert("保存成功 现在你可以在 '房源管理' 中管理房源\n\n房源ID: "+c.data.bid+"\n房源名字: "+c.data.bname);location.href(location.origin+"/新建")}else{alert("保存失败\n\n错误: "+c.error_info)}})};