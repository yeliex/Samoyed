function onNewBillLoaded(){onNewBillCreate_BillTime();onMapLoaded();onOtherUILoading();onNewUnitClicked();onNewImageClicked()}function onNewBillCreate_BillTime(){var b=new Date();$("#bill_time span").text(b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()+"   "+b.getHours()+":"+b.getMinutes())}function onNewBillCreate_BillID(d){var f;var e=$.ajax("http://api.panel.mzapp.info/newbill/billid/",{method:"GET",data:{protocol:"json",district:d}});e.complete(function(a){a=$.parseJSON(a.responseText);if(a.status=="failed"){f="无法生成ID,请重试. ".returnData.error_info}else{f=a.data.bid}$("#bill_id span").text(f)})}function onOtherUILoading(){$(".ui.checkbox").checkbox();$("select.dropdown").dropdown()}function onNewBillClear(){location.href=location.origin+"/新建"}function onNewBillSave(){var b=new NewBillData();if(onNewBillCheck(b)){onDataSend(b)}}function NewBillData(){this.id=$("#bill_id span").text();this.ctime=$("#bill_time span").text();this.name=$("#basic input").val();this.extract={metro:{line_1:$($("#metro .checkbox")[0]).checkbox("is checked"),line_2:$($("#metro .checkbox")[1]).checkbox("is checked"),line_4:$($("#metro .checkbox")[2]).checkbox("is checked"),line_5:$($("#metro .checkbox")[3]).checkbox("is checked"),line_6:$($("#metro .checkbox")[4]).checkbox("is checked")},description:$("#description textarea").val()};this.address={district:$("#district").val(),area:$("#area").val(),address:$("#add").val(),pos:{posx:$("#posx").val(),posy:$("#posy").val()}};this.units={units_num:$("#units_num label span").text()[0],ulist:getUnits($("#units_num label span").text()[0])};this.images={main:$("#main-image img").attr("src"),contents_num:$("#images_num label span").text()[0],contents:getImages($("#images_num label span").text()[0])}}function getUnits(e){var f={};for(i=0;i<e;i++){var d={name:$($("#unit_"+(i+1)).children()[1].children[0].children[0].children[0]).children("input").val(),size:$($("#unit_"+(i+1)).children()[1].children[0].children[0].children[1]).children("input").val(),price:$($("#unit_"+(i+1)).children()[1].children[0].children[1].children[0]).children("input").val(),decoration:$($("#unit_"+(i+1)).children()[1].children[0].children[1].children[1]).children("select").val(),image:$("#unit_"+(i+1)).find("img").attr("src")};f[i]=d}return f}function getImages(e){var d={};for(i=0;i<e;i++){var f={name:$("#image_"+(i+1)+" input").val(),url:$("#image_"+(i+1)+" img").attr("src")};d[i]=f}return d}function onNewBillCheck(f){if(f.name===""){alert("请输入名称");return false}else{if(f.address.district===""||f.address.area===""||f.address.address===""||f.address.pos.posx===""||f.address.pos.posy===""){alert("请将地址分类下所有内容填写完整");return false}else{if(f.images.main==="http://7xked6.com2.z0.glb.qiniucdn.com/default_unit.png"){alert("房源大图不能使用默认");return false}else{for(var e=0;e<f.units.ulist.length;e++){var d=f.units.ulist[e];if(d.size===""){alert("第"+(e+1)+"个户型的面积不能为空");return false}else{if(d.price===""){alert("第"+(e+1)+"个户型的价格不能为空");return false}else{if(d.decoration===""){alert("必须为第"+(e+1)+"个户型选择一个装修类型");return false}else{continue}}}return true}return true}}}}function onDataSend(c){var d=$.ajax("http://api.panel.mzapp.info/newbill/create/?protocol=json",{method:"POST",data:{data:c}});d.complete(function(a){a=$.parseJSON(a.responseText);if(a.status==="success"){alert("保存成功 现在你可以在 '房源管理' 中管理房源\n\n房源ID: "+a.data.bid+"\n房源名字: "+a.data.bname);location.href(location.origin+"/新建")}else{alert("保存失败\n\n错误: "+a.error_info)}})};