var config={uptoken_url:"/api/imageupload/token?protocol=json&bucket=mzimg",domain:"img.static.mzapp.info"};var upTarget={target:null,serial:null};$(function(){var b=Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"uploadBtn",container:"image-selector",max_file_size:"100mb",flash_swf_url:"plupload/Moxie.swf",max_retries:3,chunk_size:"4mb",auto_start:false,dragdrop:false,drop_element:"element",uptoken_url:config.uptoken_url,domain:config.domain,unique_names:true,init:{FilesAdded:function(a,d){plupload.each(d,function(c){var f=0;setProgress(f);b.start()})},BeforeUpload:function(a,d){$("#upload-status-label").html("上传中");$("#image-selector").modal("hide");$("#image-uploader").modal("setting","closable",false).modal("show")},UploadProgress:function(a,e){var f=a.total.percent.toString();setProgress(f)},FileUploaded:function(a,f,e){$("#upload-status-label").html("上传完成");uploadSuccess($.parseJSON(e),upTarget.target,upTarget.serial)},Error:function(a,e,f){},UploadComplete:function(){}}})});function onUpload(c,d){$("#image-uploader").modal({allowMultiple:true});$("#image-selector").modal("show");upTarget.target=c;upTarget.serial=d}function setProgress(b){$("#upload-bar").attr("data-percent",b);$("#upload-bar .bar").css("width",b+"%");$("#upload-progress").html(b+"%")}function uploadSuccess(g,h,e){var f="http://"+config.domain+"/"+g.key;$("#image-uploader").modal("hide");switch(h){case 1:$("#main-image img").attr("src",f);$("#main-image input").val(f);break;case 2:$("#unit_"+e+" img").attr("src",f);break;case 3:$("#image_"+e+" img").attr("src",f);break;case 4:onEditMainImageSave(f);break;case 5:$(".edit.units #unit_"+e+" img").attr("src",f);break;case 6:onEditNewImageSave(f,e);break}};