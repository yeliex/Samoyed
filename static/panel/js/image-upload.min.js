var config={uptoken_url:"/api/imageupload/token?protocol=json&bucket=mzimg",domain:"img.static.mzapp.info"};var upTarget={target:null,serial:null};$(function(){var a=Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"uploadBtn",container:"image-selector",max_file_size:"100mb",flash_swf_url:"plupload/Moxie.swf",max_retries:3,chunk_size:"4mb",auto_start:false,dragdrop:false,drop_element:"element",uptoken_url:config.uptoken_url,domain:config.domain,unique_names:true,init:{FilesAdded:function(b,c){plupload.each(c,function(e){var d=0;setProgress(d);a.start()})},BeforeUpload:function(b,c){$("#upload-status-label").html("上传中");$("#image-selector").modal("hide");$("#image-uploader").modal("setting","closable",false).modal("show")},UploadProgress:function(b,d){var c=b.total.percent.toString();setProgress(c)},FileUploaded:function(b,c,d){$("#upload-status-label").html("上传完成");uploadSuccess($.parseJSON(d),upTarget.target,upTarget.serial)},Error:function(b,d,c){},UploadComplete:function(){}}})});function onUpload(b,a){$("#image-uploader").modal({allowMultiple:true});$("#image-selector").modal("show");upTarget.target=b;upTarget.serial=a}function setProgress(a){$("#upload-bar").attr("data-percent",a);$("#upload-bar .bar").css("width",a+"%");$("#upload-progress").html(a+"%")}function uploadSuccess(d,c,b){var a="http://"+config.domain+"/"+d.key;$("#image-uploader").modal("hide");switch(c){case 1:$("#main-image img").attr("src",a);$("#main-image input").val(a);break;case 2:$("#unit_"+b+" img").attr("src",a);break;case 3:$("#image_"+b+" img").attr("src",a);break;case 4:onEditMainImageSave(a);break;case 5:$(".edit.units #unit_"+b+" img").attr("src",a);break;case 6:onEditNewImageSave(a,b);break}};