$(function(){var a=$.ajax(location.origin+"/api/login/iflogin/",{method:"GET",data:{protocol:"json"}});a.complete(function(b){ifLogin($.parseJSON(b.responseText))})});function ifLogin(c){var a=c.status;var d=c.data.login_status;var b="";if(a=="failed"||d=="failed"){if(d=="failed"){b="未登录"}else{b=c.error_info}loginDisplay(b)}else{logined(c.data.uid,c.data.user)}}function loginDisplay(a){if(!a){a="请登录"}$("#loginProgress").modal("hide");$("#loginBox .actions .primary.button#login").html("登录");$("#loginBox .actions .primary.button#login").removeClass("loading");$("#loginBox #alert").text(a);$("#loginBox #alert").parent().addClass("visible");$("#loginBox").modal("setting","closable",false).modal("show")}$(function(){$("#login").click(function(){var b=$("#user").val();var c=$("#password").val();var a={user:b,password:c};$("#loginBox #alert").parent().removeClass("visible");$("#loginBox .actions .primary.button#login").addClass("loading");var d=$.ajax(location.origin+"/api/login?protocol=json",{method:"POST",data:a});d.complete(function(e){setTimeout(function(){loginResult($.parseJSON(e.responseText))},1000)})})});function loginResult(a){if(a.status==="failed"||a.data.login_status==="failed"){loginDisplay(a.error_info)}else{logined(a.data.uid,a.data.user)}}function logined(b,a){$("#loginBox").modal("hide");$("#loginSuccess .header span").html(a);$("#loginSuccess").modal("setting","closable",false).modal("show");setTimeout(function(){$("#loginSuccess").modal("hide")},1000);$(".ye-nav #user-name span").text(a);setInterval(function(){var c=new Date();$(".ye-nav #nav-time").text(c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()+"   "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds())},1000)}function logout(){var a=$.ajax(location.origin+"/api/login/logout",{method:"GET",data:{protocol:"json"}});a.complete(function(){location.reload()})};