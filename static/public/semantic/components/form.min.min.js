/*!
 * # Semantic UI x.x - Form Validation
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(h,e,f,g){h.fn.form=function(a){var c=h(this),p=c.selector||"",s=new Date().getTime(),d=[],o=arguments[0],q=arguments[1],t=(typeof o=="string"),b=[].slice.call(arguments,1),r;c.each(function(){var Q=h(this),Y=this,n=[],U=false,V,k,l,S,X,R,m,N,O,K,P,W,T,M,j,i,L,Z;Z={initialize:function(){Z.get.settings();if(t){if(L===g){Z.instantiate()}Z.invoke(o)}else{Z.verbose("Initializing form validation",Q,N);Z.bindEvents();Z.set.defaults();Z.instantiate()}},instantiate:function(){Z.verbose("Storing instance of module",Z);L=Z;Q.data(j,Z)},destroy:function(){Z.verbose("Destroying previous module",L);Z.removeEvents();Q.removeData(j)},refresh:function(){Z.verbose("Refreshing selector cache");V=Q.find(P.field);k=Q.find(P.group);l=Q.find(P.message);S=Q.find(P.prompt);X=Q.find(P.submit);R=Q.find(P.clear);m=Q.find(P.reset)},submit:function(){Z.verbose("Submitting form",Q);Q.submit()},attachEvents:function(v,u){u=u||"submit";h(v).on("click"+i,function(w){Z[u]();w.preventDefault()})},bindEvents:function(){Z.verbose("Attaching form events");Q.on("submit"+i,Z.validate.form).on("blur"+i,P.field,Z.event.field.blur).on("click"+i,P.submit,Z.submit).on("click"+i,P.reset,Z.reset).on("click"+i,P.clear,Z.clear);if(N.keyboardShortcuts){Q.on("keydown"+i,P.field,Z.event.field.keydown)}V.each(function(){var w=h(this),v=w.prop("type"),u=Z.get.changeEvent(v,w);h(this).on(u+i,Z.event.field.change)})},clear:function(){V.each(function(){var z=h(this),u=z.parent(),y=z.closest(k),B=y.find(P.prompt),v=z.data(K.defaultValue)||"",A=u.is(P.uiCheckbox),x=u.is(P.uiDropdown),w=y.hasClass(W.error);if(w){Z.verbose("Resetting error on field",y);y.removeClass(W.error);B.remove()}if(x){Z.verbose("Resetting dropdown value",u,v);u.dropdown("clear")}else{if(A){z.prop("checked",false)}else{Z.verbose("Resetting field value",z,v);z.val("")}}})},reset:function(){V.each(function(){var z=h(this),u=z.parent(),y=z.closest(k),B=y.find(P.prompt),v=z.data(K.defaultValue),A=u.is(P.uiCheckbox),x=u.is(P.uiDropdown),w=y.hasClass(W.error);if(v===g){return}if(w){Z.verbose("Resetting error on field",y);y.removeClass(W.error);B.remove()}if(x){Z.verbose("Resetting dropdown value",u,v);u.dropdown("restore defaults")}else{if(A){Z.verbose("Resetting checkbox value",u,v);z.prop("checked",v)}else{Z.verbose("Resetting field value",z,v);z.val(v)}}})},is:{valid:function(){var u=true;Z.verbose("Checking if form is valid");h.each(O,function(w,v){if(!(Z.validate.field(v))){u=false}});return u}},removeEvents:function(){Q.off(i);V.off(i);X.off(i);V.off(i)},event:{field:{keydown:function(x){var u=h(this),v=x.which,w={enter:13,escape:27};if(v==w.escape){Z.verbose("Escape key pressed blurring field");u.blur()}if(!x.ctrlKey&&v==w.enter&&u.is(P.input)&&u.not(P.checkbox).length>0){if(!U){u.one("keyup"+i,Z.event.field.keyup);Z.submit();Z.debug("Enter pressed on input submitting form")}U=true}},keyup:function(){U=false},blur:function(){var u=h(this),w=u.closest(k),v=Z.get.validation(u);if(w.hasClass(W.error)){Z.debug("Revalidating field",u,v);Z.validate.field(v)}else{if(N.on=="blur"||N.on=="change"){Z.validate.field(v)}}},change:function(){var v=h(this),u=v.closest(k);if(N.on=="change"||(u.hasClass(W.error)&&N.revalidate)){clearTimeout(Z.timer);Z.timer=setTimeout(function(){Z.debug("Revalidating field",v,Z.get.validation(v));Z.validate.field(Z.get.validation(v))},N.delay)}}}},get:{changeEvent:function(v,u){if(v=="checkbox"||v=="radio"||v=="hidden"||u.is("select")){return"change"}else{return Z.get.inputEvent()}},inputEvent:function(){return(f.createElement("input").oninput!==g)?"input":(f.createElement("input").onpropertychange!==g)?"propertychange":"keyup"},settings:function(){var u;if(h.isPlainObject(a)){var w=Object.keys(a),v=(w.length>0)?(a[w[0]].identifier!==g):false;if(v){N=h.extend(true,{},h.fn.form.settings,q);O=h.extend({},h.fn.form.settings.defaults,a);Z.error(N.error.oldSyntax,Y);Z.verbose("Extending settings from legacy parameters",O,N)}else{N=h.extend(true,{},h.fn.form.settings,a);O=h.extend({},h.fn.form.settings.defaults,N.fields);Z.verbose("Extending settings",O,N)}}else{N=h.fn.form.settings;O=h.fn.form.settings.defaults;Z.verbose("Using default form validation",O,N)}M=N.namespace;K=N.metadata;P=N.selector;W=N.className;T=N.error;j="module-"+M;i="."+M;L=Q.data(j);Z.refresh()},field:function(u){Z.verbose("Finding field with identifier",u);if(V.filter("#"+u).length>0){return V.filter("#"+u)}else{if(V.filter('[name="'+u+'"]').length>0){return V.filter('[name="'+u+'"]')}else{if(V.filter('[name="'+u+'[]"]').length>0){return V.filter('[name="'+u+'[]"]')}else{if(V.filter("[data-"+K.validate+'="'+u+'"]').length>0){return V.filter("[data-"+K.validate+'="'+u+'"]')}}}}return h("<input/>")},fields:function(v){var u=h();h.each(v,function(w,x){u=u.add(Z.get.field(x))});return u},validation:function(v){var u;if(!O){return false}h.each(O,function(w,x){if(Z.get.field(x.identifier)[0]==v[0]){u=x}});return u||false},value:function(w){var v=[],u;v.push(w);u=Z.get.values.call(Y,v);return u[w]},values:function(v){var w=h.isArray(v)?Z.get.fields(v):V,u={};w.each(function(B,y){var z=h(y),A=z.prop("type"),F=z.prop("name"),x=z.val(),E=z.is(P.checkbox),G=z.is(P.radio),C=(F.indexOf("[]")!==-1),D=(E)?z.is(":checked"):false;if(F){if(C){F=F.replace("[]","");if(!u[F]){u[F]=[]}if(E){if(D){u[F].push(x)}else{Z.debug("Omitted unchecked checkbox",z);return true}}else{u[F].push(x)}}else{if(G){if(D){u[F]=x}}else{if(E){if(D){u[F]=true}else{Z.debug("Omitted unchecked checkbox",z);return true}}else{u[F]=x}}}}});return u}},has:{field:function(u){Z.verbose("Checking for existence of a field with identifier",u);if(V.filter("#"+u).length>0){return true}else{if(V.filter('[name="'+u+'"]').length>0){return true}else{if(V.filter("[data-"+K.validate+'="'+u+'"]').length>0){return true}}}return false}},add:{prompt:function(z,w){var y=Z.get.field(z),x=y.closest(k),u=x.children(P.prompt),v=(u.length!==0);w=(typeof w=="string")?[w]:w;Z.verbose("Adding field error state",z);x.addClass(W.error);if(N.inline){if(!v){u=N.templates.prompt(w);u.appendTo(x)}u.html(w[0]);if(!v){if(N.transition&&h.fn.transition!==g&&Q.transition("is supported")){Z.verbose("Displaying error with css transition",N.transition);u.transition(N.transition+" in",N.duration)}else{Z.verbose("Displaying error with fallback javascript animation");u.fadeIn(N.duration)}}else{Z.verbose("Inline errors are disabled, no inline error added",z)}}},errors:function(u){Z.debug("Adding form error messages",u);l.html(N.templates.error(u))}},remove:{prompt:function(w){var u=Z.get.field(w.identifier),x=u.closest(k),v=x.children(P.prompt);x.removeClass(W.error);if(N.inline&&v.is(":visible")){Z.verbose("Removing prompt for field",w);if(N.transition&&h.fn.transition!==g&&Q.transition("is supported")){v.transition(N.transition+" out",N.duration,function(){v.remove()})}else{v.fadeOut(N.duration,function(){v.remove()})}}}},set:{success:function(){Q.removeClass(W.error).addClass(W.success)},defaults:function(){V.each(function(){var u=h(this),v=(u.filter(P.checkbox).length>0),w=(v)?u.is(":checked"):u.val();u.data(K.defaultValue,w)})},error:function(){Q.removeClass(W.success).addClass(W.error)},value:function(w,u){var v={};v[w]=u;return Z.set.values.call(Y,v)},values:function(u){if(h.isEmptyObject(u)){return}h.each(u,function(w,x){var z=Z.get.field(w),v=z.parent(),C=h.isArray(x),D=v.is(P.uiCheckbox),A=v.is(P.uiDropdown),E=(z.is(P.radio)&&D),y=(z.length>0),B;if(y){if(C&&D){Z.verbose("Selecting multiple",x,z);v.checkbox("uncheck");h.each(x,function(G,F){B=z.filter('[value="'+F+'"]');v=B.parent();if(B.length>0){v.checkbox("check")}})}else{if(E){Z.verbose("Selecting radio value",x,z);z.filter('[value="'+x+'"]').parent(P.uiCheckbox).checkbox("check")}else{if(D){Z.verbose("Setting checkbox value",x,v);if(x===true){v.checkbox("check")}else{v.checkbox("uncheck")}}else{if(A){Z.verbose("Setting dropdown value",x,v);v.dropdown("set selected",x)}else{Z.verbose("Setting field value",x,z);z.val(x)}}}}}})}},validate:{form:function(u){var v;if(U){return false}n=[];if(Z.is.valid()){Z.debug("Form has no validation errors, submitting");Z.set.success();return N.onSuccess.call(Y,u)}else{Z.debug("Form has errors");Z.set.error();if(!N.inline){Z.add.errors(n)}if(Q.data("moduleApi")!==g){u.stopImmediatePropagation()}return N.onFailure.call(Y,n)}},field:function(w){var u=Z.get.field(w.identifier),x=true,v=[];if(u.prop("disabled")){Z.debug("Field is disabled. Skipping",w.identifier);x=true}else{if(w.optional&&h.trim(u.val())===""){Z.debug("Field is optional and empty. Skipping",w.identifier);x=true}else{if(w.rules!==g){h.each(w.rules,function(z,y){if(Z.has.field(w.identifier)&&!(Z.validate.rule(w,y))){Z.debug("Field is invalid",w.identifier,y.type);v.push(y.prompt);x=false}})}}}if(x){Z.remove.prompt(w,v);N.onValid.call(u)}else{n=n.concat(v);Z.add.prompt(w.identifier,v);N.onInvalid.call(u,v);return false}return true},rule:function(w,B){var x=Z.get.field(w.identifier),z=B.type,v=x.val(),D=z.match(N.regExp.bracket),u=true,y,A,C;v=h.trim(x.val()+"");if(D){A=""+D[1];C=z.replace(D[0],"");y=N.rules[C];if(!h.isFunction(y)){Z.error(T.noRule,C);return}u=y.call(x,v,A)}else{y=N.rules[z];if(!h.isFunction(y)){Z.error(T.noRule,z);return}u=y.call(x,v)}return u}},setting:function(v,u){if(h.isPlainObject(v)){h.extend(true,N,v)}else{if(u!==g){N[v]=u}else{return N[v]}}},internal:function(v,u){if(h.isPlainObject(v)){h.extend(true,Z,v)}else{if(u!==g){Z[v]=u}else{return Z[v]}}},debug:function(){if(N.debug){if(N.performance){Z.performance.log(arguments)}else{Z.debug=Function.prototype.bind.call(console.info,console,N.name+":");Z.debug.apply(console,arguments)}}},verbose:function(){if(N.verbose&&N.debug){if(N.performance){Z.performance.log(arguments)}else{Z.verbose=Function.prototype.bind.call(console.info,console,N.name+":");Z.verbose.apply(console,arguments)}}},error:function(){Z.error=Function.prototype.bind.call(console.error,console,N.name+":");Z.error.apply(console,arguments)},performance:{log:function(x){var u,w,v;if(N.performance){u=new Date().getTime();v=s||u;w=u-v;s=u;d.push({Name:x[0],Arguments:[].slice.call(x,1)||"",Element:Y,"Execution Time":w})}clearTimeout(Z.performance.timer);Z.performance.timer=setTimeout(Z.performance.display,500)},display:function(){var u=N.name+":",v=0;s=false;clearTimeout(Z.performance.timer);h.each(d,function(x,w){v+=w["Execution Time"]});u+=" "+v+"ms";if(p){u+=" '"+p+"'"}if(c.length>1){u+=" ("+c.length+")"}if((console.group!==g||console.table!==g)&&d.length>0){console.groupCollapsed(u);if(console.table){console.table(d)}else{h.each(d,function(x,w){console.log(w.Name+": "+w["Execution Time"]+"ms")})}console.groupEnd()}d=[]}},invoke:function(x,u,z){var A=L,w,y,v;u=u||b;z=Y||z;if(typeof x=="string"&&A!==g){x=x.split(/[\. ]/);w=x.length-1;h.each(x,function(B,C){var D=(B!=w)?C+x[B+1].charAt(0).toUpperCase()+x[B+1].slice(1):x;if(h.isPlainObject(A[D])&&(B!=w)){A=A[D]}else{if(A[D]!==g){y=A[D];return false}else{if(h.isPlainObject(A[C])&&(B!=w)){A=A[C]}else{if(A[C]!==g){y=A[C];return false}else{return false}}}}})}if(h.isFunction(y)){v=y.apply(z,u)}else{if(y!==g){v=y}}if(h.isArray(r)){r.push(v)}else{if(r!==g){r=[r,v]}else{if(v!==g){r=v}}}return y}};Z.initialize()});return(r!==g)?r:this};h.fn.form.settings={name:"Form",namespace:"form",debug:false,verbose:false,performance:true,fields:false,keyboardShortcuts:true,on:"submit",inline:false,delay:200,revalidate:true,transition:"scale",duration:200,onValid:function(){},onInvalid:function(){},onSuccess:function(){return true},onFailure:function(){return false},metadata:{defaultValue:"default",validate:"validate"},regExp:{bracket:/\[(.*)\]/i,escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,email:"[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?",integer:/^\-?\d+$/,flags:/^\/(.*)\/(.*)?/,url:/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/i},selector:{checkbox:'input[type="checkbox"], input[type="radio"]',clear:".clear",field:"input, textarea, select",group:".field",input:"input",message:".error.message",prompt:".prompt.label",radio:'input[type="radio"]',reset:'.reset:not([type="reset"])',submit:'.submit:not([type="submit"])',uiCheckbox:".ui.checkbox",uiDropdown:".ui.dropdown"},className:{error:"error",label:"ui prompt label",pressed:"down",success:"success"},error:{oldSyntax:"Starting in 2.0 forms now only take a single settings object. Validation settings converted to new syntax automatically.",noRule:"There is no rule matching the one you specified",method:"The method you called is not defined."},templates:{error:function(a){var b='<ul class="list">';h.each(a,function(d,c){b+="<li>"+c+"</li>"});b+="</ul>";return h(b)},prompt:function(a){return h("<div/>").addClass("ui red pointing prompt label").html(a[0])}},rules:{checked:function(){return(h(this).filter(":checked").length>0)},contains:function(b,a){a=a.replace(h.fn.form.settings.regExp.escape,"\\$&");return(b.search(new RegExp(a,"i"))!==-1)},containsExactly:function(b,a){a=a.replace(h.fn.form.settings.regExp.escape,"\\$&");return(b.search(new RegExp(a))!==-1)},email:function(b){var a=new RegExp(h.fn.form.settings.regExp.email,"i");return a.test(b)},empty:function(a){return !(a===g||""===a||h.isArray(a)&&a.length===0)},integer:function(b,k){var c=h.fn.form.settings.regExp.integer,d,l,a;if(k===g||k===""||k===".."){}else{if(k.indexOf("..")==-1){if(c.test(k)){d=l=k-0}}else{a=k.split("..",2);if(c.test(a[0])){d=a[0]-0}if(c.test(a[1])){l=a[1]-0}}}return(c.test(b)&&(d===g||b>=d)&&(l===g||b<=l))},is:function(b,a){a=(typeof a=="string")?a.toLowerCase():a;b=(typeof b=="string")?b.toLowerCase():b;return(b==a)},isExactly:function(b,a){return(b==a)},length:function(a,b){return(a!==g)?(a.length>=b):false},different:function(a,c){var d=h(this),b;if(h('[data-validate="'+c+'"]').length>0){b=h('[data-validate="'+c+'"]').val()}else{if(h("#"+c).length>0){b=h("#"+c).val()}else{if(h('[name="'+c+'"]').length>0){b=h('[name="'+c+'"]').val()}else{if(h('[name="'+c+'[]"]').length>0){b=h('[name="'+c+'[]"]')}}}}return(b!==g)?(a.toString()!==b.toString()):false},match:function(a,c){var d=h(this),b;if(h('[data-validate="'+c+'"]').length>0){b=h('[data-validate="'+c+'"]').val()}else{if(h("#"+c).length>0){b=h("#"+c).val()}else{if(h('[name="'+c+'"]').length>0){b=h('[name="'+c+'"]').val()}else{if(h('[name="'+c+'[]"]').length>0){b=h('[name="'+c+'[]"]')}}}}return(b!==g)?(a.toString()==b.toString()):false},maxCount:function(a,b){a=a.split(",");return(h.isArray(a)&&a.length<=b)},exactCount:function(a,b){a=a.split(",");return(h.isArray(a)&&a.length==b)},minCount:function(a,b){a=a.split(",");return(h.isArray(a)&&a.length>=b)},regExp:function(a,b){var c=b.match(h.fn.form.settings.regExp.flags),d;if(c){b=(c.length>=2)?c[1]:b;d=(c.length>=3)?c[2]:""}return a.match(new RegExp(b,d))},maxLength:function(a,b){return(a!==g)?(a.length<=b):false},not:function(a,b){a=(typeof a=="string")?a.toLowerCase():a;b=(typeof b=="string")?b.toLowerCase():b;return(a!=b)},notExactly:function(a,b){return(a!=b)},url:function(a){return h.fn.form.settings.regExp.url.match(a)}}}})(jQuery,window,document);