/*!
 * # Semantic UI x.x - Popup
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(h,e,f,g){h.fn.popup=function(a){var c=h(this),v=h(f),y=h(e),u=h("body"),s=c.selector||"",t=("ontouchstart" in f.documentElement),x=new Date().getTime(),d=[],r=arguments[0],z=(typeof r=="string"),b=[].slice.call(arguments,1),w;c.each(function(){var n=(h.isPlainObject(a))?h.extend(true,{},h.fn.popup.settings,a):h.extend({},h.fn.popup.settings),p=n.selector,R=n.className,N=n.error,m=n.metadata,X=n.namespace,O="."+n.namespace,W="module-"+X,q=h(this),T=h(n.context),P=(n.target)?h(n.target):q,Q,j,k=0,o=false,i=false,S=this,l=q.data(W),M,V,U;U={initialize:function(){U.debug("Initializing",q);U.createID();U.bind.events();if(!U.exists()&&n.preserve){U.create()}U.instantiate()},instantiate:function(){U.verbose("Storing instance",U);l=U;q.data(W,l)},refresh:function(){if(n.popup){Q=h(n.popup).eq(0)}else{if(n.inline){Q=P.next(p.popup).eq(0);n.popup=Q}}if(n.popup){Q.addClass(R.loading);j=U.get.offsetParent();Q.removeClass(R.loading);if(n.movePopup&&U.has.popup()&&U.get.offsetParent(Q)[0]!==j[0]){U.debug("Moving popup to the same offset parent as activating element");Q.detach().appendTo(j)}}else{j=(n.inline)?U.get.offsetParent(P):U.has.popup()?U.get.offsetParent(Q):u}if(j.is("html")){U.debug("Setting page as offset parent");j=u}},reposition:function(){U.refresh();U.set.position()},destroy:function(){U.debug("Destroying previous module");if(Q&&!n.preserve){U.removePopup()}clearTimeout(U.hideTimer);clearTimeout(U.showTimer);y.off(M);q.off(O).removeData(W)},event:{start:function(A){var B=(h.isPlainObject(n.delay))?n.delay.show:n.delay;clearTimeout(U.hideTimer);U.showTimer=setTimeout(U.show,B)},end:function(){var A=(h.isPlainObject(n.delay))?n.delay.hide:n.delay;clearTimeout(U.showTimer);U.hideTimer=setTimeout(U.hide,A)},touchstart:function(A){i=true;U.event.start()},resize:function(){if(U.is.visible()){U.set.position()}},hideGracefully:function(A){if(A&&h(A.target).closest(p.popup).length===0){U.debug("Click occurred outside popup hiding popup");U.hide()}else{U.debug("Click was inside popup, keeping popup open")}}},create:function(){var C=U.get.html(),D=U.get.variation(),A=U.get.title(),B=U.get.content();if(C||B||A){U.debug("Creating pop-up html");if(!C){C=n.templates.popup({title:A,content:B})}Q=h("<div/>").addClass(R.popup).addClass(D).data(m.activator,q).html(C);if(D){Q.addClass(D)}if(n.inline){U.verbose("Inserting popup element inline",Q);Q.insertAfter(q)}else{U.verbose("Appending popup element to body",Q);Q.appendTo(T)}U.refresh();if(n.hoverable){U.bind.popup()}n.onCreate.call(Q,S)}else{if(P.next(p.popup).length!==0){U.verbose("Pre-existing popup found");n.inline=true;n.popups=P.next(p.popup).data(m.activator,q);U.refresh();if(n.hoverable){U.bind.popup()}}else{if(n.popup){h(n.popup).data(m.activator,q);U.verbose("Used popup specified in settings");U.refresh();if(n.hoverable){U.bind.popup()}}else{U.debug("No content specified skipping display",S)}}}},createID:function(){V=(Math.random().toString(16)+"000000000").substr(2,8);M="."+V;U.verbose("Creating unique id for element",V)},toggle:function(){U.debug("Toggling pop-up");if(U.is.hidden()){U.debug("Popup is hidden, showing pop-up");U.unbind.close();U.show()}else{U.debug("Popup is visible, hiding pop-up");U.hide()}},show:function(A){A=A||function(){};U.debug("Showing pop-up",n.transition);if(U.is.hidden()&&!(U.is.active()&&U.is.dropdown())){if(!U.exists()){U.create()}if(n.onShow.call(Q,S)===false){U.debug("onShow callback returned false, cancelling popup animation");return}else{if(!n.preserve&&!n.popup){U.refresh()}}if(Q&&U.set.position()){U.save.conditions();if(n.exclusive){U.hideAll()}U.animate.show(A)}}},hide:function(A){A=A||function(){};if(U.is.visible()||U.is.animating()){if(n.onHide.call(Q,S)===false){U.debug("onHide callback returned false, cancelling popup animation");return}U.remove.visible();U.unbind.close();U.restore.conditions();U.animate.hide(A)}},hideAll:function(){h(p.popup).filter("."+R.visible).each(function(){h(this).data(m.activator).popup("hide")})},exists:function(){if(!Q){return false}if(n.inline||n.popup){return(U.has.popup())}else{return(Q.closest(T).length>=1)?true:false}},removePopup:function(){U.debug("Removing popup",Q);if(U.has.popup()&&!n.popup){Q.remove();Q=g}n.onRemove.call(Q,S)},save:{conditions:function(){U.cache={title:q.attr("title")};if(U.cache.title){q.removeAttr("title")}U.verbose("Saving original attributes",U.cache.title)}},restore:{conditions:function(){if(U.cache&&U.cache.title){q.attr("title",U.cache.title);U.verbose("Restoring original attributes",U.cache.title)}return true}},animate:{show:function(A){A=h.isFunction(A)?A:function(){};if(n.transition&&h.fn.transition!==g&&q.transition("is supported")){U.set.visible();Q.transition({animation:n.transition+" in",queue:false,debug:n.debug,verbose:n.verbose,duration:n.duration,onComplete:function(){U.bind.close();A.call(Q,S);n.onVisible.call(Q,S)}})}else{U.error(N.noTransition)}},hide:function(A){A=h.isFunction(A)?A:function(){};U.debug("Hiding pop-up");if(n.onShow.call(Q,S)===false){U.debug("onShow callback returned false, cancelling popup animation");return}if(n.transition&&h.fn.transition!==g&&q.transition("is supported")){Q.transition({animation:n.transition+" out",queue:false,duration:n.duration,debug:n.debug,verbose:n.verbose,onComplete:function(){U.reset();A.call(Q,S);n.onHidden.call(Q,S)}})}else{U.error(N.noTransition)}}},get:{html:function(){q.removeData(m.html);return q.data(m.html)||n.html},title:function(){q.removeData(m.title);return q.data(m.title)||n.title},content:function(){q.removeData(m.content);return q.data(m.content)||q.attr("title")||n.content},variation:function(){q.removeData(m.variation);return q.data(m.variation)||n.variation},calculations:function(){var B=P[0],A=(n.inline||n.popup)?P.position():P.offset(),D={},C;D={target:{element:P[0],width:P.outerWidth(),height:P.outerHeight(),top:A.top,left:A.left,margin:{}},popup:{width:Q.outerWidth(),height:Q.outerHeight()},parent:{width:j.outerWidth(),height:j.outerHeight()},screen:{scroll:{top:y.scrollTop(),left:y.scrollLeft()},width:y.width(),height:y.height()}};D.target.margin.top=(n.inline)?parseInt(e.getComputedStyle(B).getPropertyValue("margin-top"),10):0;D.target.margin.left=(n.inline)?U.is.rtl()?parseInt(e.getComputedStyle(B).getPropertyValue("margin-right"),10):parseInt(e.getComputedStyle(B).getPropertyValue("margin-left"),10):0;C=D.screen;D.boundary={top:C.scroll.top,bottom:C.scroll.top+C.height,left:C.scroll.left,right:C.scroll.left+C.width};return D},id:function(){return V},startEvent:function(){if(n.on=="hover"){return"mouseenter"}else{if(n.on=="focus"){return"focus"}}return false},scrollEvent:function(){return"scroll"},endEvent:function(){if(n.on=="hover"){return"mouseleave"}else{if(n.on=="focus"){return"blur"}}return false},offsetParent:function(F){var A=(F!==g)?F[0]:q[0],G=A.parentNode,C=h(G);if(G){var B=(C.css("transform")==="none"),E=(C.css("position")==="static"),D=C.is("html");while(G&&!D&&E&&B){G=G.parentNode;C=h(G);B=(C.css("transform")==="none");E=(C.css("position")==="static");D=C.is("html")}}return(C&&C.length>0)?C:h()},offstagePosition:function(G,E){var B=Q.offset(),C={},D=[],F,A;G=G||false;E=E||U.get.calculations();F=E.popup;A=E.boundary;if(B&&G){C={top:(B.top<A.top),bottom:(B.top+F.height>A.bottom),right:(B.left+F.width>A.right),left:(B.left<A.left)};U.verbose("Offstage positions determined",B,C)}h.each(C,function(H,I){if(I){D.push(H)}});return(D.length>0)?D.join(" "):false},positions:function(){return{"top left":false,"top center":false,"top right":false,"bottom left":false,"bottom center":false,"bottom right":false,"left center":false,"right center":false}},nextPosition:function(H){var I=H.split(" "),D=I[0],J=I[1],F={top:"bottom",bottom:"top",left:"right",right:"left"},A={left:"center",center:"right",right:"left"},E={"top left":"top center","top center":"top right","top right":"right center","right center":"bottom right","bottom right":"bottom center","bottom center":"bottom left","bottom left":"left center","left center":"top left"},K=(D=="top"||D=="bottom"),C=false,B=false,G=false;if(!o){U.verbose("All available positions available");o=U.get.positions()}U.debug("Recording last position tried",H);o[H]=true;if(n.prefer==="opposite"){G=[F[D],J];G=G.join(" ");C=(o[G]===true);U.debug("Trying opposite strategy",G)}if((n.prefer==="adjacent")&&K){G=[D,A[J]];G=G.join(" ");B=(o[G]===true);U.debug("Trying adjacent strategy",G)}if(B||C){U.debug("Using backup position",G);G=E[H]}return G}},set:{position:function(E,H){if(P.length===0||Q.length===0){U.error(N.notFound);return}var F,G,D,I,B,C,A,J;H=H||U.get.calculations();E=E||q.data(m.position)||n.position;F=q.data(m.offset)||n.offset;G=n.distanceAway;D=H.target;I=H.popup;B=H.parent;if(D.width===0&&D.height===0){U.debug("Popup target is hidden, no action taken");return false}if(n.inline){U.debug("Adding margin to calculation",D.margin);if(E=="left center"||E=="right center"){F+=D.margin.top;G+=-D.margin.left}else{if(E=="top left"||E=="top center"||E=="top right"){F+=D.margin.left;G-=D.margin.top}else{F+=D.margin.left;G+=D.margin.top}}}U.debug("Determining popup position from calculations",E,H);if(U.is.rtl()){E=E.replace(/left|right/g,function(K){return(K=="left")?"right":"left"});U.debug("RTL: Popup position updated",E)}if(k==n.maxSearchDepth&&n.lastResort){U.debug('Using "last resort" position to display',n.lastResort);E=n.lastResort}switch(E){case"top left":A={top:"auto",bottom:B.height-D.top+G,left:D.left+F,right:"auto"};break;case"top center":A={bottom:B.height-D.top+G,left:D.left+(D.width/2)-(I.width/2)+F,top:"auto",right:"auto"};break;case"top right":A={bottom:B.height-D.top+G,right:B.width-D.left-D.width-F,top:"auto",left:"auto"};break;case"left center":A={top:D.top+(D.height/2)-(I.height/2)+F,right:B.width-D.left+G,left:"auto",bottom:"auto"};break;case"right center":A={top:D.top+(D.height/2)-(I.height/2)+F,left:D.left+D.width+G,bottom:"auto",right:"auto"};break;case"bottom left":A={top:D.top+D.height+G,left:D.left+F,bottom:"auto",right:"auto"};break;case"bottom center":A={top:D.top+D.height+G,left:D.left+(D.width/2)-(I.width/2)+F,bottom:"auto",right:"auto"};break;case"bottom right":A={top:D.top+D.height+G,right:B.width-D.left-D.width-F,left:"auto",bottom:"auto"};break}if(A===g){U.error(N.invalidPosition,E)}U.debug("Calculated popup positioning values",A);Q.css(A).removeClass(R.position).addClass(E).addClass(R.loading);J=U.get.offstagePosition(E,H);if(J){U.debug("Popup cant fit into viewport",E,J);if(k<n.maxSearchDepth){k++;E=U.get.nextPosition(E);U.debug("Trying new position",E);return(Q)?U.set.position(E,H):false}else{if(!n.lastResort){U.debug("Popup could not find a position in view",Q);U.remove.attempts();U.remove.loading();U.reset();return false}}}U.debug("Position is on stage",E);U.remove.attempts();U.set.fluidWidth(H);U.remove.loading();return true},fluidWidth:function(A){A=A||U.get.calculations();if(n.setFluidWidth&&Q.hasClass(R.fluid)){Q.css("width",A.parent.width)}},visible:function(){q.addClass(R.visible)}},remove:{loading:function(){Q.removeClass(R.loading)},visible:function(){q.removeClass(R.visible)},attempts:function(){U.verbose("Resetting all searched positions");k=0;o=false}},bind:{events:function(){U.debug("Binding popup events to module");if(n.on=="click"){q.on("click"+O,U.toggle)}if(n.on=="hover"&&t){q.on("touchstart"+O,U.event.touchstart)}else{if(U.get.startEvent()){q.on(U.get.startEvent()+O,U.event.start).on(U.get.endEvent()+O,U.event.end)}}if(n.target){U.debug("Target set to element",P)}y.on("resize"+M,U.event.resize)},popup:function(){U.verbose("Allowing hover events on popup to prevent closing");if(Q&&U.has.popup()){Q.on("mouseenter"+O,U.event.start).on("mouseleave"+O,U.event.end)}},close:function(){if(n.hideOnScroll===true||(n.hideOnScroll=="auto"&&n.on!="click")){v.one(U.get.scrollEvent()+M,U.event.hideGracefully);T.one(U.get.scrollEvent()+M,U.event.hideGracefully)}if(n.on=="hover"&&i){U.verbose("Binding popup close event to document");v.on("touchstart"+M,function(A){U.verbose("Touched away from popup");U.event.hideGracefully.call(S,A)})}if(n.on=="click"&&n.closable){U.verbose("Binding popup close event to document");v.on("click"+M,function(A){U.verbose("Clicked away from popup");U.event.hideGracefully.call(S,A)})}}},unbind:{close:function(){if(n.hideOnScroll===true||(n.hideOnScroll=="auto"&&n.on!="click")){v.off("scroll"+M,U.hide);T.off("scroll"+M,U.hide)}if(n.on=="hover"&&i){v.off("touchstart"+M);i=false}if(n.on=="click"&&n.closable){U.verbose("Removing close event from document");v.off("click"+M)}}},has:{popup:function(){return(Q&&Q.length>0)}},is:{active:function(){return q.hasClass(R.active)},animating:function(){return(Q&&Q.hasClass(R.animating))},visible:function(){return Q&&Q.hasClass(R.visible)},dropdown:function(){return q.hasClass(R.dropdown)},hidden:function(){return !U.is.visible()},rtl:function(){return q.css("direction")=="rtl"}},reset:function(){U.remove.visible();if(n.preserve){if(h.fn.transition!==g){Q.transition("remove transition")}}else{U.removePopup()}},setting:function(B,A){if(h.isPlainObject(B)){h.extend(true,n,B)}else{if(A!==g){n[B]=A}else{return n[B]}}},internal:function(B,A){if(h.isPlainObject(B)){h.extend(true,U,B)}else{if(A!==g){U[B]=A}else{return U[B]}}},debug:function(){if(n.debug){if(n.performance){U.performance.log(arguments)}else{U.debug=Function.prototype.bind.call(console.info,console,n.name+":");U.debug.apply(console,arguments)}}},verbose:function(){if(n.verbose&&n.debug){if(n.performance){U.performance.log(arguments)}else{U.verbose=Function.prototype.bind.call(console.info,console,n.name+":");U.verbose.apply(console,arguments)}}},error:function(){U.error=Function.prototype.bind.call(console.error,console,n.name+":");U.error.apply(console,arguments)},performance:{log:function(B){var C,A,D;if(n.performance){C=new Date().getTime();D=x||C;A=C-D;x=C;d.push({Name:B[0],Arguments:[].slice.call(B,1)||"",Element:S,"Execution Time":A})}clearTimeout(U.performance.timer);U.performance.timer=setTimeout(U.performance.display,500)},display:function(){var A=n.name+":",B=0;x=false;clearTimeout(U.performance.timer);h.each(d,function(D,C){B+=C["Execution Time"]});A+=" "+B+"ms";if(s){A+=" '"+s+"'"}if((console.group!==g||console.table!==g)&&d.length>0){console.groupCollapsed(A);if(console.table){console.table(d)}else{h.each(d,function(D,C){console.log(C.Name+": "+C["Execution Time"]+"ms")})}console.groupEnd()}d=[]}},invoke:function(B,F,D){var E=l,A,C,G;F=F||b;D=S||D;if(typeof B=="string"&&E!==g){B=B.split(/[\. ]/);A=B.length-1;h.each(B,function(H,I){var J=(H!=A)?I+B[H+1].charAt(0).toUpperCase()+B[H+1].slice(1):B;if(h.isPlainObject(E[J])&&(H!=A)){E=E[J]}else{if(E[J]!==g){C=E[J];return false}else{if(h.isPlainObject(E[I])&&(H!=A)){E=E[I]}else{if(E[I]!==g){C=E[I];return false}else{return false}}}}})}if(h.isFunction(C)){G=C.apply(D,F)}else{if(C!==g){G=C}}if(h.isArray(w)){w.push(G)}else{if(w!==g){w=[w,G]}else{if(G!==g){w=G}}}return C}};if(z){if(l===g){U.initialize()}U.invoke(r)}else{if(l!==g){l.invoke("destroy")}U.initialize()}});return(w!==g)?w:this};h.fn.popup.settings={name:"Popup",debug:false,verbose:false,performance:true,namespace:"popup",onCreate:function(){},onRemove:function(){},onShow:function(){},onVisible:function(){},onHide:function(){},onHidden:function(){},on:"hover",addTouchEvents:true,position:"top left",variation:"",movePopup:true,target:false,popup:false,inline:false,preserve:true,hoverable:false,content:false,html:false,title:false,closable:true,hideOnScroll:"auto",exclusive:false,context:"body",prefer:"opposite",lastResort:false,delay:{show:50,hide:70},setFluidWidth:true,duration:200,transition:"scale",distanceAway:0,offset:0,maxSearchDepth:20,error:{invalidPosition:"The position you specified is not a valid position",cannotPlace:"No visible position could be found for the popup",method:"The method you called is not defined.",noTransition:"This module requires ui transitions <https://github.com/Semantic-Org/UI-Transition>",notFound:"The target or popup you specified does not exist on the page"},metadata:{activator:"activator",content:"content",html:"html",offset:"offset",position:"position",title:"title",variation:"variation"},className:{active:"active",animating:"animating",dropdown:"dropdown",fluid:"fluid",loading:"loading",popup:"ui popup",position:"top left center bottom right",visible:"visible"},selector:{popup:".ui.popup"},templates:{escape:function(d){var b=/[&<>"'`]/g,a=/[&<>"'`]/,c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},j=function(i){return c[i]};if(a.test(d)){return d.replace(b,j)}return d},popup:function(a){var c="",b=h.fn.popup.settings.templates.escape;if(typeof a!==g){if(typeof a.title!==g&&a.title){a.title=b(a.title);c+='<div class="header">'+a.title+"</div>"}if(typeof a.content!==g&&a.content){a.content=b(a.content);c+='<div class="content">'+a.content+"</div>"}}return c}}}})(jQuery,window,document);