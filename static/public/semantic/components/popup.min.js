/*!
 * # Semantic UI x.x - Popup
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(c,b,a,d){c.fn.popup=function(q){var o=c(this),i=c(a),f=c(b),j=c("body"),l=o.selector||"",k=("ontouchstart" in a.documentElement),g=new Date().getTime(),n=[],m=arguments[0],e=(typeof m=="string"),p=[].slice.call(arguments,1),h;o.each(function(){var I=(c.isPlainObject(q))?c.extend(true,{},c.fn.popup.settings,q):c.extend({},c.fn.popup.settings),H=I.selector,t=I.className,G=I.error,y=I.metadata,A=I.namespace,F="."+I.namespace,B="module-"+A,w=c(this),D=c(I.context),u=(I.target)?c(I.target):w,E,K,z=0,x=false,L=false,s=this,J=w.data(B),v,C,r;r={initialize:function(){r.debug("Initializing",w);r.createID();r.bind.events();if(!r.exists()&&I.preserve){r.create()}r.instantiate()},instantiate:function(){r.verbose("Storing instance",r);J=r;w.data(B,J)},refresh:function(){if(I.popup){E=c(I.popup).eq(0)}else{if(I.inline){E=u.next(H.popup).eq(0);I.popup=E}}if(I.popup){E.addClass(t.loading);K=r.get.offsetParent();E.removeClass(t.loading);if(I.movePopup&&r.has.popup()&&r.get.offsetParent(E)[0]!==K[0]){r.debug("Moving popup to the same offset parent as activating element");E.detach().appendTo(K)}}else{K=(I.inline)?r.get.offsetParent(u):r.has.popup()?r.get.offsetParent(E):j}if(K.is("html")){r.debug("Setting page as offset parent");K=j}},reposition:function(){r.refresh();r.set.position()},destroy:function(){r.debug("Destroying previous module");if(E&&!I.preserve){r.removePopup()}clearTimeout(r.hideTimer);clearTimeout(r.showTimer);f.off(v);w.off(F).removeData(B)},event:{start:function(N){var M=(c.isPlainObject(I.delay))?I.delay.show:I.delay;clearTimeout(r.hideTimer);r.showTimer=setTimeout(r.show,M)},end:function(){var M=(c.isPlainObject(I.delay))?I.delay.hide:I.delay;clearTimeout(r.showTimer);r.hideTimer=setTimeout(r.hide,M)},touchstart:function(M){L=true;r.event.start()},resize:function(){if(r.is.visible()){r.set.position()}},hideGracefully:function(M){if(M&&c(M.target).closest(H.popup).length===0){r.debug("Click occurred outside popup hiding popup");r.hide()}else{r.debug("Click was inside popup, keeping popup open")}}},create:function(){var N=r.get.html(),M=r.get.variation(),P=r.get.title(),O=r.get.content();if(N||O||P){r.debug("Creating pop-up html");if(!N){N=I.templates.popup({title:P,content:O})}E=c("<div/>").addClass(t.popup).addClass(M).data(y.activator,w).html(N);if(M){E.addClass(M)}if(I.inline){r.verbose("Inserting popup element inline",E);E.insertAfter(w)}else{r.verbose("Appending popup element to body",E);E.appendTo(D)}r.refresh();if(I.hoverable){r.bind.popup()}I.onCreate.call(E,s)}else{if(u.next(H.popup).length!==0){r.verbose("Pre-existing popup found");I.inline=true;I.popups=u.next(H.popup).data(y.activator,w);r.refresh();if(I.hoverable){r.bind.popup()}}else{if(I.popup){c(I.popup).data(y.activator,w);r.verbose("Used popup specified in settings");r.refresh();if(I.hoverable){r.bind.popup()}}else{r.debug("No content specified skipping display",s)}}}},createID:function(){C=(Math.random().toString(16)+"000000000").substr(2,8);v="."+C;r.verbose("Creating unique id for element",C)},toggle:function(){r.debug("Toggling pop-up");if(r.is.hidden()){r.debug("Popup is hidden, showing pop-up");r.unbind.close();r.show()}else{r.debug("Popup is visible, hiding pop-up");r.hide()}},show:function(M){M=M||function(){};r.debug("Showing pop-up",I.transition);if(r.is.hidden()&&!(r.is.active()&&r.is.dropdown())){if(!r.exists()){r.create()}if(I.onShow.call(E,s)===false){r.debug("onShow callback returned false, cancelling popup animation");return}else{if(!I.preserve&&!I.popup){r.refresh()}}if(E&&r.set.position()){r.save.conditions();if(I.exclusive){r.hideAll()}r.animate.show(M)}}},hide:function(M){M=M||function(){};if(r.is.visible()||r.is.animating()){if(I.onHide.call(E,s)===false){r.debug("onHide callback returned false, cancelling popup animation");return}r.remove.visible();r.unbind.close();r.restore.conditions();r.animate.hide(M)}},hideAll:function(){c(H.popup).filter("."+t.visible).each(function(){c(this).data(y.activator).popup("hide")})},exists:function(){if(!E){return false}if(I.inline||I.popup){return(r.has.popup())}else{return(E.closest(D).length>=1)?true:false}},removePopup:function(){r.debug("Removing popup",E);if(r.has.popup()&&!I.popup){E.remove();E=d}I.onRemove.call(E,s)},save:{conditions:function(){r.cache={title:w.attr("title")};if(r.cache.title){w.removeAttr("title")}r.verbose("Saving original attributes",r.cache.title)}},restore:{conditions:function(){if(r.cache&&r.cache.title){w.attr("title",r.cache.title);r.verbose("Restoring original attributes",r.cache.title)}return true}},animate:{show:function(M){M=c.isFunction(M)?M:function(){};if(I.transition&&c.fn.transition!==d&&w.transition("is supported")){r.set.visible();E.transition({animation:I.transition+" in",queue:false,debug:I.debug,verbose:I.verbose,duration:I.duration,onComplete:function(){r.bind.close();M.call(E,s);I.onVisible.call(E,s)}})}else{r.error(G.noTransition)}},hide:function(M){M=c.isFunction(M)?M:function(){};r.debug("Hiding pop-up");if(I.onShow.call(E,s)===false){r.debug("onShow callback returned false, cancelling popup animation");return}if(I.transition&&c.fn.transition!==d&&w.transition("is supported")){E.transition({animation:I.transition+" out",queue:false,duration:I.duration,debug:I.debug,verbose:I.verbose,onComplete:function(){r.reset();M.call(E,s);I.onHidden.call(E,s)}})}else{r.error(G.noTransition)}}},get:{html:function(){w.removeData(y.html);return w.data(y.html)||I.html},title:function(){w.removeData(y.title);return w.data(y.title)||I.title},content:function(){w.removeData(y.content);return w.data(y.content)||w.attr("title")||I.content},variation:function(){w.removeData(y.variation);return w.data(y.variation)||I.variation},calculations:function(){var O=u[0],P=(I.inline||I.popup)?u.position():u.offset(),M={},N;M={target:{element:u[0],width:u.outerWidth(),height:u.outerHeight(),top:P.top,left:P.left,margin:{}},popup:{width:E.outerWidth(),height:E.outerHeight()},parent:{width:K.outerWidth(),height:K.outerHeight()},screen:{scroll:{top:f.scrollTop(),left:f.scrollLeft()},width:f.width(),height:f.height()}};M.target.margin.top=(I.inline)?parseInt(b.getComputedStyle(O).getPropertyValue("margin-top"),10):0;M.target.margin.left=(I.inline)?r.is.rtl()?parseInt(b.getComputedStyle(O).getPropertyValue("margin-right"),10):parseInt(b.getComputedStyle(O).getPropertyValue("margin-left"),10):0;N=M.screen;M.boundary={top:N.scroll.top,bottom:N.scroll.top+N.height,left:N.scroll.left,right:N.scroll.left+N.width};return M},id:function(){return C},startEvent:function(){if(I.on=="hover"){return"mouseenter"}else{if(I.on=="focus"){return"focus"}}return false},scrollEvent:function(){return"scroll"},endEvent:function(){if(I.on=="hover"){return"mouseleave"}else{if(I.on=="focus"){return"blur"}}return false},offsetParent:function(N){var S=(N!==d)?N[0]:w[0],M=S.parentNode,Q=c(M);if(M){var R=(Q.css("transform")==="none"),O=(Q.css("position")==="static"),P=Q.is("html");while(M&&!P&&O&&R){M=M.parentNode;Q=c(M);R=(Q.css("transform")==="none");O=(Q.css("position")==="static");P=Q.is("html")}}return(Q&&Q.length>0)?Q:c()},offstagePosition:function(M,O){var R=E.offset(),Q={},P=[],N,S;M=M||false;O=O||r.get.calculations();N=O.popup;S=O.boundary;if(R&&M){Q={top:(R.top<S.top),bottom:(R.top+N.height>S.bottom),right:(R.left+N.width>S.right),left:(R.left<S.left)};r.verbose("Offstage positions determined",R,Q)}c.each(Q,function(U,T){if(T){P.push(U)}});return(P.length>0)?P.join(" "):false},positions:function(){return{"top left":false,"top center":false,"top right":false,"bottom left":false,"bottom center":false,"bottom right":false,"left center":false,"right center":false}},nextPosition:function(P){var O=P.split(" "),T=O[0],N=O[1],R={top:"bottom",bottom:"top",left:"right",right:"left"},W={left:"center",center:"right",right:"left"},S={"top left":"top center","top center":"top right","top right":"right center","right center":"bottom right","bottom right":"bottom center","bottom center":"bottom left","bottom left":"left center","left center":"top left"},M=(T=="top"||T=="bottom"),U=false,V=false,Q=false;if(!x){r.verbose("All available positions available");x=r.get.positions()}r.debug("Recording last position tried",P);x[P]=true;if(I.prefer==="opposite"){Q=[R[T],N];Q=Q.join(" ");U=(x[Q]===true);r.debug("Trying opposite strategy",Q)}if((I.prefer==="adjacent")&&M){Q=[T,W[N]];Q=Q.join(" ");V=(x[Q]===true);r.debug("Trying adjacent strategy",Q)}if(V||U){r.debug("Using backup position",Q);Q=S[P]}return Q}},set:{position:function(R,O){if(u.length===0||E.length===0){r.error(G.notFound);return}var Q,P,S,N,U,T,V,M;O=O||r.get.calculations();R=R||w.data(y.position)||I.position;Q=w.data(y.offset)||I.offset;P=I.distanceAway;S=O.target;N=O.popup;U=O.parent;if(S.width===0&&S.height===0){r.debug("Popup target is hidden, no action taken");return false}if(I.inline){r.debug("Adding margin to calculation",S.margin);if(R=="left center"||R=="right center"){Q+=S.margin.top;P+=-S.margin.left}else{if(R=="top left"||R=="top center"||R=="top right"){Q+=S.margin.left;P-=S.margin.top}else{Q+=S.margin.left;P+=S.margin.top}}}r.debug("Determining popup position from calculations",R,O);if(r.is.rtl()){R=R.replace(/left|right/g,function(W){return(W=="left")?"right":"left"});r.debug("RTL: Popup position updated",R)}if(z==I.maxSearchDepth&&I.lastResort){r.debug('Using "last resort" position to display',I.lastResort);R=I.lastResort}switch(R){case"top left":V={top:"auto",bottom:U.height-S.top+P,left:S.left+Q,right:"auto"};break;case"top center":V={bottom:U.height-S.top+P,left:S.left+(S.width/2)-(N.width/2)+Q,top:"auto",right:"auto"};break;case"top right":V={bottom:U.height-S.top+P,right:U.width-S.left-S.width-Q,top:"auto",left:"auto"};break;case"left center":V={top:S.top+(S.height/2)-(N.height/2)+Q,right:U.width-S.left+P,left:"auto",bottom:"auto"};break;case"right center":V={top:S.top+(S.height/2)-(N.height/2)+Q,left:S.left+S.width+P,bottom:"auto",right:"auto"};break;case"bottom left":V={top:S.top+S.height+P,left:S.left+Q,bottom:"auto",right:"auto"};break;case"bottom center":V={top:S.top+S.height+P,left:S.left+(S.width/2)-(N.width/2)+Q,bottom:"auto",right:"auto"};break;case"bottom right":V={top:S.top+S.height+P,right:U.width-S.left-S.width-Q,left:"auto",bottom:"auto"};break}if(V===d){r.error(G.invalidPosition,R)}r.debug("Calculated popup positioning values",V);E.css(V).removeClass(t.position).addClass(R).addClass(t.loading);M=r.get.offstagePosition(R,O);if(M){r.debug("Popup cant fit into viewport",R,M);if(z<I.maxSearchDepth){z++;R=r.get.nextPosition(R);r.debug("Trying new position",R);return(E)?r.set.position(R,O):false}else{if(!I.lastResort){r.debug("Popup could not find a position in view",E);r.remove.attempts();r.remove.loading();r.reset();return false}}}r.debug("Position is on stage",R);r.remove.attempts();r.set.fluidWidth(O);r.remove.loading();return true},fluidWidth:function(M){M=M||r.get.calculations();if(I.setFluidWidth&&E.hasClass(t.fluid)){E.css("width",M.parent.width)}},visible:function(){w.addClass(t.visible)}},remove:{loading:function(){E.removeClass(t.loading)},visible:function(){w.removeClass(t.visible)},attempts:function(){r.verbose("Resetting all searched positions");z=0;x=false}},bind:{events:function(){r.debug("Binding popup events to module");if(I.on=="click"){w.on("click"+F,r.toggle)}if(I.on=="hover"&&k){w.on("touchstart"+F,r.event.touchstart)}else{if(r.get.startEvent()){w.on(r.get.startEvent()+F,r.event.start).on(r.get.endEvent()+F,r.event.end)}}if(I.target){r.debug("Target set to element",u)}f.on("resize"+v,r.event.resize)},popup:function(){r.verbose("Allowing hover events on popup to prevent closing");if(E&&r.has.popup()){E.on("mouseenter"+F,r.event.start).on("mouseleave"+F,r.event.end)}},close:function(){if(I.hideOnScroll===true||(I.hideOnScroll=="auto"&&I.on!="click")){i.one(r.get.scrollEvent()+v,r.event.hideGracefully);D.one(r.get.scrollEvent()+v,r.event.hideGracefully)}if(I.on=="hover"&&L){r.verbose("Binding popup close event to document");i.on("touchstart"+v,function(M){r.verbose("Touched away from popup");r.event.hideGracefully.call(s,M)})}if(I.on=="click"&&I.closable){r.verbose("Binding popup close event to document");i.on("click"+v,function(M){r.verbose("Clicked away from popup");r.event.hideGracefully.call(s,M)})}}},unbind:{close:function(){if(I.hideOnScroll===true||(I.hideOnScroll=="auto"&&I.on!="click")){i.off("scroll"+v,r.hide);D.off("scroll"+v,r.hide)}if(I.on=="hover"&&L){i.off("touchstart"+v);L=false}if(I.on=="click"&&I.closable){r.verbose("Removing close event from document");i.off("click"+v)}}},has:{popup:function(){return(E&&E.length>0)}},is:{active:function(){return w.hasClass(t.active)},animating:function(){return(E&&E.hasClass(t.animating))},visible:function(){return E&&E.hasClass(t.visible)},dropdown:function(){return w.hasClass(t.dropdown)},hidden:function(){return !r.is.visible()},rtl:function(){return w.css("direction")=="rtl"}},reset:function(){r.remove.visible();if(I.preserve){if(c.fn.transition!==d){E.transition("remove transition")}}else{r.removePopup()}},setting:function(M,N){if(c.isPlainObject(M)){c.extend(true,I,M)}else{if(N!==d){I[M]=N}else{return I[M]}}},internal:function(M,N){if(c.isPlainObject(M)){c.extend(true,r,M)}else{if(N!==d){r[M]=N}else{return r[M]}}},debug:function(){if(I.debug){if(I.performance){r.performance.log(arguments)}else{r.debug=Function.prototype.bind.call(console.info,console,I.name+":");r.debug.apply(console,arguments)}}},verbose:function(){if(I.verbose&&I.debug){if(I.performance){r.performance.log(arguments)}else{r.verbose=Function.prototype.bind.call(console.info,console,I.name+":");r.verbose.apply(console,arguments)}}},error:function(){r.error=Function.prototype.bind.call(console.error,console,I.name+":");r.error.apply(console,arguments)},performance:{log:function(O){var N,P,M;if(I.performance){N=new Date().getTime();M=g||N;P=N-M;g=N;n.push({Name:O[0],Arguments:[].slice.call(O,1)||"",Element:s,"Execution Time":P})}clearTimeout(r.performance.timer);r.performance.timer=setTimeout(r.performance.display,500)},display:function(){var N=I.name+":",M=0;g=false;clearTimeout(r.performance.timer);c.each(n,function(O,P){M+=P["Execution Time"]});N+=" "+M+"ms";if(l){N+=" '"+l+"'"}if((console.group!==d||console.table!==d)&&n.length>0){console.groupCollapsed(N);if(console.table){console.table(n)}else{c.each(n,function(O,P){console.log(P.Name+": "+P["Execution Time"]+"ms")})}console.groupEnd()}n=[]}},invoke:function(R,N,P){var O=J,S,Q,M;N=N||p;P=s||P;if(typeof R=="string"&&O!==d){R=R.split(/[\. ]/);S=R.length-1;c.each(R,function(V,U){var T=(V!=S)?U+R[V+1].charAt(0).toUpperCase()+R[V+1].slice(1):R;if(c.isPlainObject(O[T])&&(V!=S)){O=O[T]}else{if(O[T]!==d){Q=O[T];return false}else{if(c.isPlainObject(O[U])&&(V!=S)){O=O[U]}else{if(O[U]!==d){Q=O[U];return false}else{return false}}}}})}if(c.isFunction(Q)){M=Q.apply(P,N)}else{if(Q!==d){M=Q}}if(c.isArray(h)){h.push(M)}else{if(h!==d){h=[h,M]}else{if(M!==d){h=M}}}return Q}};if(e){if(J===d){r.initialize()}r.invoke(m)}else{if(J!==d){J.invoke("destroy")}r.initialize()}});return(h!==d)?h:this};c.fn.popup.settings={name:"Popup",debug:false,verbose:false,performance:true,namespace:"popup",onCreate:function(){},onRemove:function(){},onShow:function(){},onVisible:function(){},onHide:function(){},onHidden:function(){},on:"hover",addTouchEvents:true,position:"top left",variation:"",movePopup:true,target:false,popup:false,inline:false,preserve:true,hoverable:false,content:false,html:false,title:false,closable:true,hideOnScroll:"auto",exclusive:false,context:"body",prefer:"opposite",lastResort:false,delay:{show:50,hide:70},setFluidWidth:true,duration:200,transition:"scale",distanceAway:0,offset:0,maxSearchDepth:20,error:{invalidPosition:"The position you specified is not a valid position",cannotPlace:"No visible position could be found for the popup",method:"The method you called is not defined.",noTransition:"This module requires ui transitions <https://github.com/Semantic-Org/UI-Transition>",notFound:"The target or popup you specified does not exist on the page"},metadata:{activator:"activator",content:"content",html:"html",offset:"offset",position:"position",title:"title",variation:"variation"},className:{active:"active",animating:"animating",dropdown:"dropdown",fluid:"fluid",loading:"loading",popup:"ui popup",position:"top left center bottom right",visible:"visible"},selector:{popup:".ui.popup"},templates:{escape:function(f){var h=/[&<>"'`]/g,i=/[&<>"'`]/,g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},e=function(j){return g[j]};if(i.test(f)){return f.replace(h,e)}return f},popup:function(g){var e="",f=c.fn.popup.settings.templates.escape;if(typeof g!==d){if(typeof g.title!==d&&g.title){g.title=f(g.title);e+='<div class="header">'+g.title+"</div>"}if(typeof g.content!==d&&g.content){g.content=f(g.content);e+='<div class="content">'+g.content+"</div>"}}return e}}}})(jQuery,window,document);