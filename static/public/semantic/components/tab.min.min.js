/*!
 * # Semantic UI x.x - Tab
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(h,e,f,g){h.fn.tab=function(a){var c=h.isFunction(this)?h(e):h(this),p=c.selector||"",r=new Date().getTime(),d=[],o=arguments[0],t=(typeof o=="string"),b=[].slice.call(arguments,1),s=false,q;c.each(function(){var J=(h.isPlainObject(a))?h.extend(true,{},h.fn.tab.settings,a):h.extend({},h.fn.tab.settings),L=J.className,l=J.metadata,N=J.selector,Q=J.error,R="."+J.namespace,k="module-"+J.namespace,K=h(this),i,S,j={},n=true,T=0,O=this,I=K.data(k),M,m,P,H;P={initialize:function(){P.debug("Initializing tab menu item",K);P.fix.callbacks();P.determineTabs();P.debug("Determining tabs",J.context,S);if(J.auto){P.set.auto()}P.bind.events();if(J.history&&!s){P.initializeHistory();s=true}P.instantiate()},instantiate:function(){P.verbose("Storing instance of module",P);I=P;K.data(k,P)},destroy:function(){P.debug("Destroying tabs",K);K.removeData(k).off(R)},bind:{events:function(){if(!h.isWindow(O)){P.debug("Attaching tab activation events to element",K);K.on("click"+R,P.event.click)}}},determineTabs:function(){var u;if(J.context==="parent"){if(K.closest(N.ui).length>0){u=K.closest(N.ui);P.verbose("Using closest UI element as parent",u)}else{u=K}i=u.parent();P.verbose("Determined parent element for creating context",i)}else{if(J.context){i=h(J.context);P.verbose("Using selector for tab context",J.context,i)}else{i=h("body")}}if(J.childrenOnly){S=i.children(N.tabs);P.debug("Searching tab context children for tabs",i,S)}else{S=i.find(N.tabs);P.debug("Searching tab context for tabs",i,S)}},fix:{callbacks:function(){if(h.isPlainObject(a)&&(a.onTabLoad||a.onTabInit)){if(a.onTabLoad){a.onLoad=a.onTabLoad;delete a.onTabLoad;P.error(Q.legacyLoad,a.onLoad)}if(a.onTabInit){a.onFirstLoad=a.onTabInit;delete a.onTabInit;P.error(Q.legacyInit,a.onFirstLoad)}J=h.extend(true,{},h.fn.tab.settings,a)}}},initializeHistory:function(){P.debug("Initializing page state");if(h.address===g){P.error(Q.state);return false}else{if(J.historyType=="state"){P.debug("Using HTML5 to manage state");if(J.path!==false){h.address.history(true).state(J.path)}else{P.error(Q.path);return false}}h.address.bind("change",P.event.history.change)}},event:{click:function(u){var v=h(this).data(l.tab);if(v!==g){if(J.history){P.verbose("Updating page state",u);h.address.value(v)}else{P.verbose("Changing tab",u);P.changeTab(v)}u.preventDefault()}else{P.debug("No tab specified")}},history:{change:function(u){var w=u.pathNames.join("/")||P.get.initialPath(),v=J.templates.determineTitle(w)||false;P.performance.display();P.debug("History change event",w,u);H=u;if(w!==g){P.changeTab(w)}if(v){h.address.title(v)}}}},refresh:function(){if(M){P.debug("Refreshing tab",M);P.changeTab(M)}},cache:{read:function(u){return(u!==g)?j[u]:false},add:function(u,v){u=u||M;P.debug("Adding cached content for",u);j[u]=v},remove:function(u){u=u||M;P.debug("Removing cached content for",u);delete j[u]}},set:{auto:function(){var u=(typeof J.path=="string")?J.path.replace(/\/$/,"")+"/{$tab}":"/{$tab}";P.verbose("Setting up automatic tab retrieval from server",u);if(h.isPlainObject(J.apiSettings)){J.apiSettings.url=u}else{J.apiSettings={url:u}}},loading:function(v){var u=P.get.tabElement(v),w=u.hasClass(L.loading);if(!w){P.verbose("Setting loading state for",u);u.addClass(L.loading).siblings(S).removeClass(L.active+" "+L.loading);if(u.length>0){J.onRequest.call(u[0],v)}}},state:function(u){h.address.value(u)}},changeTab:function(w){var y=(e.history&&e.history.pushState),x=(y&&J.ignoreFirstLoad&&n),v=(J.auto||h.isPlainObject(J.apiSettings)),u=(v&&!x)?P.utilities.pathToArray(w):P.get.defaultPathArray(w);w=P.utilities.arrayToPath(u);h.each(u,function(G,X){var A=u.slice(0,G+1),B=P.utilities.arrayToPath(A),Y=P.is.tab(B),F=(G+1==u.length),C=P.get.tabElement(B),z,D,Z,E;P.verbose("Looking for tab",X);if(Y){P.verbose("Tab was found",X);M=B;m=P.utilities.filterArray(u,A);if(F){E=true}else{D=u.slice(0,G+2);Z=P.utilities.arrayToPath(D);E=(!P.is.tab(Z));if(E){P.verbose("Tab parameters found",D)}}if(E&&v){if(!x){P.activate.navigation(B);P.fetch.content(B,w)}else{P.debug("Ignoring remote content on first tab load",B);n=false;P.cache.add(w,C.html());P.activate.all(B);J.onFirstLoad.call(C[0],B,m,H);J.onLoad.call(C[0],B,m,H)}return false}else{P.debug("Opened local tab",B);P.activate.all(B);if(!P.cache.read(B)){P.cache.add(B,true);P.debug("First time tab loaded calling tab init");J.onFirstLoad.call(C[0],B,m,H)}J.onLoad.call(C[0],B,m,H)}}else{if(w.search("/")==-1&&w!==""){z=h("#"+w+', a[name="'+w+'"]');B=z.closest("[data-tab]").data("tab");C=P.get.tabElement(B);if(z&&z.length>0&&B){P.debug("Anchor link used, opening parent tab",C,z);if(!C.hasClass(L.active)){setTimeout(function(){P.scrollTo(z)},0)}P.activate.all(B);if(!P.cache.read(B)){P.cache.add(B,true);P.debug("First time tab loaded calling tab init");J.onFirstLoad.call(C[0],B,m,H)}J.onLoad.call(C[0],B,m,H);return false}}else{P.error(Q.missingTab,K,i,B);return false}}})},scrollTo:function(v){var u=(v&&v.length>0)?v.offset().top:false;if(u!==false){P.debug("Forcing scroll to an in-page link in a hidden tab",u,v);h(f).scrollTop(u)}},update:{content:function(y,x,v){var u=P.get.tabElement(y),w=u[0];v=(v!==g)?v:J.evaluateScripts;if(v){P.debug("Updating HTML and evaluating inline scripts",y,x);u.html(x)}else{P.debug("Updating HTML",y,x);w.innerHTML=x}}},fetch:{content:function(y,z){var u=P.get.tabElement(y),v={dataType:"html",on:"now",cache:J.alwaysRefresh,headers:{"X-Remote":true},onSuccess:function(C){P.cache.add(z,C);P.update.content(y,C);if(y==M){P.debug("Content loaded",y);P.activate.tab(y)}else{P.debug("Content loaded in background",y)}J.onFirstLoad.call(u[0],y,m,H);J.onLoad.call(u[0],y,m,H)},urlData:{tab:z}},w=u.api("get request")||false,A=(w&&w.state()==="pending"),B,x;z=z||y;x=P.cache.read(z);if(J.cache&&x){P.activate.tab(y);P.debug("Adding cached content",z);if(J.evaluateScripts=="once"){P.update.content(y,x,false)}else{P.update.content(y,x)}J.onLoad.call(u[0],y,m,H)}else{if(A){P.set.loading(y);P.debug("Content is already loading",z)}else{if(h.api!==g){B=h.extend(true,{},J.apiSettings,v);P.debug("Retrieving remote content",z,B);P.set.loading(y);u.api(B)}else{P.error(Q.api)}}}}},activate:{all:function(u){P.activate.tab(u);P.activate.navigation(u)},tab:function(w){var u=P.get.tabElement(w),v=u.hasClass(L.active);P.verbose("Showing tab content for",u);if(!v){u.addClass(L.active).siblings(S).removeClass(L.active+" "+L.loading);if(u.length>0){J.onVisible.call(u[0],w)}}},navigation:function(w){var u=P.get.navElement(w),v=u.hasClass(L.active);P.verbose("Activating tab navigation for",u,w);if(!v){u.addClass(L.active).siblings(c).removeClass(L.active+" "+L.loading)}}},deactivate:{all:function(){P.deactivate.navigation();P.deactivate.tabs()},navigation:function(){c.removeClass(L.active)},tabs:function(){S.removeClass(L.active+" "+L.loading)}},is:{tab:function(u){return(u!==g)?(P.get.tabElement(u).length>0):false}},get:{initialPath:function(){return c.eq(0).data(l.tab)||S.eq(0).data(l.tab)},path:function(){return h.address.value()},defaultPathArray:function(u){return P.utilities.pathToArray(P.get.defaultPath(u))},defaultPath:function(w){var u=c.filter("[data-"+l.tab+'^="'+w+'/"]').eq(0),v=u.data(l.tab)||false;if(v){P.debug("Found default tab",v);if(T<J.maxDepth){T++;return P.get.defaultPath(v)}P.error(Q.recursion)}else{P.debug("No default tabs found for",w,S)}T=0;return w},navElement:function(u){u=u||M;return c.filter("[data-"+l.tab+'="'+u+'"]')},tabElement:function(y){var v,w,u,x;y=y||M;u=P.utilities.pathToArray(y);x=P.utilities.last(u);v=S.filter("[data-"+l.tab+'="'+x+'"]');w=S.filter("[data-"+l.tab+'="'+y+'"]');return(v.length>0)?v:w},tab:function(){return M}},utilities:{filterArray:function(u,v){return h.grep(u,function(w){return(h.inArray(w,v)==-1)})},last:function(u){return h.isArray(u)?u[u.length-1]:false},pathToArray:function(u){if(u===g){u=M}return typeof u=="string"?u.split("/"):[u]},arrayToPath:function(u){return h.isArray(u)?u.join("/"):false}},setting:function(v,u){P.debug("Changing setting",v,u);if(h.isPlainObject(v)){h.extend(true,J,v)}else{if(u!==g){J[v]=u}else{return J[v]}}},internal:function(v,u){if(h.isPlainObject(v)){h.extend(true,P,v)}else{if(u!==g){P[v]=u}else{return P[v]}}},debug:function(){if(J.debug){if(J.performance){P.performance.log(arguments)}else{P.debug=Function.prototype.bind.call(console.info,console,J.name+":");P.debug.apply(console,arguments)}}},verbose:function(){if(J.verbose&&J.debug){if(J.performance){P.performance.log(arguments)}else{P.verbose=Function.prototype.bind.call(console.info,console,J.name+":");P.verbose.apply(console,arguments)}}},error:function(){P.error=Function.prototype.bind.call(console.error,console,J.name+":");P.error.apply(console,arguments)},performance:{log:function(v){var w,u,x;if(J.performance){w=new Date().getTime();x=r||w;u=w-x;r=w;d.push({Name:v[0],Arguments:[].slice.call(v,1)||"",Element:O,"Execution Time":u})}clearTimeout(P.performance.timer);P.performance.timer=setTimeout(P.performance.display,500)},display:function(){var u=J.name+":",v=0;r=false;clearTimeout(P.performance.timer);h.each(d,function(x,w){v+=w["Execution Time"]});u+=" "+v+"ms";if(p){u+=" '"+p+"'"}if((console.group!==g||console.table!==g)&&d.length>0){console.groupCollapsed(u);if(console.table){console.table(d)}else{h.each(d,function(x,w){console.log(w.Name+": "+w["Execution Time"]+"ms")})}console.groupEnd()}d=[]}},invoke:function(A,x,v){var w=I,z,u,y;x=x||b;v=O||v;if(typeof A=="string"&&w!==g){A=A.split(/[\. ]/);z=A.length-1;h.each(A,function(B,C){var D=(B!=z)?C+A[B+1].charAt(0).toUpperCase()+A[B+1].slice(1):A;if(h.isPlainObject(w[D])&&(B!=z)){w=w[D]}else{if(w[D]!==g){u=w[D];return false}else{if(h.isPlainObject(w[C])&&(B!=z)){w=w[C]}else{if(w[C]!==g){u=w[C];return false}else{P.error(Q.method,A);return false}}}}})}if(h.isFunction(u)){y=u.apply(v,x)}else{if(u!==g){y=u}}if(h.isArray(q)){q.push(y)}else{if(q!==g){q=[q,y]}else{if(y!==g){q=y}}}return u}};if(t){if(I===g){P.initialize()}P.invoke(o)}else{if(I!==g){I.invoke("destroy")}P.initialize()}});return(q!==g)?q:this};h.tab=function(){h(e).tab.apply(this,arguments)};h.fn.tab.settings={name:"Tab",namespace:"tab",debug:false,verbose:false,performance:true,auto:false,history:false,historyType:"hash",path:false,context:false,childrenOnly:false,maxDepth:25,alwaysRefresh:false,cache:true,ignoreFirstLoad:false,apiSettings:false,evaluateScripts:"once",onFirstLoad:function(c,b,a){},onLoad:function(c,b,a){},onVisible:function(c,b,a){},onRequest:function(c,b,a){},templates:{determineTitle:function(a){}},error:{api:"You attempted to load content without API module",method:"The method you called is not defined",missingTab:"Activated tab cannot be found. Tabs are case-sensitive.",noContent:"The tab you specified is missing a content url.",path:"History enabled, but no path was specified",recursion:"Max recursive depth reached",legacyInit:"onTabInit has been renamed to onFirstLoad in 2.0, please adjust your code.",legacyLoad:"onTabLoad has been renamed to onLoad in 2.0. Please adjust your code",state:"History requires Asual's Address library <https://github.com/asual/jquery-address>"},metadata:{tab:"tab",loaded:"loaded",promise:"promise"},className:{loading:"loading",active:"active"},selector:{tabs:".ui.tab",ui:".ui"}}})(jQuery,window,document);