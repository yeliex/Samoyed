/*!
 * # Semantic UI x.x - Visibility
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(h,e,f,g){h.fn.visibility=function(a){var c=h(this),o=c.selector||"",q=new Date().getTime(),d=[],n=arguments[0],r=(typeof n=="string"),b=[].slice.call(arguments,1),p;c.each(function(){var J=(h.isPlainObject(a))?h.extend(true,{},h.fn.visibility.settings,a):h.extend({},h.fn.visibility.settings),P=J.className,m=J.namespace,O=J.error,F=J.metadata,i="."+m,l="module-"+m,k=h(e),I=h(this),j=h(J.context),H,K=I.selector||"",G=I.data(l),N=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame||function(s){setTimeout(s,0)},Q=this,L=false,M,R;R={initialize:function(){R.debug("Initializing",J);R.setup.cache();if(R.should.trackChanges()){if(J.type=="image"){R.setup.image()}if(J.type=="fixed"){R.setup.fixed()}if(J.observeChanges){R.observeChanges()}R.bind.events()}R.save.position();if(!R.is.visible()){R.error(O.visible,I)}if(J.initialCheck){R.checkVisibility()}R.instantiate()},instantiate:function(){R.debug("Storing instance",R);I.data(l,R);G=R},destroy:function(){R.verbose("Destroying previous module");if(M){M.disconnect()}k.off("load"+i,R.event.load).off("resize"+i,R.event.resize);j.off("scrollchange"+i,R.event.scrollchange);I.off(i).removeData(l)},observeChanges:function(){if("MutationObserver" in e){M=new MutationObserver(function(s){R.verbose("DOM tree modified, updating visibility calculations");R.timer=setTimeout(function(){R.verbose("DOM tree modified, updating sticky menu");R.refresh()},100)});M.observe(Q,{childList:true,subtree:true});R.debug("Setting up mutation observer",M)}},bind:{events:function(){R.verbose("Binding visibility events to scroll and resize");if(J.refreshOnLoad){k.on("load"+i,R.event.load)}k.on("resize"+i,R.event.resize);j.off("scroll"+i).on("scroll"+i,R.event.scroll).on("scrollchange"+i,R.event.scrollchange)}},event:{resize:function(){R.debug("Window resized");if(J.refreshOnResize){N(R.refresh)}},load:function(){R.debug("Page finished loading");N(R.refresh)},scroll:function(){if(J.throttle){clearTimeout(R.timer);R.timer=setTimeout(function(){j.triggerHandler("scrollchange"+i,[j.scrollTop()])},J.throttle)}else{N(function(){j.triggerHandler("scrollchange"+i,[j.scrollTop()])})}},scrollchange:function(s,t){R.checkVisibility(t)}},precache:function(x,s){if(!(x instanceof Array)){x=[x]}var t=x.length,u=0,w=[],y=f.createElement("img"),v=function(){u++;if(u>=x.length){if(h.isFunction(s)){s()}}};while(t--){y=f.createElement("img");y.onload=v;y.onerror=v;y.src=x[t];w.push(y)}},enableCallbacks:function(){R.debug("Allowing callbacks to occur");L=false},disableCallbacks:function(){R.debug("Disabling all callbacks temporarily");L=true},should:{trackChanges:function(){if(r){R.debug("One time query, no need to bind events");return false}R.debug("Callbacks being attached");return true}},setup:{cache:function(){R.cache={occurred:{},screen:{},element:{}}},image:function(){var s=I.data(F.src);if(s){R.verbose("Lazy loading image",s);J.once=true;J.observeChanges=false;J.onOnScreen=function(){R.debug("Image on screen",Q);R.precache(s,function(){R.set.image(s)})}}},fixed:function(){R.debug("Setting up fixed");J.once=false;J.observeChanges=false;J.initialCheck=true;J.refreshOnLoad=true;if(!a.transition){J.transition=false}R.create.placeholder();R.debug("Added placeholder",H);J.onTopPassed=function(){R.debug("Element passed, adding fixed position",I);R.show.placeholder();R.set.fixed();if(J.transition){if(h.fn.transition!==g){I.transition(J.transition,J.duration)}}};J.onTopPassedReverse=function(){R.debug("Element returned to position, removing fixed",I);R.hide.placeholder();R.remove.fixed()}}},create:{placeholder:function(){R.verbose("Creating fixed position placeholder");H=I.clone(false).css("display","none").addClass(P.placeholder).insertAfter(I)}},show:{placeholder:function(){R.verbose("Showing placeholder");H.css("display","block").css("visibility","hidden")}},hide:{placeholder:function(){R.verbose("Hiding placeholder");H.css("display","none").css("visibility","")}},set:{fixed:function(){R.verbose("Setting element to fixed position");I.addClass(P.fixed).css({position:"fixed",top:J.offset+"px",left:"auto",zIndex:"1"})},image:function(s){I.attr("src",s);if(J.transition){if(h.fn.transition!==g){I.transition(J.transition,J.duration)}else{I.fadeIn(J.duration)}}else{I.show()}}},is:{onScreen:function(){var s=R.get.elementCalculations();return s.onScreen},offScreen:function(){var s=R.get.elementCalculations();return s.offScreen},visible:function(){if(R.cache&&R.cache.element){return !(R.cache.element.width===0&&R.cache.element.offset.top===0)}return false}},refresh:function(){R.debug("Refreshing constants (width/height)");if(J.type=="fixed"){R.remove.fixed();R.remove.occurred()}R.reset();R.save.position();if(J.checkOnRefresh){R.checkVisibility()}J.onRefresh.call(Q)},reset:function(){R.verbose("Reseting all cached values");if(h.isPlainObject(R.cache)){R.cache.screen={};R.cache.element={}}},checkVisibility:function(s){R.verbose("Checking visibility of element",R.cache.element);if(!L&&R.is.visible()){R.save.scroll(s);R.save.calculations();R.passed();R.passingReverse();R.topVisibleReverse();R.bottomVisibleReverse();R.topPassedReverse();R.bottomPassedReverse();R.onScreen();R.offScreen();R.passing();R.topVisible();R.bottomVisible();R.topPassed();R.bottomPassed();if(J.onUpdate){J.onUpdate.call(Q,R.get.elementCalculations())}}},passed:function(t,s){var u=R.get.elementCalculations(),v;if(t&&s){J.onPassed[t]=s}else{if(t!==g){return(R.get.pixelsPassed(t)>u.pixelsPassed)}else{if(u.passing){h.each(J.onPassed,function(x,w){if(u.bottomVisible||u.pixelsPassed>R.get.pixelsPassed(x)){R.execute(w,x)}else{if(!J.once){R.remove.occurred(w)}}})}}}},onScreen:function(u){var v=R.get.elementCalculations(),s=u||J.onOnScreen,t="onScreen";if(u){R.debug("Adding callback for onScreen",u);J.onOnScreen=u}if(v.onScreen){R.execute(s,t)}else{if(!J.once){R.remove.occurred(t)}}if(u!==g){return v.onOnScreen}},offScreen:function(u){var v=R.get.elementCalculations(),s=u||J.onOffScreen,t="offScreen";if(u){R.debug("Adding callback for offScreen",u);J.onOffScreen=u}if(v.offScreen){R.execute(s,t)}else{if(!J.once){R.remove.occurred(t)}}if(u!==g){return v.onOffScreen}},passing:function(u){var v=R.get.elementCalculations(),s=u||J.onPassing,t="passing";if(u){R.debug("Adding callback for passing",u);J.onPassing=u}if(v.passing){R.execute(s,t)}else{if(!J.once){R.remove.occurred(t)}}if(u!==g){return v.passing}},topVisible:function(u){var v=R.get.elementCalculations(),s=u||J.onTopVisible,t="topVisible";if(u){R.debug("Adding callback for top visible",u);J.onTopVisible=u}if(v.topVisible){R.execute(s,t)}else{if(!J.once){R.remove.occurred(t)}}if(u===g){return v.topVisible}},bottomVisible:function(u){var v=R.get.elementCalculations(),s=u||J.onBottomVisible,t="bottomVisible";if(u){R.debug("Adding callback for bottom visible",u);J.onBottomVisible=u}if(v.bottomVisible){R.execute(s,t)}else{if(!J.once){R.remove.occurred(t)}}if(u===g){return v.bottomVisible}},topPassed:function(u){var v=R.get.elementCalculations(),s=u||J.onTopPassed,t="topPassed";if(u){R.debug("Adding callback for top passed",u);J.onTopPassed=u}if(v.topPassed){R.execute(s,t)}else{if(!J.once){R.remove.occurred(t)}}if(u===g){return v.topPassed}},bottomPassed:function(u){var v=R.get.elementCalculations(),s=u||J.onBottomPassed,t="bottomPassed";if(u){R.debug("Adding callback for bottom passed",u);J.onBottomPassed=u}if(v.bottomPassed){R.execute(s,t)}else{if(!J.once){R.remove.occurred(t)}}if(u===g){return v.bottomPassed}},passingReverse:function(u){var v=R.get.elementCalculations(),s=u||J.onPassingReverse,t="passingReverse";if(u){R.debug("Adding callback for passing reverse",u);J.onPassingReverse=u}if(!v.passing){if(R.get.occurred("passing")){R.execute(s,t)}}else{if(!J.once){R.remove.occurred(t)}}if(u!==g){return !v.passing}},topVisibleReverse:function(u){var v=R.get.elementCalculations(),s=u||J.onTopVisibleReverse,t="topVisibleReverse";if(u){R.debug("Adding callback for top visible reverse",u);J.onTopVisibleReverse=u}if(!v.topVisible){if(R.get.occurred("topVisible")){R.execute(s,t)}}else{if(!J.once){R.remove.occurred(t)}}if(u===g){return !v.topVisible}},bottomVisibleReverse:function(u){var v=R.get.elementCalculations(),s=u||J.onBottomVisibleReverse,t="bottomVisibleReverse";if(u){R.debug("Adding callback for bottom visible reverse",u);J.onBottomVisibleReverse=u}if(!v.bottomVisible){if(R.get.occurred("bottomVisible")){R.execute(s,t)}}else{if(!J.once){R.remove.occurred(t)}}if(u===g){return !v.bottomVisible}},topPassedReverse:function(u){var v=R.get.elementCalculations(),s=u||J.onTopPassedReverse,t="topPassedReverse";if(u){R.debug("Adding callback for top passed reverse",u);J.onTopPassedReverse=u}if(!v.topPassed){if(R.get.occurred("topPassed")){R.execute(s,t)}}else{if(!J.once){R.remove.occurred(t)}}if(u===g){return !v.onTopPassed}},bottomPassedReverse:function(u){var v=R.get.elementCalculations(),s=u||J.onBottomPassedReverse,t="bottomPassedReverse";if(u){R.debug("Adding callback for bottom passed reverse",u);J.onBottomPassedReverse=u}if(!v.bottomPassed){if(R.get.occurred("bottomPassed")){R.execute(s,t)}}else{if(!J.once){R.remove.occurred(t)}}if(u===g){return !v.bottomPassed}},execute:function(s,t){var v=R.get.elementCalculations(),u=R.get.screenCalculations();s=s||false;if(s){if(J.continuous){R.debug("Callback being called continuously",t,v);s.call(Q,v,u)}else{if(!R.get.occurred(t)){R.debug("Conditions met",t,v);s.call(Q,v,u)}}}R.save.occurred(t)},remove:{fixed:function(){R.debug("Removing fixed position");I.removeClass(P.fixed).css({position:"",top:"",left:"",zIndex:""})},occurred:function(s){if(s){var t=R.cache.occurred;if(t[s]!==g&&t[s]===true){R.debug("Callback can now be called again",s);R.cache.occurred[s]=false}}else{R.cache.occurred={}}}},save:{calculations:function(){R.verbose("Saving all calculations necessary to determine positioning");R.save.direction();R.save.screenCalculations();R.save.elementCalculations()},occurred:function(s){if(s){if(R.cache.occurred[s]===g||(R.cache.occurred[s]!==true)){R.verbose("Saving callback occurred",s);R.cache.occurred[s]=true}}},scroll:function(s){s=s+J.offset||j.scrollTop()+J.offset;R.cache.scroll=s},direction:function(){var u=R.get.scroll(),t=R.get.lastScroll(),s;if(u>t&&t){s="down"}else{if(u<t&&t){s="up"}else{s="static"}}R.cache.direction=s;return R.cache.direction},elementPosition:function(){var s=R.cache.element,t=R.get.screenSize();R.verbose("Saving element position");s.fits=(s.height<t.height);s.offset=I.offset();s.width=I.outerWidth();s.height=I.outerHeight();R.cache.element=s;return s},elementCalculations:function(){var t=R.get.screenCalculations(),s=R.get.elementPosition();if(J.includeMargin){s.margin={};s.margin.top=parseInt(I.css("margin-top"),10);s.margin.bottom=parseInt(I.css("margin-bottom"),10);s.top=s.offset.top-s.margin.top;s.bottom=s.offset.top+s.height+s.margin.bottom}else{s.top=s.offset.top;s.bottom=s.offset.top+s.height}s.topVisible=(t.bottom>=s.top);s.topPassed=(t.top>=s.top);s.bottomVisible=(t.bottom>=s.bottom);s.bottomPassed=(t.top>=s.bottom);s.pixelsPassed=0;s.percentagePassed=0;s.onScreen=(s.topVisible&&!s.bottomPassed);s.passing=(s.topPassed&&!s.bottomPassed);s.offScreen=(!s.onScreen);if(s.passing){s.pixelsPassed=(t.top-s.top);s.percentagePassed=(t.top-s.top)/s.height}R.cache.element=s;R.verbose("Updated element calculations",s);return s},screenCalculations:function(){var s=R.get.scroll();R.save.direction();R.cache.screen.top=s;R.cache.screen.bottom=s+R.cache.screen.height;return R.cache.screen},screenSize:function(){R.verbose("Saving window position");R.cache.screen={height:j.height()}},position:function(){R.save.screenSize();R.save.elementPosition()}},get:{pixelsPassed:function(s){var t=R.get.elementCalculations();if(s.search("%")>-1){return(t.height*(parseInt(s,10)/100))}return parseInt(s,10)},occurred:function(s){return(R.cache.occurred!==g)?R.cache.occurred[s]||false:false},direction:function(){if(R.cache.direction===g){R.save.direction()}return R.cache.direction},elementPosition:function(){if(R.cache.element===g){R.save.elementPosition()}return R.cache.element},elementCalculations:function(){if(R.cache.element===g){R.save.elementCalculations()}return R.cache.element},screenCalculations:function(){if(R.cache.screen===g){R.save.screenCalculations()}return R.cache.screen},screenSize:function(){if(R.cache.screen===g){R.save.screenSize()}return R.cache.screen},scroll:function(){if(R.cache.scroll===g){R.save.scroll()}return R.cache.scroll},lastScroll:function(){if(R.cache.screen===g){R.debug("First scroll event, no last scroll could be found");return false}return R.cache.screen.top}},setting:function(t,s){if(h.isPlainObject(t)){h.extend(true,J,t)}else{if(s!==g){J[t]=s}else{return J[t]}}},internal:function(t,s){if(h.isPlainObject(t)){h.extend(true,R,t)}else{if(s!==g){R[t]=s}else{return R[t]}}},debug:function(){if(J.debug){if(J.performance){R.performance.log(arguments)}else{R.debug=Function.prototype.bind.call(console.info,console,J.name+":");R.debug.apply(console,arguments)}}},verbose:function(){if(J.verbose&&J.debug){if(J.performance){R.performance.log(arguments)}else{R.verbose=Function.prototype.bind.call(console.info,console,J.name+":");R.verbose.apply(console,arguments)}}},error:function(){R.error=Function.prototype.bind.call(console.error,console,J.name+":");R.error.apply(console,arguments)},performance:{log:function(t){var u,s,v;if(J.performance){u=new Date().getTime();v=q||u;s=u-v;q=u;d.push({Name:t[0],Arguments:[].slice.call(t,1)||"",Element:Q,"Execution Time":s})}clearTimeout(R.performance.timer);R.performance.timer=setTimeout(R.performance.display,500)},display:function(){var s=J.name+":",t=0;q=false;clearTimeout(R.performance.timer);h.each(d,function(v,u){t+=u["Execution Time"]});s+=" "+t+"ms";if(o){s+=" '"+o+"'"}if((console.group!==g||console.table!==g)&&d.length>0){console.groupCollapsed(s);if(console.table){console.table(d)}else{h.each(d,function(v,u){console.log(u.Name+": "+u["Execution Time"]+"ms")})}console.groupEnd()}d=[]}},invoke:function(t,x,v){var w=G,s,u,y;x=x||b;v=Q||v;if(typeof t=="string"&&w!==g){t=t.split(/[\. ]/);s=t.length-1;h.each(t,function(z,A){var B=(z!=s)?A+t[z+1].charAt(0).toUpperCase()+t[z+1].slice(1):t;if(h.isPlainObject(w[B])&&(z!=s)){w=w[B]}else{if(w[B]!==g){u=w[B];return false}else{if(h.isPlainObject(w[A])&&(z!=s)){w=w[A]}else{if(w[A]!==g){u=w[A];return false}else{R.error(O.method,t);return false}}}}})}if(h.isFunction(u)){y=u.apply(v,x)}else{if(u!==g){y=u}}if(h.isArray(p)){p.push(y)}else{if(p!==g){p=[p,y]}else{if(y!==g){p=y}}}return u}};if(r){if(G===g){R.initialize()}G.save.scroll();G.save.calculations();R.invoke(n)}else{if(G!==g){G.invoke("destroy")}R.initialize()}});return(p!==g)?p:this};h.fn.visibility.settings={name:"Visibility",namespace:"visibility",debug:false,verbose:false,performance:true,observeChanges:true,refreshOnLoad:true,once:true,continuous:false,offset:0,includeMargin:false,context:e,initialCheck:true,throttle:false,type:false,transition:"fade in",duration:1000,onPassed:{},checkOnRefresh:true,onOnScreen:false,onOffScreen:false,onPassing:false,onTopVisible:false,onBottomVisible:false,onTopPassed:false,onBottomPassed:false,onPassingReverse:false,onTopVisibleReverse:false,onBottomVisibleReverse:false,onTopPassedReverse:false,onBottomPassedReverse:false,onUpdate:false,onRefresh:function(){},metadata:{src:"src"},className:{fixed:"fixed",placeholder:"placeholder"},error:{method:"The method you called is not defined.",visible:"Element is hidden, you must call refresh after element becomes visible"}}})(jQuery,window,document);