/*!
 * # Semantic UI x.x - Search
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(h,e,f,g){h.fn.search=function(a){var c=h(this),o=c.selector||"",q=new Date().getTime(),d=[],n=arguments[0],r=(typeof n=="string"),b=[].slice.call(arguments,1),p;h(this).each(function(){var J=(h.isPlainObject(a))?h.extend(true,{},h.fn.search.settings,a):h.extend({},h.fn.search.settings),P=J.className,H=J.metadata,I=J.regExp,M=J.selector,i=J.error,F=J.namespace,j="."+F,l=F+"-module",L=h(this),O=L.find(M.prompt),K=L.find(M.searchButton),N=L.find(M.results),k=L.find(M.result),m=L.find(M.category),Q=this,G=L.data(l),R;R={initialize:function(){R.verbose("Initializing module");R.determine.searchFields();R.bind.events();R.set.type();R.create.results();R.instantiate()},instantiate:function(){R.verbose("Storing instance of module",R);G=R;L.data(l,R)},destroy:function(){R.verbose("Destroying instance");L.off(j).removeData(l)},bind:{events:function(){R.verbose("Binding events to search");if(J.automatic){L.on(R.get.inputEvent()+j,M.prompt,R.event.input);O.attr("autocomplete","off")}L.on("focus"+j,M.prompt,R.event.focus).on("blur"+j,M.prompt,R.event.blur).on("keydown"+j,M.prompt,R.handleKeyboard).on("click"+j,M.searchButton,R.query).on("mousedown"+j,M.results,R.event.result.mousedown).on("mouseup"+j,M.results,R.event.result.mouseup).on("click"+j,M.result,R.event.result.click)}},determine:{searchFields:function(){if(a&&a.searchFields!==g){J.searchFields=a.searchFields}}},event:{input:function(){clearTimeout(R.timer);R.timer=setTimeout(R.query,J.searchDelay)},focus:function(){R.set.focus();if(R.has.minimumCharacters()){R.query();R.showResults()}},blur:function(t){var s=(f.activeElement===this);if(!s&&!R.resultsClicked){R.cancel.query();R.remove.focus();R.timer=setTimeout(R.hideResults,J.hideDelay)}},result:{mousedown:function(){R.resultsClicked=true},mouseup:function(){R.resultsClicked=false},click:function(C){R.debug("Search result selected");var y=h(this),v=y.find(M.title).eq(0),w=y.find("a[href]").eq(0),B=w.attr("href")||false,x=w.attr("target")||false,u=v.html(),t=(v.length>0)?v.text():false,z=R.get.results(),s=y.data(H.result)||R.get.result(t,z),A;if(h.isFunction(J.onSelect)){if(J.onSelect.call(Q,s,z)===false){R.debug("Custom onSelect callback cancelled default select action");return}}R.hideResults();if(t){R.set.value(t)}if(B){R.verbose("Opening search link found in result",w);if(x=="_blank"||C.ctrlKey){e.open(B)}else{e.location.href=(B)}}}}},handleKeyboard:function(s){var v=L.find(M.result),w=L.find(M.category),x=v.index(v.filter("."+P.active)),y=v.length,z=s.which,t={backspace:8,enter:13,escape:27,upArrow:38,downArrow:40},u;if(z==t.escape){R.verbose("Escape key pressed, blurring search field");O.trigger("blur")}if(R.is.visible()){if(z==t.enter){R.verbose("Enter key pressed, selecting active result");if(v.filter("."+P.active).length>0){R.event.result.click.call(v.filter("."+P.active),s);s.preventDefault();return false}}else{if(z==t.upArrow){R.verbose("Up key pressed, changing active result");u=(x-1<0)?x:x-1;w.removeClass(P.active);v.removeClass(P.active).eq(u).addClass(P.active).closest(w).addClass(P.active);s.preventDefault()}else{if(z==t.downArrow){R.verbose("Down key pressed, changing active result");u=(x+1>=y)?x:x+1;w.removeClass(P.active);v.removeClass(P.active).eq(u).addClass(P.active).closest(w).addClass(P.active);s.preventDefault()}}}}else{if(z==t.enter){R.verbose("Enter key pressed, executing query");R.query();R.set.buttonPressed();O.one("keyup",R.remove.buttonFocus)}}},setup:{api:function(){var t={debug:J.debug,on:false,cache:"local",action:"search",onError:R.error},s;R.verbose("First request, initializing API");L.api(t)}},can:{useAPI:function(){return h.fn.api!==g},transition:function(){return J.transition&&h.fn.transition!==g&&L.transition("is supported")}},is:{empty:function(){return(N.html()==="")},visible:function(){return(N.filter(":visible").length>0)},focused:function(){return(O.filter(":focus").length>0)}},get:{inputEvent:function(){var t=O[0],s=(t!==g&&t.oninput!==g)?"input":(t!==g&&t.onpropertychange!==g)?"propertychange":"keyup";return s},value:function(){return O.val()},results:function(){var s=L.data(H.results);return s},result:function(s,t){var u=["title","id"],v=false;s=(s!==g)?s:R.get.value();t=(t!==g)?t:R.get.results();if(J.type==="category"){R.debug("Finding result that matches",s);h.each(t,function(x,w){if(h.isArray(w.results)){v=R.search.object(s,w.results,u)[0];if(v){return false}}})}else{R.debug("Finding result in results object",s);v=R.search.object(s,t,u)[0]}return v||false}},set:{focus:function(){L.addClass(P.focus)},loading:function(){L.addClass(P.loading)},value:function(s){R.verbose("Setting search input value",s);O.val(s)},type:function(s){s=s||J.type;if(J.type=="category"){L.addClass(J.type)}},buttonPressed:function(){K.addClass(P.pressed)}},remove:{loading:function(){L.removeClass(P.loading)},focus:function(){L.removeClass(P.focus)},buttonPressed:function(){K.removeClass(P.pressed)}},query:function(){var s=R.get.value(),t=R.read.cache(s);if(R.has.minimumCharacters()){if(t){R.debug("Reading result from cache",s);R.save.results(t.results);R.addResults(t.html);R.inject.id(t.results)}else{R.debug("Querying for",s);if(h.isPlainObject(J.source)||h.isArray(J.source)){R.search.local(s)}else{if(R.can.useAPI()){R.search.remote(s)}else{R.error(i.source)}}J.onSearchQuery.call(Q,s)}}else{R.hideResults()}},search:{local:function(u){var t=R.search.object(u,J.content),s;R.set.loading();R.save.results(t);R.debug("Returned local search results",t);s=R.generateResults({results:t});R.remove.loading();R.addResults(s);R.inject.id(t);R.write.cache(u,{html:s,results:t})},remote:function(t){var s={onSuccess:function(u){R.parse.response.call(Q,u,t)},onFailure:function(){R.displayMessage(i.serverError)},urlData:{query:t}};if(!L.api("get request")){R.setup.api()}h.extend(true,s,J.apiSettings);R.debug("Executing search",s);R.cancel.query();L.api("setting",s).api("query")},object:function(v,s,z){var t=[],x=[],w=v.toString().replace(I.escape,"\\$&"),u=new RegExp(I.beginsWith+w,"i"),y=function(A,C){var D=(h.inArray(C,t)==-1),B=(h.inArray(C,x)==-1);if(D&&B){A.push(C)}};s=s||J.source;z=(z!==g)?z:J.searchFields;if(!h.isArray(z)){z=[z]}if(s===g||s===false){R.error(i.source);return[]}h.each(z,function(B,A){h.each(s,function(E,D){var C=(typeof D[A]=="string");if(C){if(D[A].search(u)!==-1){y(t,D)}else{if(J.searchFullText&&R.fuzzySearch(v,D[A])){y(x,D)}}}})});return h.merge(t,x)}},fuzzySearch:function(u,w){var s=w.length,x=u.length;if(typeof u!=="string"){return false}u=u.toLowerCase();w=w.toLowerCase();if(x>s){return false}if(x===s){return(u===w)}search:for(var t=0,y=0;t<x;t++){var v=u.charCodeAt(t);while(y<s){if(w.charCodeAt(y++)===v){continue search}}return false}return true},parse:{response:function(t,u){var s=R.generateResults(t);R.verbose("Parsing server response",t);if(t!==g){if(u!==g&&t.results!==g){R.addResults(s);R.inject.id(t.results);R.write.cache(u,{html:s,results:t.results});R.save.results(t.results)}}}},cancel:{query:function(){if(R.can.useAPI()){L.api("abort")}}},has:{minimumCharacters:function(){var t=R.get.value(),s=t.length;return(s>=J.minCharacters)}},clear:{cache:function(s){var t=L.data(H.cache);if(!s){R.debug("Clearing cache",s);L.removeData(H.cache)}else{if(s&&t&&t[s]){R.debug("Removing value from cache",s);delete t[s];L.data(H.cache,t)}}}},read:{cache:function(s){var t=L.data(H.cache);if(J.cache){R.verbose("Checking cache for generated html for query",s);return(typeof t=="object")&&(t[s]!==g)?t[s]:false}return false}},create:{id:function(y,v){var s=(y+1),w=(v+1),u,x,t;if(v!==g){x=String.fromCharCode(97+v);t=x+s;R.verbose("Creating category result id",t)}else{t=s;R.verbose("Creating result id",t)}return t},results:function(){if(N.length===0){N=h("<div />").addClass(P.results).appendTo(L)}}},inject:{result:function(u,v,s){R.verbose("Injecting result into results");var t=(s!==g)?N.children().eq(s).children(M.result).eq(v):N.children(M.result).eq(v);R.verbose("Injecting results metadata",t);t.data(H.result,u)},id:function(t){R.debug("Injecting unique ids into results");var s=0,u=0;if(J.type==="category"){h.each(t,function(w,v){u=0;h.each(v.results,function(x,z){var y=v.results[x];if(y.id===g){y.id=R.create.id(u,s)}R.inject.result(y,u,s);u++});s++})}else{h.each(t,function(w,v){var x=t[w];if(x.id===g){x.id=R.create.id(u)}R.inject.result(x,u);u++})}return t}},save:{results:function(s){R.verbose("Saving current search results to metadata",s);L.data(H.results,s)}},write:{cache:function(t,s){var u=(L.data(H.cache)!==g)?L.data(H.cache):{};if(J.cache){R.verbose("Writing generated html to cache",t,s);u[t]=s;L.data(H.cache,u)}}},addResults:function(s){if(h.isFunction(J.onResultsAdd)){if(J.onResultsAdd.call(N,s)===false){R.debug("onResultsAdd callback cancelled default action");return false}}N.html(s);R.showResults()},showResults:function(){if(!R.is.visible()&&R.is.focused()&&!R.is.empty()){if(R.can.transition()){R.debug("Showing results with css animations");N.transition({animation:J.transition+" in",debug:J.debug,verbose:J.verbose,duration:J.duration,queue:true})}else{R.debug("Showing results with javascript");N.stop().fadeIn(J.duration,J.easing)}J.onResultsOpen.call(N)}},hideResults:function(){if(R.is.visible()){if(R.can.transition()){R.debug("Hiding results with css animations");N.transition({animation:J.transition+" out",debug:J.debug,verbose:J.verbose,duration:J.duration,queue:true})}else{R.debug("Hiding results with javascript");N.stop().fadeOut(J.duration,J.easing)}J.onResultsClose.call(N)}},generateResults:function(w){R.debug("Generating html from response",w);var s=J.templates[J.type],t=(h.isPlainObject(w.results)&&!h.isEmptyObject(w.results)),u=(h.isArray(w.results)&&w.results.length>0),v="";if(t||u){if(J.maxResults>0){if(t){if(J.type=="standard"){R.error(i.maxResults)}}else{w.results=w.results.slice(0,J.maxResults)}}if(h.isFunction(s)){v=s(w)}else{R.error(i.noTemplate,false)}}else{v=R.displayMessage(i.noResults,"empty")}J.onResults.call(Q,w);return v},displayMessage:function(s,t){t=t||"standard";R.debug("Displaying message",s,t);R.addResults(J.templates.message(s,t));return J.templates.message(s,t)},setting:function(t,s){if(h.isPlainObject(t)){h.extend(true,J,t)}else{if(s!==g){J[t]=s}else{return J[t]}}},internal:function(t,s){if(h.isPlainObject(t)){h.extend(true,R,t)}else{if(s!==g){R[t]=s}else{return R[t]}}},debug:function(){if(J.debug){if(J.performance){R.performance.log(arguments)}else{R.debug=Function.prototype.bind.call(console.info,console,J.name+":");R.debug.apply(console,arguments)}}},verbose:function(){if(J.verbose&&J.debug){if(J.performance){R.performance.log(arguments)}else{R.verbose=Function.prototype.bind.call(console.info,console,J.name+":");R.verbose.apply(console,arguments)}}},error:function(){R.error=Function.prototype.bind.call(console.error,console,J.name+":");R.error.apply(console,arguments)},performance:{log:function(t){var u,s,v;if(J.performance){u=new Date().getTime();v=q||u;s=u-v;q=u;d.push({Name:t[0],Arguments:[].slice.call(t,1)||"",Element:Q,"Execution Time":s})}clearTimeout(R.performance.timer);R.performance.timer=setTimeout(R.performance.display,500)},display:function(){var s=J.name+":",t=0;q=false;clearTimeout(R.performance.timer);h.each(d,function(v,u){t+=u["Execution Time"]});s+=" "+t+"ms";if(o){s+=" '"+o+"'"}if(c.length>1){s+=" ("+c.length+")"}if((console.group!==g||console.table!==g)&&d.length>0){console.groupCollapsed(s);if(console.table){console.table(d)}else{h.each(d,function(v,u){console.log(u.Name+": "+u["Execution Time"]+"ms")})}console.groupEnd()}d=[]}},invoke:function(t,x,v){var w=G,s,u,y;x=x||b;v=Q||v;if(typeof t=="string"&&w!==g){t=t.split(/[\. ]/);s=t.length-1;h.each(t,function(z,A){var B=(z!=s)?A+t[z+1].charAt(0).toUpperCase()+t[z+1].slice(1):t;if(h.isPlainObject(w[B])&&(z!=s)){w=w[B]}else{if(w[B]!==g){u=w[B];return false}else{if(h.isPlainObject(w[A])&&(z!=s)){w=w[A]}else{if(w[A]!==g){u=w[A];return false}else{return false}}}}})}if(h.isFunction(u)){y=u.apply(v,x)}else{if(u!==g){y=u}}if(h.isArray(p)){p.push(y)}else{if(p!==g){p=[p,y]}else{if(y!==g){p=y}}}return u}};if(r){if(G===g){R.initialize()}R.invoke(n)}else{if(G!==g){G.invoke("destroy")}R.initialize()}});return(p!==g)?p:this};h.fn.search.settings={name:"Search",namespace:"search",debug:false,verbose:false,performance:true,type:"standard",minCharacters:1,apiSettings:false,source:false,searchFields:["title","description"],searchFullText:true,automatic:true,hideDelay:0,searchDelay:200,maxResults:7,cache:true,transition:"scale",duration:200,easing:"easeOutExpo",onSelect:false,onResultsAdd:false,onSearchQuery:function(){},onResults:function(a){},onResultsOpen:function(){},onResultsClose:function(){},className:{active:"active",empty:"empty",focus:"focus",loading:"loading",results:"results",pressed:"down"},error:{source:"Cannot search. No source used, and Semantic API module was not included",noResults:"Your search returned no results",logging:"Error in debug logging, exiting.",noEndpoint:"No search endpoint was specified",noTemplate:"A valid template name was not specified.",serverError:"There was an issue querying the server.",maxResults:"Results must be an array to use maxResults setting",method:"The method you called is not defined."},metadata:{cache:"cache",results:"results",result:"result"},regExp:{escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,beginsWith:"(?:s|^)"},selector:{prompt:".prompt",searchButton:".search.button",results:".results",category:".category",result:".result",title:".title, .name"},templates:{escape:function(d){var b=/[&<>"'`]/g,a=/[&<>"'`]/,c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},j=function(i){return c[i]};if(a.test(d)){return d.replace(b,j)}return d},message:function(a,b){var c="";if(a!==g&&b!==g){c+='<div class="message '+b+'">';if(b=="empty"){c+='<div class="header">No Results</div class="header"><div class="description">'+a+'</div class="description">'}else{c+=' <div class="description">'+a+"</div>"}c+="</div>"}return c},category:function(c){var b="",a=h.fn.search.settings.templates.escape;if(c.results!==g){h.each(c.results,function(j,d){if(d.results!==g&&d.results.length>0){b+='<div class="category"><div class="name">'+d.name+"</div>";h.each(d.results,function(i,l){b+='<div class="result">';if(l.url){b+='<a href="'+l.url+'"></a>'}if(l.image!==g){l.image=a(l.image);b+='<div class="image"> <img src="'+l.image+'" alt=""></div>'}b+='<div class="content">';if(l.price!==g){l.price=a(l.price);b+='<div class="price">'+l.price+"</div>"}if(l.title!==g){l.title=a(l.title);b+='<div class="title">'+l.title+"</div>"}if(l.description!==g){b+='<div class="description">'+l.description+"</div>"}b+="</div></div>"});b+="</div>"}});if(c.action){b+='<a href="'+c.action.url+'" class="action">'+c.action.text+"</a>"}return b}return false},standard:function(b){var a="";if(b.results!==g){h.each(b.results,function(c,d){if(d.url){a+='<a class="result" href="'+d.url+'">'}else{a+='<a class="result">'}if(d.image!==g){a+='<div class="image"> <img src="'+d.image+'"></div>'}a+='<div class="content">';if(d.price!==g){a+='<div class="price">'+d.price+"</div>"}if(d.title!==g){a+='<div class="title">'+d.title+"</div>"}if(d.description!==g){a+='<div class="description">'+d.description+"</div>"}a+="</div>";a+="</a>"});if(b.action){a+='<a href="'+b.action.url+'" class="action">'+b.action.text+"</a>"}return a}return false}}}})(jQuery,window,document);