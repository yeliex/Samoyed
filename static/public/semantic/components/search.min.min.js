/*!
 * # Semantic UI x.x - Search
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;!function(d,a,b,c){d.fn.search=function(f){var q,j=d(this),p=j.selector||"",e=(new Date).getTime(),r=[],h=arguments[0],m="string"==typeof h,k=[].slice.call(arguments,1);return d(this).each(function(){var B,l=d.isPlainObject(f)?d.extend(!0,{},d.fn.search.settings,f):d.extend({},d.fn.search.settings),I=l.className,z=l.metadata,o=l.regExp,F=l.selector,D=l.error,i=l.namespace,u="."+i,H=i+"-module",G=d(this),t=G.find(F.prompt),g=G.find(F.searchButton),s=G.find(F.results),n=(G.find(F.result),G.find(F.category),this),J=G.data(H);B={initialize:function(){B.verbose("Initializing module"),B.determine.searchFields(),B.bind.events(),B.set.type(),B.create.results(),B.instantiate()},instantiate:function(){B.verbose("Storing instance of module",B),J=B,G.data(H,B)},destroy:function(){B.verbose("Destroying instance"),G.off(u).removeData(H)},bind:{events:function(){B.verbose("Binding events to search"),l.automatic&&(G.on(B.get.inputEvent()+u,F.prompt,B.event.input),t.attr("autocomplete","off")),G.on("focus"+u,F.prompt,B.event.focus).on("blur"+u,F.prompt,B.event.blur).on("keydown"+u,F.prompt,B.handleKeyboard).on("click"+u,F.searchButton,B.query).on("mousedown"+u,F.results,B.event.result.mousedown).on("mouseup"+u,F.results,B.event.result.mouseup).on("click"+u,F.result,B.event.result.click)}},determine:{searchFields:function(){f&&f.searchFields!==c&&(l.searchFields=f.searchFields)}},event:{input:function(){clearTimeout(B.timer),B.timer=setTimeout(B.query,l.searchDelay)},focus:function(){B.set.focus(),B.has.minimumCharacters()&&(B.query(),B.showResults())},blur:function(w){var v=b.activeElement===this;v||B.resultsClicked||(B.cancel.query(),B.remove.focus(),B.timer=setTimeout(B.hideResults,l.hideDelay))},result:{mousedown:function(){B.resultsClicked=!0},mouseup:function(){B.resultsClicked=!1},click:function(L){B.debug("Search result selected");var v=d(this),x=v.find(F.title).eq(0),E=v.find("a[href]").eq(0),A=E.attr("href")||!1,C=E.attr("target")||!1,w=(x.html(),x.length>0?x.text():!1),K=B.get.results(),y=v.data(z.result)||B.get.result(w,K);return d.isFunction(l.onSelect)&&l.onSelect.call(n,y,K)===!1?void B.debug("Custom onSelect callback cancelled default select action"):(B.hideResults(),w&&B.set.value(w),void (A&&(B.verbose("Opening search link found in result",E),"_blank"==C||L.ctrlKey?a.open(A):a.location.href=A)))}}},handleKeyboard:function(C){var x,y=G.find(F.result),A=G.find(F.category),K=y.index(y.filter("."+I.active)),v=y.length,w=C.which,E={backspace:8,enter:13,escape:27,upArrow:38,downArrow:40};if(w==E.escape&&(B.verbose("Escape key pressed, blurring search field"),t.trigger("blur")),B.is.visible()){if(w==E.enter){if(B.verbose("Enter key pressed, selecting active result"),y.filter("."+I.active).length>0){return B.event.result.click.call(y.filter("."+I.active),C),C.preventDefault(),!1}}else{w==E.upArrow?(B.verbose("Up key pressed, changing active result"),x=0>K-1?K:K-1,A.removeClass(I.active),y.removeClass(I.active).eq(x).addClass(I.active).closest(A).addClass(I.active),C.preventDefault()):w==E.downArrow&&(B.verbose("Down key pressed, changing active result"),x=K+1>=v?K:K+1,A.removeClass(I.active),y.removeClass(I.active).eq(x).addClass(I.active).closest(A).addClass(I.active),C.preventDefault())}}else{w==E.enter&&(B.verbose("Enter key pressed, executing query"),B.query(),B.set.buttonPressed(),t.one("keyup",B.remove.buttonFocus))}},setup:{api:function(){var v={debug:l.debug,on:!1,cache:"local",action:"search",onError:B.error};B.verbose("First request, initializing API"),G.api(v)}},can:{useAPI:function(){return d.fn.api!==c},transition:function(){return l.transition&&d.fn.transition!==c&&G.transition("is supported")}},is:{empty:function(){return""===s.html()},visible:function(){return s.filter(":visible").length>0},focused:function(){return t.filter(":focus").length>0}},get:{inputEvent:function(){var w=t[0],v=w!==c&&w.oninput!==c?"input":w!==c&&w.onpropertychange!==c?"propertychange":"keyup";return v},value:function(){return t.val()},results:function(){var v=G.data(z.results);return v},result:function(w,x){var y=["title","id"],v=!1;return w=w!==c?w:B.get.value(),x=x!==c?x:B.get.results(),"category"===l.type?(B.debug("Finding result that matches",w),d.each(x,function(A,C){return d.isArray(C.results)&&(v=B.search.object(w,C.results,y)[0])?!1:void 0})):(B.debug("Finding result in results object",w),v=B.search.object(w,x,y)[0]),v||!1}},set:{focus:function(){G.addClass(I.focus)},loading:function(){G.addClass(I.loading)},value:function(v){B.verbose("Setting search input value",v),t.val(v)},type:function(v){v=v||l.type,"category"==l.type&&G.addClass(l.type)},buttonPressed:function(){g.addClass(I.pressed)}},remove:{loading:function(){G.removeClass(I.loading)},focus:function(){G.removeClass(I.focus)},buttonPressed:function(){g.removeClass(I.pressed)}},query:function(){var v=B.get.value(),w=B.read.cache(v);B.has.minimumCharacters()?w?(B.debug("Reading result from cache",v),B.save.results(w.results),B.addResults(w.html),B.inject.id(w.results)):(B.debug("Querying for",v),d.isPlainObject(l.source)||d.isArray(l.source)?B.search.local(v):B.can.useAPI()?B.search.remote(v):B.error(D.source),l.onSearchQuery.call(n,v)):B.hideResults()},search:{local:function(x){var v,w=B.search.object(x,l.content);B.set.loading(),B.save.results(w),B.debug("Returned local search results",w),v=B.generateResults({results:w}),B.remove.loading(),B.addResults(v),B.inject.id(w),B.write.cache(x,{html:v,results:w})},remote:function(v){var w={onSuccess:function(x){B.parse.response.call(n,x,v)},onFailure:function(){B.displayMessage(D.serverError)},urlData:{query:v}};G.api("get request")||B.setup.api(),d.extend(!0,w,l.apiSettings),B.debug("Executing search",w),B.cancel.query(),G.api("setting",w).api("query")},object:function(y,A,K){var v=[],x=[],E=y.toString().replace(o.escape,"\\$&"),C=new RegExp(o.beginsWith+E,"i"),w=function(L,M){var N=-1==d.inArray(M,v),O=-1==d.inArray(M,x);N&&O&&L.push(M)};return A=A||l.source,K=K!==c?K:l.searchFields,d.isArray(K)||(K=[K]),A===c||A===!1?(B.error(D.source),[]):(d.each(K,function(L,M){d.each(A,function(P,N){var O="string"==typeof N[M];O&&(-1!==N[M].search(C)?w(v,N):l.searchFullText&&B.fuzzySearch(y,N[M])&&w(x,N))})}),d.merge(v,x))}},fuzzySearch:function(C,x){var y=x.length,A=C.length;if("string"!=typeof C){return !1}if(C=C.toLowerCase(),x=x.toLowerCase(),A>y){return !1}if(A===y){return C===x}C:for(var E=0,v=0;A>E;E++){for(var w=C.charCodeAt(E);y>v;){if(x.charCodeAt(v++)===w){continue C}}return !1}return !0},parse:{response:function(x,v){var w=B.generateResults(x);B.verbose("Parsing server response",x),x!==c&&v!==c&&x.results!==c&&(B.addResults(w),B.inject.id(x.results),B.write.cache(v,{html:w,results:x.results}),B.save.results(x.results))}},cancel:{query:function(){B.can.useAPI()&&G.api("abort")}},has:{minimumCharacters:function(){var w=B.get.value(),v=w.length;return v>=l.minCharacters}},clear:{cache:function(w){var v=G.data(z.cache);w?w&&v&&v[w]&&(B.debug("Removing value from cache",w),delete v[w],G.data(z.cache,v)):(B.debug("Clearing cache",w),G.removeData(z.cache))}},read:{cache:function(w){var v=G.data(z.cache);return l.cache?(B.verbose("Checking cache for generated html for query",w),"object"==typeof v&&v[w]!==c?v[w]:!1):!1}},create:{id:function(y,w){var x,A,v=y+1;return w!==c?(x=String.fromCharCode(97+w),A=x+v,B.verbose("Creating category result id",A)):(A=v,B.verbose("Creating result id",A)),A},results:function(){0===s.length&&(s=d("<div />").addClass(I.results).appendTo(G))}},inject:{result:function(x,v,w){B.verbose("Injecting result into results");var y=w!==c?s.children().eq(w).children(F.result).eq(v):s.children(F.result).eq(v);B.verbose("Injecting results metadata",y),y.data(z.result,x)},id:function(v){B.debug("Injecting unique ids into results");var w=0,x=0;return"category"===l.type?d.each(v,function(A,y){x=0,d.each(y.results,function(K,E){var C=y.results[K];C.id===c&&(C.id=B.create.id(x,w)),B.inject.result(C,x,w),x++}),w++}):d.each(v,function(C,A){var y=v[C];y.id===c&&(y.id=B.create.id(x)),B.inject.result(y,x),x++}),v}},save:{results:function(v){B.verbose("Saving current search results to metadata",v),G.data(z.results,v)}},write:{cache:function(x,v){var w=G.data(z.cache)!==c?G.data(z.cache):{};l.cache&&(B.verbose("Writing generated html to cache",x,v),w[x]=v,G.data(z.cache,w))}},addResults:function(v){return d.isFunction(l.onResultsAdd)&&l.onResultsAdd.call(s,v)===!1?(B.debug("onResultsAdd callback cancelled default action"),!1):(s.html(v),void B.showResults())},showResults:function(){B.is.visible()||!B.is.focused()||B.is.empty()||(B.can.transition()?(B.debug("Showing results with css animations"),s.transition({animation:l.transition+" in",debug:l.debug,verbose:l.verbose,duration:l.duration,queue:!0})):(B.debug("Showing results with javascript"),s.stop().fadeIn(l.duration,l.easing)),l.onResultsOpen.call(s))},hideResults:function(){B.is.visible()&&(B.can.transition()?(B.debug("Hiding results with css animations"),s.transition({animation:l.transition+" out",debug:l.debug,verbose:l.verbose,duration:l.duration,queue:!0})):(B.debug("Hiding results with javascript"),s.stop().fadeOut(l.duration,l.easing)),l.onResultsClose.call(s))},generateResults:function(w){B.debug("Generating html from response",w);var x=l.templates[l.type],y=d.isPlainObject(w.results)&&!d.isEmptyObject(w.results),A=d.isArray(w.results)&&w.results.length>0,v="";return y||A?(l.maxResults>0&&(y?"standard"==l.type&&B.error(D.maxResults):w.results=w.results.slice(0,l.maxResults)),d.isFunction(x)?v=x(w):B.error(D.noTemplate,!1)):v=B.displayMessage(D.noResults,"empty"),l.onResults.call(n,w),v},displayMessage:function(w,v){return v=v||"standard",B.debug("Displaying message",w,v),B.addResults(l.templates.message(w,v)),l.templates.message(w,v)},setting:function(v,w){if(d.isPlainObject(v)){d.extend(!0,l,v)}else{if(w===c){return l[v]}l[v]=w}},internal:function(v,w){if(d.isPlainObject(v)){d.extend(!0,B,v)}else{if(w===c){return B[v]}B[v]=w}},debug:function(){l.debug&&(l.performance?B.performance.log(arguments):(B.debug=Function.prototype.bind.call(console.info,console,l.name+":"),B.debug.apply(console,arguments)))},verbose:function(){l.verbose&&l.debug&&(l.performance?B.performance.log(arguments):(B.verbose=Function.prototype.bind.call(console.info,console,l.name+":"),B.verbose.apply(console,arguments)))},error:function(){B.error=Function.prototype.bind.call(console.error,console,l.name+":"),B.error.apply(console,arguments)},performance:{log:function(y){var v,w,x;l.performance&&(v=(new Date).getTime(),x=e||v,w=v-x,e=v,r.push({Name:y[0],Arguments:[].slice.call(y,1)||"",Element:n,"Execution Time":w})),clearTimeout(B.performance.timer),B.performance.timer=setTimeout(B.performance.display,500)},display:function(){var v=l.name+":",w=0;e=!1,clearTimeout(B.performance.timer),d.each(r,function(y,x){w+=x["Execution Time"]}),v+=" "+w+"ms",p&&(v+=" '"+p+"'"),j.length>1&&(v+=" ("+j.length+")"),(console.group!==c||console.table!==c)&&r.length>0&&(console.groupCollapsed(v),console.table?console.table(r):d.each(r,function(y,x){console.log(x.Name+": "+x["Execution Time"]+"ms")}),console.groupEnd()),r=[]}},invoke:function(x,y,E){var w,C,A,v=J;return y=y||k,E=n||E,"string"==typeof x&&v!==c&&(x=x.split(/[\. ]/),w=x.length-1,d.each(x,function(L,M){var K=L!=w?M+x[L+1].charAt(0).toUpperCase()+x[L+1].slice(1):x;if(d.isPlainObject(v[K])&&L!=w){v=v[K]}else{if(v[K]!==c){return C=v[K],!1}if(!d.isPlainObject(v[M])||L==w){return v[M]!==c?(C=v[M],!1):!1}v=v[M]}})),d.isFunction(C)?A=C.apply(E,y):C!==c&&(A=C),d.isArray(q)?q.push(A):q!==c?q=[q,A]:A!==c&&(q=A),C}},m?(J===c&&B.initialize(),B.invoke(h)):(J!==c&&J.invoke("destroy"),B.initialize())}),q!==c?q:this},d.fn.search.settings={name:"Search",namespace:"search",debug:!1,verbose:!1,performance:!0,type:"standard",minCharacters:1,apiSettings:!1,source:!1,searchFields:["title","description"],searchFullText:!0,automatic:!0,hideDelay:0,searchDelay:200,maxResults:7,cache:!0,transition:"scale",duration:200,easing:"easeOutExpo",onSelect:!1,onResultsAdd:!1,onSearchQuery:function(){},onResults:function(f){},onResultsOpen:function(){},onResultsClose:function(){},className:{active:"active",empty:"empty",focus:"focus",loading:"loading",results:"results",pressed:"down"},error:{source:"Cannot search. No source used, and Semantic API module was not included",noResults:"Your search returned no results",logging:"Error in debug logging, exiting.",noEndpoint:"No search endpoint was specified",noTemplate:"A valid template name was not specified.",serverError:"There was an issue querying the server.",maxResults:"Results must be an array to use maxResults setting",method:"The method you called is not defined."},metadata:{cache:"cache",results:"results",result:"result"},regExp:{escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,beginsWith:"(?:s|^)"},selector:{prompt:".prompt",searchButton:".search.button",results:".results",category:".category",result:".result",title:".title, .name"},templates:{escape:function(i){var f=/[&<>"'`]/g,g=/[&<>"'`]/,h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},j=function(k){return h[k]};return g.test(i)?i.replace(f,j):i},message:function(h,f){var g="";return h!==c&&f!==c&&(g+='<div class="message '+f+'">',g+="empty"==f?'<div class="header">No Results</div class="header"><div class="description">'+h+'</div class="description">':' <div class="description">'+h+"</div>",g+="</div>"),g},category:function(e){var f="",g=d.fn.search.settings.templates.escape;return e.results!==c?(d.each(e.results,function(i,h){h.results!==c&&h.results.length>0&&(f+='<div class="category"><div class="name">'+h.name+"</div>",d.each(h.results,function(k,j){f+='<div class="result">',j.url&&(f+='<a href="'+j.url+'"></a>'),j.image!==c&&(j.image=g(j.image),f+='<div class="image"> <img src="'+j.image+'" alt=""></div>'),f+='<div class="content">',j.price!==c&&(j.price=g(j.price),f+='<div class="price">'+j.price+"</div>"),j.title!==c&&(j.title=g(j.title),f+='<div class="title">'+j.title+"</div>"),j.description!==c&&(f+='<div class="description">'+j.description+"</div>"),f+="</div></div>"}),f+="</div>")}),e.action&&(f+='<a href="'+e.action.url+'" class="action">'+e.action.text+"</a>"),f):!1},standard:function(e){var f="";return e.results!==c?(d.each(e.results,function(h,g){f+=g.url?'<a class="result" href="'+g.url+'">':'<a class="result">',g.image!==c&&(f+='<div class="image"> <img src="'+g.image+'"></div>'),f+='<div class="content">',g.price!==c&&(f+='<div class="price">'+g.price+"</div>"),g.title!==c&&(f+='<div class="title">'+g.title+"</div>"),g.description!==c&&(f+='<div class="description">'+g.description+"</div>"),f+="</div>",f+="</a>"}),e.action&&(f+='<a href="'+e.action.url+'" class="action">'+e.action.text+"</a>"),f):!1}}}}(jQuery,window,document);