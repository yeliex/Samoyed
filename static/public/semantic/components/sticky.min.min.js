/*!
 * # Semantic UI x.x - Sticky
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(h,e,f,g){h.fn.sticky=function(a){var c=h(this),o=c.selector||"",q=new Date().getTime(),d=[],n=arguments[0],r=(typeof n=="string"),b=[].slice.call(arguments,1),p;c.each(function(){var l=(h.isPlainObject(a))?h.extend(true,{},h.fn.sticky.settings,a):h.extend({},h.fn.sticky.settings),J=l.className,j=l.namespace,I=l.error,i="."+j,N="module-"+j,G=h(this),F=h(e),P=h(l.scrollContext),k,M,E=G.selector||"",m=G.data(N),K=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame||function(s){setTimeout(s,0)},O=this,L,H;H={initialize:function(){H.determineContainer();H.determineContext();H.verbose("Initializing sticky",l,k);H.save.positions();H.checkErrors();H.bind.events();if(l.observeChanges){H.observeChanges()}H.instantiate()},instantiate:function(){H.verbose("Storing instance of module",H);m=H;G.data(N,H)},destroy:function(){H.verbose("Destroying previous instance");H.reset();if(L){L.disconnect()}F.off("load"+i,H.event.load).off("resize"+i,H.event.resize);P.off("scrollchange"+i,H.event.scrollchange);G.removeData(N)},observeChanges:function(){var s=M[0];if("MutationObserver" in e){L=new MutationObserver(function(t){clearTimeout(H.timer);H.timer=setTimeout(function(){H.verbose("DOM tree modified, updating sticky menu",t);H.refresh()},100)});L.observe(O,{childList:true,subtree:true});L.observe(s,{childList:true,subtree:true});H.debug("Setting up mutation observer",L)}},determineContainer:function(){k=G.offsetParent()},determineContext:function(){if(l.context){M=h(l.context)}else{M=k}if(M.length===0){H.error(I.invalidContext,l.context,G);return}},checkErrors:function(){if(H.is.hidden()){H.error(I.visible,G)}if(H.cache.element.height>H.cache.context.height){H.reset();H.error(I.elementSize,G);return}},bind:{events:function(){F.on("load"+i,H.event.load).on("resize"+i,H.event.resize);P.off("scroll"+i).on("scroll"+i,H.event.scroll).on("scrollchange"+i,H.event.scrollchange)}},event:{load:function(){H.verbose("Page contents finished loading");K(H.refresh)},resize:function(){H.verbose("Window resized");K(H.refresh)},scroll:function(){K(function(){P.triggerHandler("scrollchange"+i,P.scrollTop())})},scrollchange:function(s,t){H.stick(t);l.onScroll.call(O)}},refresh:function(s){H.reset();if(!l.context){H.determineContext()}if(s){H.determineContainer()}H.save.positions();H.stick();l.onReposition.call(O)},supports:{sticky:function(){var t=h("<div/>"),s=t[0];t.addClass(J.supported);return(t.css("position").match("sticky"))}},save:{lastScroll:function(s){H.lastScroll=s},elementScroll:function(s){H.elementScroll=s},positions:function(){var s={height:F.height()},t={margin:{top:parseInt(G.css("margin-top"),10),bottom:parseInt(G.css("margin-bottom"),10)},offset:G.offset(),width:G.outerWidth(),height:G.outerHeight()},u={offset:M.offset(),height:M.outerHeight(),bottomPadding:parseInt(M.css("padding-bottom"),10)},v={height:k.outerHeight()};H.cache={fits:(t.height<s.height),window:{height:s.height},element:{margin:t.margin,top:t.offset.top-t.margin.top,left:t.offset.left,width:t.width,height:t.height,bottom:t.offset.top+t.height},context:{top:u.offset.top,height:u.height,bottomPadding:u.bottomPadding,bottom:u.offset.top+u.height-u.bottomPadding}};H.set.containerSize();H.set.size();H.stick();H.debug("Caching element positions",H.cache)}},get:{direction:function(t){var s="down";t=t||P.scrollTop();if(H.lastScroll!==g){if(H.lastScroll<t){s="down"}else{if(H.lastScroll>t){s="up"}}}return s},scrollChange:function(s){s=s||P.scrollTop();return(H.lastScroll)?(s-H.lastScroll):0},currentElementScroll:function(){if(H.elementScroll){return H.elementScroll}return(H.is.top())?Math.abs(parseInt(G.css("top"),10))||0:Math.abs(parseInt(G.css("bottom"),10))||0},elementScroll:function(y){y=y||P.scrollTop();var x=H.cache.element,u=H.cache.window,s=H.get.scrollChange(y),v=(x.height-u.height+l.offset),w=H.get.currentElementScroll(),t=(w+s);if(H.cache.fits||t<0){w=0}else{if(t>v){w=v}else{w=t}}return w}},remove:{lastScroll:function(){delete H.lastScroll},elementScroll:function(s){delete H.elementScroll},offset:function(){G.css("margin-top","")}},set:{offset:function(){H.verbose("Setting offset on element",l.offset);G.css("margin-top",l.offset)},containerSize:function(){var s=k.get(0).tagName;if(s==="HTML"||s=="body"){H.determineContainer()}else{if(Math.abs(k.outerHeight()-H.cache.context.height)>l.jitter){H.debug("Context has padding, specifying exact height for container",H.cache.context.height);k.css({height:H.cache.context.height})}}},minimumSize:function(){var s=H.cache.element;k.css("min-height",s.height)},scroll:function(s){H.debug("Setting scroll on element",s);if(H.elementScroll==s){return}if(H.is.top()){G.css("bottom","").css("top",-s)}if(H.is.bottom()){G.css("top","").css("bottom",s)}},size:function(){if(H.cache.element.height!==0&&H.cache.element.width!==0){G.css({width:H.cache.element.width,height:H.cache.element.height})}}},is:{top:function(){return G.hasClass(J.top)},bottom:function(){return G.hasClass(J.bottom)},initialPosition:function(){return(!H.is.fixed()&&!H.is.bound())},hidden:function(){return(!G.is(":visible"))},bound:function(){return G.hasClass(J.bound)},fixed:function(){return G.hasClass(J.fixed)}},stick:function(t){var v=t||P.scrollTop(),D=H.cache,s=D.fits,z=D.element,w=D.window,C=D.context,A=(H.is.bottom()&&l.pushing)?l.bottomOffset:l.offset,t={top:v+A,bottom:v+A+w.height},u=H.get.direction(t.top),y=(s)?0:H.get.elementScroll(t.top),B=!s,x=(z.height!==0);if(x){if(H.is.initialPosition()){if(t.top>C.bottom){H.debug("Element bottom of container");H.bindBottom()}else{if(t.top>z.top){H.debug("Element passed, fixing element to page");H.fixTop()}}}else{if(H.is.fixed()){if(H.is.top()){if(t.top<z.top){H.debug("Fixed element reached top of container");H.setInitialPosition()}else{if((z.height+t.top-y)>C.bottom){H.debug("Fixed element reached bottom of container");H.bindBottom()}else{if(B){H.set.scroll(y)}}}}else{if(H.is.bottom()){if((t.bottom-z.height)<z.top){H.debug("Bottom fixed rail has reached top of container");H.setInitialPosition()}else{if(t.bottom>C.bottom){H.debug("Bottom fixed rail has reached bottom of container");H.bindBottom()}else{if(B){H.set.scroll(y)}}}}}}else{if(H.is.bottom()){if(l.pushing){if(H.is.bound()&&t.bottom<C.bottom){H.debug("Fixing bottom attached element to bottom of browser.");H.fixBottom()}}else{if(H.is.bound()&&(t.top<C.bottom-z.height)){H.debug("Fixing bottom attached element to top of browser.");H.fixTop()}}}}}}H.save.lastScroll(t.top);H.save.elementScroll(y)},bindTop:function(){H.debug("Binding element to top of parent container");H.remove.offset();G.css({left:"",top:"",marginBottom:""}).removeClass(J.fixed).removeClass(J.bottom).addClass(J.bound).addClass(J.top);l.onTop.call(O);l.onUnstick.call(O)},bindBottom:function(){H.debug("Binding element to bottom of parent container");H.remove.offset();G.css({left:"",top:"",marginBottom:H.cache.context.bottomPadding}).removeClass(J.fixed).removeClass(J.top).addClass(J.bound).addClass(J.bottom);l.onBottom.call(O);l.onUnstick.call(O)},setInitialPosition:function(){H.unfix();H.unbind()},fixTop:function(){H.debug("Fixing element to top of page");H.set.minimumSize();H.set.offset();G.css({left:H.cache.element.left,bottom:"",marginBottom:""}).removeClass(J.bound).removeClass(J.bottom).addClass(J.fixed).addClass(J.top);l.onStick.call(O)},fixBottom:function(){H.debug("Sticking element to bottom of page");H.set.minimumSize();H.set.offset();G.css({left:H.cache.element.left,bottom:"",marginBottom:""}).removeClass(J.bound).removeClass(J.top).addClass(J.fixed).addClass(J.bottom);l.onStick.call(O)},unbind:function(){H.debug("Removing absolute position on element");H.remove.offset();G.removeClass(J.bound).removeClass(J.top).removeClass(J.bottom)},unfix:function(){H.debug("Removing fixed position on element");H.remove.offset();G.removeClass(J.fixed).removeClass(J.top).removeClass(J.bottom);l.onUnstick.call(O)},reset:function(){H.debug("Reseting elements position");H.unbind();H.unfix();H.resetCSS();H.remove.offset();H.remove.lastScroll()},resetCSS:function(){G.css({width:"",height:""});k.css({height:""})},setting:function(t,s){if(h.isPlainObject(t)){h.extend(true,l,t)}else{if(s!==g){l[t]=s}else{return l[t]}}},internal:function(t,s){if(h.isPlainObject(t)){h.extend(true,H,t)}else{if(s!==g){H[t]=s}else{return H[t]}}},debug:function(){if(l.debug){if(l.performance){H.performance.log(arguments)}else{H.debug=Function.prototype.bind.call(console.info,console,l.name+":");H.debug.apply(console,arguments)}}},verbose:function(){if(l.verbose&&l.debug){if(l.performance){H.performance.log(arguments)}else{H.verbose=Function.prototype.bind.call(console.info,console,l.name+":");H.verbose.apply(console,arguments)}}},error:function(){H.error=Function.prototype.bind.call(console.error,console,l.name+":");H.error.apply(console,arguments)},performance:{log:function(t){var u,s,v;if(l.performance){u=new Date().getTime();v=q||u;s=u-v;q=u;d.push({Name:t[0],Arguments:[].slice.call(t,1)||"",Element:O,"Execution Time":s})}clearTimeout(H.performance.timer);H.performance.timer=setTimeout(H.performance.display,0)},display:function(){var s=l.name+":",t=0;q=false;clearTimeout(H.performance.timer);h.each(d,function(v,u){t+=u["Execution Time"]});s+=" "+t+"ms";if(o){s+=" '"+o+"'"}if((console.group!==g||console.table!==g)&&d.length>0){console.groupCollapsed(s);if(console.table){console.table(d)}else{h.each(d,function(v,u){console.log(u.Name+": "+u["Execution Time"]+"ms")})}console.groupEnd()}d=[]}},invoke:function(t,x,v){var w=m,s,u,y;x=x||b;v=O||v;if(typeof t=="string"&&w!==g){t=t.split(/[\. ]/);s=t.length-1;h.each(t,function(A,B){var z=(A!=s)?B+t[A+1].charAt(0).toUpperCase()+t[A+1].slice(1):t;if(h.isPlainObject(w[z])&&(A!=s)){w=w[z]}else{if(w[z]!==g){u=w[z];return false}else{if(h.isPlainObject(w[B])&&(A!=s)){w=w[B]}else{if(w[B]!==g){u=w[B];return false}else{return false}}}}})}if(h.isFunction(u)){y=u.apply(v,x)}else{if(u!==g){y=u}}if(h.isArray(p)){p.push(y)}else{if(p!==g){p=[p,y]}else{if(y!==g){p=y}}}return u}};if(r){if(m===g){H.initialize()}H.invoke(n)}else{if(m!==g){m.invoke("destroy")}H.initialize()}});return(p!==g)?p:this};h.fn.sticky.settings={name:"Sticky",namespace:"sticky",debug:false,verbose:true,performance:true,pushing:false,context:false,scrollContext:e,offset:0,bottomOffset:0,jitter:5,observeChanges:false,onReposition:function(){},onScroll:function(){},onStick:function(){},onUnstick:function(){},onTop:function(){},onBottom:function(){},error:{container:"Sticky element must be inside a relative container",visible:"Element is hidden, you must call refresh after element becomes visible",method:"The method you called is not defined.",invalidContext:"Context specified does not exist",elementSize:"Sticky element is larger than its container, cannot create sticky."},className:{bound:"bound",fixed:"fixed",supported:"native",top:"top",bottom:"bottom"}}})(jQuery,window,document);