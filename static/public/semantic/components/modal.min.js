/*!
 * # Semantic UI x.x - Modal
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(c,b,a,d){c.fn.modal=function(q){var o=c(this),f=c(b),i=c(a),j=c("body"),l=o.selector||"",g=new Date().getTime(),n=[],m=arguments[0],e=(typeof m=="string"),p=[].slice.call(arguments,1),k=b.requestAnimationFrame||b.mozRequestAnimationFrame||b.webkitRequestAnimationFrame||b.msRequestAnimationFrame||function(r){setTimeout(r,0)},h;o.each(function(){var J=(c.isPlainObject(q))?c.extend(true,{},c.fn.modal.settings,q):c.extend({},c.fn.modal.settings),I=J.selector,t=J.className,z=J.namespace,G=J.error,D="."+z,A="module-"+z,w=c(this),C=c(J.context),u=w.find(I.close),L,y,F,x,E,s=this,K=w.data(A),v,B,H,r;r={initialize:function(){r.verbose("Initializing dimmer",C);r.create.id();r.create.dimmer();r.refreshModals();r.bind.events();if(J.observeChanges){r.observeChanges()}r.instantiate()},instantiate:function(){r.verbose("Storing instance of modal");K=r;w.data(A,K)},create:{dimmer:function(){var M={debug:J.debug,dimmerName:"modals",duration:{show:J.duration,hide:J.duration}},N=c.extend(true,M,J.dimmerSettings);if(J.inverted){N.variation=(N.variation!==d)?N.variation+" inverted":"inverted"}if(c.fn.dimmer===d){r.error(G.dimmer);return}r.debug("Creating dimmer with settings",N);x=C.dimmer(N);if(J.detachable){r.verbose("Modal is detachable, moving content into dimmer");x.dimmer("add content",w)}else{r.set.undetached()}if(J.blurring){x.addClass(t.blurring)}E=x.dimmer("get dimmer")},id:function(){B=(Math.random().toString(16)+"000000000").substr(2,8);v="."+B;r.verbose("Creating unique id for element",B)}},destroy:function(){r.verbose("Destroying previous modal");w.removeData(A).off(D);f.off(v);u.off(D);C.dimmer("destroy")},observeChanges:function(){if("MutationObserver" in b){H=new MutationObserver(function(M){r.debug("DOM tree modified, refreshing");r.refresh()});H.observe(s,{childList:true,subtree:true});r.debug("Setting up mutation observer",H)}},refresh:function(){r.remove.scrolling();r.cacheSizes();r.set.screenHeight();r.set.type();r.set.position()},refreshModals:function(){y=w.siblings(I.modal);L=y.add(w)},attachEvents:function(M,O){var N=c(M);O=c.isFunction(r[O])?r[O]:r.toggle;if(N.length>0){r.debug("Attaching modal events to element",M,O);N.off(D).on("click"+D,O)}else{r.error(G.notFound,M)}},bind:{events:function(){r.verbose("Attaching events");w.on("click"+D,I.close,r.event.close).on("click"+D,I.approve,r.event.approve).on("click"+D,I.deny,r.event.deny);f.on("resize"+v,r.event.resize)}},get:{id:function(){return(Math.random().toString(16)+"000000000").substr(2,8)}},event:{approve:function(){if(J.onApprove.call(s,c(this))===false){r.verbose("Approve callback returned false cancelling hide");return}r.hide()},deny:function(){if(J.onDeny.call(s,c(this))===false){r.verbose("Deny callback returned false cancelling hide");return}r.hide()},close:function(){r.hide()},click:function(P){var N=c(P.target),O=(N.closest(I.modal).length>0),M=c.contains(a.documentElement,P.target);if(!O&&M){r.debug("Dimmer clicked, hiding all modals");if(r.is.active()){r.remove.clickaway();if(J.allowMultiple){r.hide()}else{r.hideAll()}}}},debounce:function(N,M){clearTimeout(r.timer);r.timer=setTimeout(N,M)},keyboard:function(N){var O=N.which,M=27;if(O==M){if(J.closable){r.debug("Escape key pressed hiding modal");r.hide()}else{r.debug("Escape key pressed, but closable is set to false")}N.preventDefault()}},resize:function(){if(x.dimmer("is active")){k(r.refresh)}}},toggle:function(){if(r.is.active()||r.is.animating()){r.hide()}else{r.show()}},show:function(M){M=c.isFunction(M)?M:function(){};r.refreshModals();r.showModal(M)},hide:function(M){M=c.isFunction(M)?M:function(){};r.refreshModals();r.hideModal(M)},showModal:function(M){M=c.isFunction(M)?M:function(){};if(r.is.animating()||!r.is.active()){r.showDimmer();r.cacheSizes();r.set.position();r.set.screenHeight();r.set.type();r.set.clickaway();if(!J.allowMultiple&&r.others.active()){r.hideOthers(r.showModal)}else{J.onShow.call(s);if(J.transition&&c.fn.transition!==d&&w.transition("is supported")){r.debug("Showing modal with css animations");w.transition({debug:J.debug,animation:J.transition+" in",queue:J.queue,duration:J.duration,useFailSafe:true,onComplete:function(){J.onVisible.apply(s);r.add.keyboardShortcuts();r.save.focus();r.set.active();r.set.autofocus();M()}})}else{r.error(G.noTransition)}}}else{r.debug("Modal is already visible")}},hideModal:function(N,M){N=c.isFunction(N)?N:function(){};r.debug("Hiding modal");J.onHide.call(s);if(r.is.animating()||r.is.active()){if(J.transition&&c.fn.transition!==d&&w.transition("is supported")){r.remove.active();w.transition({debug:J.debug,animation:J.transition+" out",queue:J.queue,duration:J.duration,useFailSafe:true,onStart:function(){if(!r.others.active()&&!M){r.hideDimmer()}r.remove.keyboardShortcuts()},onComplete:function(){J.onHidden.call(s);r.restore.focus();N()}})}else{r.error(G.noTransition)}}},showDimmer:function(){if(x.dimmer("is animating")||!x.dimmer("is active")){r.debug("Showing dimmer");x.dimmer("show")}else{r.debug("Dimmer already visible")}},hideDimmer:function(){if(x.dimmer("is animating")||(x.dimmer("is active"))){x.dimmer("hide",function(){if(J.transition&&c.fn.transition!==d&&w.transition("is supported")){r.remove.clickaway();r.remove.screenHeight()}})}else{r.debug("Dimmer is not visible cannot hide");return}},hideAll:function(N){var M=L.filter("."+t.active+", ."+t.animating);N=c.isFunction(N)?N:function(){};if(M.length>0){r.debug("Hiding all visible modals");r.hideDimmer();M.modal("hide modal",N)}},hideOthers:function(N){var M=y.filter("."+t.active+", ."+t.animating);N=c.isFunction(N)?N:function(){};if(M.length>0){r.debug("Hiding other modals",y);M.modal("hide modal",N,true)}},others:{active:function(){return(y.filter("."+t.active).length>0)},animating:function(){return(y.filter("."+t.animating).length>0)}},add:{keyboardShortcuts:function(){r.verbose("Adding keyboard shortcuts");i.on("keyup"+D,r.event.keyboard)}},save:{focus:function(){F=c(a.activeElement).blur()}},restore:{focus:function(){if(F&&F.length>0){F.focus()}}},remove:{active:function(){w.removeClass(t.active)},clickaway:function(){if(J.closable){E.off("click"+v)}},screenHeight:function(){if(r.cache.height>r.cache.pageHeight){r.debug("Removing page height");j.css("height","")}},keyboardShortcuts:function(){r.verbose("Removing keyboard shortcuts");i.off("keyup"+D)},scrolling:function(){x.removeClass(t.scrolling);w.removeClass(t.scrolling)}},cacheSizes:function(){var M=w.outerHeight();if(r.cache===d||M!==0){r.cache={pageHeight:c(a).outerHeight(),height:M+J.offset,contextHeight:(J.context=="body")?c(b).height():x.height()}}r.debug("Caching modal and container sizes",r.cache)},can:{fit:function(){return((r.cache.height+(J.padding*2))<r.cache.contextHeight)}},is:{active:function(){return w.hasClass(t.active)},animating:function(){return w.transition("is supported")?w.transition("is animating"):w.is(":visible")},scrolling:function(){return x.hasClass(t.scrolling)},modernBrowser:function(){return !(b.ActiveXObject||"ActiveXObject" in b)}},set:{autofocus:function(){if(J.autofocus){var M=w.filter(":input").filter(":visible"),N=M.filter("[autofocus]"),O=(N.length>0)?N.first():M.first();if(O.length>0){O.focus()}}},clickaway:function(){if(J.closable){E.on("click"+v,r.event.click)}},screenHeight:function(){if(r.can.fit()){j.css("height","")}else{r.debug("Modal is taller than page content, resizing page height");j.css("height",r.cache.height+(J.padding*2))}},active:function(){w.addClass(t.active)},scrolling:function(){x.addClass(t.scrolling);w.addClass(t.scrolling)},type:function(){if(r.can.fit()){r.verbose("Modal fits on screen");if(!r.others.active()&&!r.others.animating()){r.remove.scrolling()}}else{r.verbose("Modal cannot fit on screen setting to scrolling");r.set.scrolling()}},position:function(){r.verbose("Centering modal on page",r.cache);if(r.can.fit()){w.css({top:"",marginTop:-(r.cache.height/2)})}else{w.css({marginTop:"",top:i.scrollTop()})}},undetached:function(){x.addClass(t.undetached)}},setting:function(M,N){r.debug("Changing setting",M,N);if(c.isPlainObject(M)){c.extend(true,J,M)}else{if(N!==d){J[M]=N}else{return J[M]}}},internal:function(M,N){if(c.isPlainObject(M)){c.extend(true,r,M)}else{if(N!==d){r[M]=N}else{return r[M]}}},debug:function(){if(J.debug){if(J.performance){r.performance.log(arguments)}else{r.debug=Function.prototype.bind.call(console.info,console,J.name+":");r.debug.apply(console,arguments)}}},verbose:function(){if(J.verbose&&J.debug){if(J.performance){r.performance.log(arguments)}else{r.verbose=Function.prototype.bind.call(console.info,console,J.name+":");r.verbose.apply(console,arguments)}}},error:function(){r.error=Function.prototype.bind.call(console.error,console,J.name+":");r.error.apply(console,arguments)},performance:{log:function(O){var N,P,M;if(J.performance){N=new Date().getTime();M=g||N;P=N-M;g=N;n.push({Name:O[0],Arguments:[].slice.call(O,1)||"",Element:s,"Execution Time":P})}clearTimeout(r.performance.timer);r.performance.timer=setTimeout(r.performance.display,500)},display:function(){var N=J.name+":",M=0;g=false;clearTimeout(r.performance.timer);c.each(n,function(O,P){M+=P["Execution Time"]});N+=" "+M+"ms";if(l){N+=" '"+l+"'"}if((console.group!==d||console.table!==d)&&n.length>0){console.groupCollapsed(N);if(console.table){console.table(n)}else{c.each(n,function(O,P){console.log(P.Name+": "+P["Execution Time"]+"ms")})}console.groupEnd()}n=[]}},invoke:function(R,N,P){var O=K,S,Q,M;N=N||p;P=s||P;if(typeof R=="string"&&O!==d){R=R.split(/[\. ]/);S=R.length-1;c.each(R,function(V,U){var T=(V!=S)?U+R[V+1].charAt(0).toUpperCase()+R[V+1].slice(1):R;if(c.isPlainObject(O[T])&&(V!=S)){O=O[T]}else{if(O[T]!==d){Q=O[T];return false}else{if(c.isPlainObject(O[U])&&(V!=S)){O=O[U]}else{if(O[U]!==d){Q=O[U];return false}else{return false}}}}})}if(c.isFunction(Q)){M=Q.apply(P,N)}else{if(Q!==d){M=Q}}if(c.isArray(h)){h.push(M)}else{if(h!==d){h=[h,M]}else{if(M!==d){h=M}}}return Q}};if(e){if(K===d){r.initialize()}r.invoke(m)}else{if(K!==d){K.invoke("destroy")}r.initialize()}});return(h!==d)?h:this};c.fn.modal.settings={name:"Modal",namespace:"modal",debug:false,verbose:false,performance:true,observeChanges:false,allowMultiple:false,detachable:true,closable:true,autofocus:true,inverted:false,blurring:false,dimmerSettings:{closable:false,useCSS:true},context:"body",queue:false,duration:500,offset:0,transition:"scale",padding:50,onShow:function(){},onVisible:function(){},onHide:function(){},onHidden:function(){},onApprove:function(){return true},onDeny:function(){return true},selector:{close:".close",approve:".actions .positive, .actions .approve, .actions .ok",deny:".actions .negative, .actions .deny, .actions .cancel",modal:".ui.modal"},error:{dimmer:"UI Dimmer, a required component is not included in this page",method:"The method you called is not defined.",notFound:"The element you specified could not be found"},className:{active:"active",animating:"animating",blurring:"blurring",scrolling:"scrolling",undetached:"undetached"}}})(jQuery,window,document);