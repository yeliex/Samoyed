/*!
 * # Semantic UI x.x - API
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;!function(c,a,b,d){c.api=c.fn.api=function(e){var f,p=c(c.isFunction(this)?a:this),m=p.selector||"",h=(new Date).getTime(),n=[],k=arguments[0],j="string"==typeof k,g=[].slice.call(arguments,1);return p.each(function(){var E,M,N,I,H,O,B=c.isPlainObject(e)?c.extend(!0,{},c.fn.api.settings,e):c.extend({},c.fn.api.settings),L=B.namespace,t=B.metadata,F=B.selector,o=B.error,u=B.className,J="."+L,G="module-"+L,l=c(this),i=l.closest(F.form),r=B.stateContext?c(B.stateContext):l,z=this,K=r[0],C=l.data(G);O={initialize:function(){j||O.bind.events(),O.instantiate()},instantiate:function(){O.verbose("Storing instance of module",O),C=O,l.data(G,C)},destroy:function(){O.verbose("Destroying previous module for",z),l.removeData(G).off(J)},bind:{events:function(){var q=O.get.event();q?(O.verbose("Attaching API events to element",q),l.on(q+J,O.event.trigger)):"now"==B.on&&(O.debug("Querying API now",q),O.query())}},read:{cachedResponse:function(s){var q;if(a.Storage===d){return void O.error(o.noStorage)}if(q=sessionStorage.getItem(s),O.debug("Using cached response",s,q),q!==d){try{q=JSON.parse(q)}catch(v){}return q}return !1}},write:{cachedResponse:function(q,s){return s&&""===s?void O.debug("Response empty, not caching",s):a.Storage===d?void O.error(o.noStorage):(c.isPlainObject(s)&&(s=JSON.stringify(s)),sessionStorage.setItem(q,s),void O.verbose("Storing cached response for url",q,s))}},query:function(){if(O.is.disabled()){return void O.debug("Element is disabled API request aborted")}if(O.is.loading()){if(!B.interruptRequests){return void O.debug("Cancelling request, previous request is still pending")}O.debug("Interrupting previous request"),O.abort()}return B.defaultData&&c.extend(!0,B.urlData,O.get.defaultData()),B.serializeForm&&(B.data=O.add.formData(B.data)),M=O.get.settings(),M===!1?(O.cancelled=!0,void O.error(o.beforeSend)):(O.cancelled=!1,N=O.get.templatedURL(),N||O.is.mocked()?(N=O.add.urlData(N),N||O.is.mocked()?(E=c.extend(!0,{},B,{type:B.method||B.type,data:I,url:B.base+N,beforeSend:B.beforeXHR,success:function(){},failure:function(){},complete:function(){}}),O.debug("Querying URL",E.url),O.verbose("Using AJAX settings",E),"local"===B.cache&&O.read.cachedResponse(N)?(O.debug("Response returned from local cache"),O.request=O.create.request(),void O.request.resolveWith(K,[O.read.cachedResponse(N)])):void (B.throttle?B.throttleFirstRequest||O.timer?(O.debug("Throttling request",B.throttle),clearTimeout(O.timer),O.timer=setTimeout(function(){O.timer&&delete O.timer,O.debug("Sending throttled request",I,E.method),O.send.request()},B.throttle)):(O.debug("Sending request",I,E.method),O.send.request(),O.timer=setTimeout(function(){},B.throttle)):(O.debug("Sending request",I,E.method),O.send.request()))):void 0):void O.error(o.missingURL))},is:{disabled:function(){return l.filter(F.disabled).length>0},form:function(){return l.is("form")},mocked:function(){return B.mockResponse||B.mockResponseAsync},input:function(){return l.is("input")},loading:function(){return O.request&&"pending"==O.request.state()},abortedRequest:function(q){return q&&q.readyState!==d&&0===q.readyState?(O.verbose("XHR request determined to be aborted"),!0):(O.verbose("XHR request was not aborted"),!1)},validResponse:function(q){return"json"===B.dataType&&c.isFunction(B.successTest)?(O.debug("Checking JSON returned success",B.successTest,q),B.successTest(q)?(O.debug("Response passed success test",q),!0):(O.debug("Response failed success test",q),!1)):(O.verbose("Response is not JSON, skipping validation",B.successTest,q),!0)}},was:{cancelled:function(){return O.cancelled||!1},succesful:function(){return O.request&&"resolved"==O.request.state()},failure:function(){return O.request&&"rejected"==O.request.state()},complete:function(){return O.request&&("resolved"==O.request.state()||"rejected"==O.request.state())}},add:{urlData:function(q,w){var x,v;return q&&(x=q.match(B.regExp.required),v=q.match(B.regExp.optional),w=w||B.urlData,x&&(O.debug("Looking for required URL variables",x),c.each(x,function(P,D){var y=-1!==D.indexOf("$")?D.substr(2,D.length-3):D.substr(1,D.length-2),A=c.isPlainObject(w)&&w[y]!==d?w[y]:l.data(y)!==d?l.data(y):r.data(y)!==d?r.data(y):w[y];return A===d?(O.error(o.requiredParameter,y,q),q=!1,!1):(O.verbose("Found required variable",y,A),void (q=q.replace(D,A)))})),v&&(O.debug("Looking for optional URL variables",x),c.each(v,function(P,D){var y=-1!==D.indexOf("$")?D.substr(3,D.length-4):D.substr(2,D.length-3),A=c.isPlainObject(w)&&w[y]!==d?w[y]:l.data(y)!==d?l.data(y):r.data(y)!==d?r.data(y):w[y];A!==d?(O.verbose("Optional variable Found",y,A),q=q.replace(D,A)):(O.verbose("Optional variable not found",y),q=-1!==q.indexOf("/"+D)?q.replace("/"+D,""):q.replace(D,""))}))),q},formData:function(q){var w,x=c.fn.serializeObject!==d,v=x?i.serializeObject():i.serialize();return q=q||B.data,w=c.isPlainObject(q),w?x?(O.debug("Extending existing data with form data",q,v),q=c.extend(!0,{},q,v)):(O.error(o.missingSerialize),O.debug("Cant extend data. Replacing data with form data",q,v),q=v):(O.debug("Adding form data",v),q=v),q}},send:{request:function(){O.set.loading(),O.request=O.create.request(),O.is.mocked()?O.mockedXHR=O.create.mockedXHR():O.xhr=O.create.xhr(),B.onRequest.call(K,O.request,O.xhr)}},event:{trigger:function(q){O.query(),("submit"==q.type||"click"==q.type)&&q.preventDefault()},xhr:{always:function(){},done:function(w,y,D){var A=this,x=(new Date).getTime()-H,q=B.loadingDuration-x,v=c.isFunction(B.onResponse)?B.onResponse.call(A,c.extend(!0,{},w)):!1;q=q>0?q:0,v&&(O.debug("Modified API response in onResponse callback",B.onResponse,v,w),w=v),q>0&&O.debug("Response completed early delaying state change by",q),setTimeout(function(){O.is.validResponse(w)?O.request.resolveWith(A,[w]):O.request.rejectWith(A,[D,"invalid"])},q)},fail:function(x,q,w){var A=this,y=(new Date).getTime()-H,v=B.loadingDuration-y;v=v>0?v:0,v>0&&O.debug("Response completed early delaying state change by",v),setTimeout(function(){O.is.abortedRequest(x)?O.request.rejectWith(A,[x,"aborted",w]):O.request.rejectWith(A,[x,"error",q,w])},v)}},request:{complete:function(q){O.remove.loading(),B.onComplete.call(K,q,l)},done:function(q){O.debug("Successful API Response",q),"local"===B.cache&&N&&(O.write.cachedResponse(N,q),O.debug("Saving server response locally",O.cache)),B.onSuccess.call(K,q,l)},fail:function(v,w,x){var q=c.isPlainObject(v)?v.responseText:!1,s=c.isPlainObject(q)&&q.error!==d?q.error:B.error[w]!==d?B.error[w]:x;"aborted"==w?(O.debug("XHR Aborted (Most likely caused by page navigation or CORS Policy)",w,x),B.onAbort.call(K,w,l)):"invalid"==w?O.debug("JSON did not pass success test. A server-side error has most likely occurred",q):"error"==w&&v!==d&&(O.debug("XHR produced a server error",w,x),200!=v.status&&x!==d&&""!==x&&O.error(o.statusMessage+x,E.url),B.onError.call(K,s,l)),B.errorDuration&&"aborted"!==w&&(O.debug("Adding error state"),O.set.error(),setTimeout(O.remove.error,B.errorDuration)),O.debug("API Request failed",s,v),B.onFailure.call(K,q,l)}}},create:{request:function(){return c.Deferred().always(O.event.request.complete).done(O.event.request.done).fail(O.event.request.fail)},mockedXHR:function(){var v,x,A,y=!1,w=!1,q=!1;return A=c.Deferred().always(O.event.xhr.complete).done(O.event.xhr.done).fail(O.event.xhr.fail),B.mockResponse?(c.isFunction(B.mockResponse)?(O.debug("Using mocked callback returning response",B.mockResponse),x=B.mockResponse.call(K,B)):(O.debug("Using specified response",B.mockResponse),x=B.mockResponse),A.resolveWith(K,[x,y,{responseText:x}])):c.isFunction(B.mockResponseAsync)&&(v=function(s){O.debug("Async callback returned response",s),s?A.resolveWith(K,[s,y,{responseText:s}]):A.rejectWith(K,[{responseText:s},w,q])},O.debug("Using async mocked response",B.mockResponseAsync),B.mockResponseAsync.call(K,B,v)),A},xhr:function(){var q;return q=c.ajax(E).always(O.event.xhr.always).done(O.event.xhr.done).fail(O.event.xhr.fail),O.verbose("Created server request",q),q}},set:{error:function(){O.verbose("Adding error state to element",r),r.addClass(u.error)},loading:function(){O.verbose("Adding loading state to element",r),r.addClass(u.loading),H=(new Date).getTime()}},remove:{error:function(){O.verbose("Removing error state from element",r),r.removeClass(u.error)},loading:function(){O.verbose("Removing loading state from element",r),r.removeClass(u.loading)}},get:{request:function(){return O.request||!1},xhr:function(){return O.xhr||!1},settings:function(){var q;return q=B.beforeSend.call(K,B),q&&(q.success!==d&&(O.debug("Legacy success callback detected",q),O.error(o.legacyParameters,q.success),q.onSuccess=q.success),q.failure!==d&&(O.debug("Legacy failure callback detected",q),O.error(o.legacyParameters,q.failure),q.onFailure=q.failure),q.complete!==d&&(O.debug("Legacy complete callback detected",q),O.error(o.legacyParameters,q.complete),q.onComplete=q.complete)),q===d&&O.error(o.noReturnedValue),q!==d?q:B},defaultData:function(){var q={};return c.isWindow(z)||(O.is.input()?q.value=l.val():O.is.form()&&(q.text=l.text())),q},event:function(){return c.isWindow(z)||"now"==B.on?(O.debug("API called without element, no events attached"),!1):"auto"==B.on?l.is("input")?z.oninput!==d?"input":z.onpropertychange!==d?"propertychange":"keyup":l.is("form")?"submit":"click":B.on},templatedURL:function(q){if(q=q||l.data(t.action)||B.action||!1,N=l.data(t.url)||B.url||!1){return O.debug("Using specified url",N),N}if(q){if(O.debug("Looking up url for action",q,B.api),B.api[q]===d&&!O.is.mocked()){return void O.error(o.missingAction,B.action,B.api)}N=B.api[q]}else{O.is.form()&&(N=l.attr("action")||!1,O.debug("No url or action specified, defaulting to form action",N))}return N}},abort:function(){var q=O.get.xhr();q&&"resolved"!==q.state()&&(O.debug("Cancelling API request"),q.abort())},reset:function(){O.remove.error(),O.remove.loading()},setting:function(q,s){if(O.debug("Changing setting",q,s),c.isPlainObject(q)){c.extend(!0,B,q)}else{if(s===d){return B[q]}B[q]=s}},internal:function(q,s){if(c.isPlainObject(q)){c.extend(!0,O,q)}else{if(s===d){return O[q]}O[q]=s}},debug:function(){B.debug&&(B.performance?O.performance.log(arguments):(O.debug=Function.prototype.bind.call(console.info,console,B.name+":"),O.debug.apply(console,arguments)))},verbose:function(){B.verbose&&B.debug&&(B.performance?O.performance.log(arguments):(O.verbose=Function.prototype.bind.call(console.info,console,B.name+":"),O.verbose.apply(console,arguments)))},error:function(){O.error=Function.prototype.bind.call(console.error,console,B.name+":"),O.error.apply(console,arguments)},performance:{log:function(v){var q,s,w;B.performance&&(q=(new Date).getTime(),w=h||q,s=q-w,h=q,n.push({Name:v[0],Arguments:[].slice.call(v,1)||"","Execution Time":s})),clearTimeout(O.performance.timer),O.performance.timer=setTimeout(O.performance.display,500)},display:function(){var q=B.name+":",s=0;h=!1,clearTimeout(O.performance.timer),c.each(n,function(w,v){s+=v["Execution Time"]}),q+=" "+s+"ms",m&&(q+=" '"+m+"'"),(console.group!==d||console.table!==d)&&n.length>0&&(console.groupCollapsed(q),console.table?console.table(n):c.each(n,function(w,v){console.log(v.Name+": "+v["Execution Time"]+"ms")}),console.groupEnd()),n=[]}},invoke:function(x,A,y){var q,w,v,D=C;return A=A||g,y=z||y,"string"==typeof x&&D!==d&&(x=x.split(/[\. ]/),q=x.length-1,c.each(x,function(Q,R){var P=Q!=q?R+x[Q+1].charAt(0).toUpperCase()+x[Q+1].slice(1):x;if(c.isPlainObject(D[P])&&Q!=q){D=D[P]}else{if(D[P]!==d){return w=D[P],!1}if(!c.isPlainObject(D[R])||Q==q){return D[R]!==d?(w=D[R],!1):(O.error(o.method,x),!1)}D=D[R]}})),c.isFunction(w)?v=w.apply(y,A):w!==d&&(v=w),c.isArray(f)?f.push(v):f!==d?f=[f,v]:v!==d&&(f=v),w}},j?(C===d&&O.initialize(),O.invoke(k)):(C!==d&&C.invoke("destroy"),O.initialize())}),f!==d?f:this},c.api.settings={name:"API",namespace:"api",debug:!0,verbose:!1,performance:!0,api:{},cache:!0,interruptRequests:!0,on:"auto",stateContext:!1,loadingDuration:0,errorDuration:2000,action:!1,url:!1,base:"",urlData:{},defaultData:!0,serializeForm:!1,throttle:0,throttleFirstRequest:!0,method:"get",data:{},dataType:"json",mockResponse:!1,mockResponseAsync:!1,beforeSend:function(f){return f},beforeXHR:function(f){},onRequest:function(g,f){},onResponse:!1,onSuccess:function(g,f){},onComplete:function(g,f){},onFailure:function(g,f){},onError:function(g,f){},onAbort:function(g,f){},successTest:!1,error:{beforeSend:"The before send function has aborted the request",error:"There was an error with your request",exitConditions:"API Request Aborted. Exit conditions met",JSONParse:"JSON could not be parsed during error handling",legacyParameters:"You are using legacy API success callback names",method:"The method you called is not defined",missingAction:"API action used but no url was defined",missingSerialize:"jquery-serialize-object is required to add form data to an existing data object",missingURL:"No URL specified for api event",noReturnedValue:"The beforeSend callback must return a settings object, beforeSend ignored.",noStorage:"Caching respopnses locally requires session storage",parseError:"There was an error parsing your request",requiredParameter:"Missing a required URL parameter: ",statusMessage:"Server gave an error: ",timeout:"Your request timed out"},regExp:{required:/\{\$*[A-z0-9]+\}/g,optional:/\{\/\$*[A-z0-9]+\}/g},className:{loading:"loading",error:"error"},selector:{disabled:".disabled",form:"form"},metadata:{action:"action",url:"url"}}}(jQuery,window,document);