/*!
 * # Semantic UI x.x - Search
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(c,b,a,d){c.fn.search=function(m){var k=c(this),h=k.selector||"",f=new Date().getTime(),j=[],i=arguments[0],e=(typeof i=="string"),l=[].slice.call(arguments,1),g;c(this).each(function(){var D=(c.isPlainObject(m))?c.extend(true,{},c.fn.search.settings,m):c.extend({},c.fn.search.settings),p=D.className,t=D.metadata,s=D.regExp,B=D.selector,z=D.error,u=D.namespace,y="."+u,w=u+"-module",r=c(this),A=r.find(B.prompt),C=r.find(B.searchButton),q=r.find(B.results),x=r.find(B.result),v=r.find(B.category),o=this,E=r.data(w),n;n={initialize:function(){n.verbose("Initializing module");n.determine.searchFields();n.bind.events();n.set.type();n.create.results();n.instantiate()},instantiate:function(){n.verbose("Storing instance of module",n);E=n;r.data(w,n)},destroy:function(){n.verbose("Destroying instance");r.off(y).removeData(w)},bind:{events:function(){n.verbose("Binding events to search");if(D.automatic){r.on(n.get.inputEvent()+y,B.prompt,n.event.input);A.attr("autocomplete","off")}r.on("focus"+y,B.prompt,n.event.focus).on("blur"+y,B.prompt,n.event.blur).on("keydown"+y,B.prompt,n.handleKeyboard).on("click"+y,B.searchButton,n.query).on("mousedown"+y,B.results,n.event.result.mousedown).on("mouseup"+y,B.results,n.event.result.mouseup).on("click"+y,B.result,n.event.result.click)}},determine:{searchFields:function(){if(m&&m.searchFields!==d){D.searchFields=m.searchFields}}},event:{input:function(){clearTimeout(n.timer);n.timer=setTimeout(n.query,D.searchDelay)},focus:function(){n.set.focus();if(n.has.minimumCharacters()){n.query();n.showResults()}},blur:function(F){var G=(a.activeElement===this);if(!G&&!n.resultsClicked){n.cancel.query();n.remove.focus();n.timer=setTimeout(n.hideResults,D.hideDelay)}},result:{mousedown:function(){n.resultsClicked=true},mouseup:function(){n.resultsClicked=false},click:function(F){n.debug("Search result selected");var J=c(this),M=J.find(B.title).eq(0),L=J.find("a[href]").eq(0),G=L.attr("href")||false,K=L.attr("target")||false,N=M.html(),O=(M.length>0)?M.text():false,I=n.get.results(),P=J.data(t.result)||n.get.result(O,I),H;if(c.isFunction(D.onSelect)){if(D.onSelect.call(o,P,I)===false){n.debug("Custom onSelect callback cancelled default select action");return}}n.hideResults();if(O){n.set.value(O)}if(G){n.verbose("Opening search link found in result",L);if(K=="_blank"||F.ctrlKey){b.open(G)}else{b.location.href=(G)}}}}},handleKeyboard:function(L){var I=r.find(B.result),H=r.find(B.category),G=I.index(I.filter("."+p.active)),F=I.length,M=L.which,K={backspace:8,enter:13,escape:27,upArrow:38,downArrow:40},J;if(M==K.escape){n.verbose("Escape key pressed, blurring search field");A.trigger("blur")}if(n.is.visible()){if(M==K.enter){n.verbose("Enter key pressed, selecting active result");if(I.filter("."+p.active).length>0){n.event.result.click.call(I.filter("."+p.active),L);L.preventDefault();return false}}else{if(M==K.upArrow){n.verbose("Up key pressed, changing active result");J=(G-1<0)?G:G-1;H.removeClass(p.active);I.removeClass(p.active).eq(J).addClass(p.active).closest(H).addClass(p.active);L.preventDefault()}else{if(M==K.downArrow){n.verbose("Down key pressed, changing active result");J=(G+1>=F)?G:G+1;H.removeClass(p.active);I.removeClass(p.active).eq(J).addClass(p.active).closest(H).addClass(p.active);L.preventDefault()}}}}else{if(M==K.enter){n.verbose("Enter key pressed, executing query");n.query();n.set.buttonPressed();A.one("keyup",n.remove.buttonFocus)}}},setup:{api:function(){var F={debug:D.debug,on:false,cache:"local",action:"search",onError:n.error},G;n.verbose("First request, initializing API");r.api(F)}},can:{useAPI:function(){return c.fn.api!==d},transition:function(){return D.transition&&c.fn.transition!==d&&r.transition("is supported")}},is:{empty:function(){return(q.html()==="")},visible:function(){return(q.filter(":visible").length>0)},focused:function(){return(A.filter(":focus").length>0)}},get:{inputEvent:function(){var F=A[0],G=(F!==d&&F.oninput!==d)?"input":(F!==d&&F.onpropertychange!==d)?"propertychange":"keyup";return G},value:function(){return A.val()},results:function(){var F=r.data(t.results);return F},result:function(I,H){var G=["title","id"],F=false;I=(I!==d)?I:n.get.value();H=(H!==d)?H:n.get.results();if(D.type==="category"){n.debug("Finding result that matches",I);c.each(H,function(J,K){if(c.isArray(K.results)){F=n.search.object(I,K.results,G)[0];if(F){return false}}})}else{n.debug("Finding result in results object",I);F=n.search.object(I,H,G)[0]}return F||false}},set:{focus:function(){r.addClass(p.focus)},loading:function(){r.addClass(p.loading)},value:function(F){n.verbose("Setting search input value",F);A.val(F)},type:function(F){F=F||D.type;if(D.type=="category"){r.addClass(D.type)}},buttonPressed:function(){C.addClass(p.pressed)}},remove:{loading:function(){r.removeClass(p.loading)},focus:function(){r.removeClass(p.focus)},buttonPressed:function(){C.removeClass(p.pressed)}},query:function(){var G=n.get.value(),F=n.read.cache(G);if(n.has.minimumCharacters()){if(F){n.debug("Reading result from cache",G);n.save.results(F.results);n.addResults(F.html);n.inject.id(F.results)}else{n.debug("Querying for",G);if(c.isPlainObject(D.source)||c.isArray(D.source)){n.search.local(G)}else{if(n.can.useAPI()){n.search.remote(G)}else{n.error(z.source)}}D.onSearchQuery.call(o,G)}}else{n.hideResults()}},search:{local:function(F){var G=n.search.object(F,D.content),H;n.set.loading();n.save.results(G);n.debug("Returned local search results",G);H=n.generateResults({results:G});n.remove.loading();n.addResults(H);n.inject.id(G);n.write.cache(F,{html:H,results:G})},remote:function(F){var G={onSuccess:function(H){n.parse.response.call(o,H,F)},onFailure:function(){n.displayMessage(z.serverError)},urlData:{query:F}};if(!r.api("get request")){n.setup.api()}c.extend(true,G,D.apiSettings);n.debug("Executing search",G);n.cancel.query();r.api("setting",G).api("query")},object:function(I,L,M){var K=[],G=[],H=I.toString().replace(s.escape,"\\$&"),J=new RegExp(s.beginsWith+H,"i"),F=function(Q,O){var N=(c.inArray(O,K)==-1),P=(c.inArray(O,G)==-1);if(N&&P){Q.push(O)}};L=L||D.source;M=(M!==d)?M:D.searchFields;if(!c.isArray(M)){M=[M]}if(L===d||L===false){n.error(z.source);return[]}c.each(M,function(N,O){c.each(L,function(P,Q){var R=(typeof Q[O]=="string");if(R){if(Q[O].search(J)!==-1){F(K,Q)}else{if(D.searchFullText&&n.fuzzySearch(I,Q[O])){F(G,Q)}}}})});return c.merge(K,G)}},fuzzySearch:function(J,H){var L=H.length,G=J.length;if(typeof J!=="string"){return false}J=J.toLowerCase();H=H.toLowerCase();if(G>L){return false}if(G===L){return(J===H)}search:for(var K=0,F=0;K<G;K++){var I=J.charCodeAt(K);while(F<L){if(H.charCodeAt(F++)===I){continue search}}return false}return true},parse:{response:function(G,F){var H=n.generateResults(G);n.verbose("Parsing server response",G);if(G!==d){if(F!==d&&G.results!==d){n.addResults(H);n.inject.id(G.results);n.write.cache(F,{html:H,results:G.results});n.save.results(G.results)}}}},cancel:{query:function(){if(n.can.useAPI()){r.api("abort")}}},has:{minimumCharacters:function(){var F=n.get.value(),G=F.length;return(G>=D.minCharacters)}},clear:{cache:function(G){var F=r.data(t.cache);if(!G){n.debug("Clearing cache",G);r.removeData(t.cache)}else{if(G&&F&&F[G]){n.debug("Removing value from cache",G);delete F[G];r.data(t.cache,F)}}}},read:{cache:function(G){var F=r.data(t.cache);if(D.cache){n.verbose("Checking cache for generated html for query",G);return(typeof F=="object")&&(F[G]!==d)?F[G]:false}return false}},create:{id:function(F,I){var L=(F+1),H=(I+1),J,G,K;if(I!==d){G=String.fromCharCode(97+I);K=G+L;n.verbose("Creating category result id",K)}else{K=L;n.verbose("Creating result id",K)}return K},results:function(){if(q.length===0){q=c("<div />").addClass(p.results).appendTo(r)}}},inject:{result:function(G,F,I){n.verbose("Injecting result into results");var H=(I!==d)?q.children().eq(I).children(B.result).eq(F):q.children(B.result).eq(F);n.verbose("Injecting results metadata",H);H.data(t.result,G)},id:function(G){n.debug("Injecting unique ids into results");var H=0,F=0;if(D.type==="category"){c.each(G,function(I,J){F=0;c.each(J.results,function(L,M){var K=J.results[L];if(K.id===d){K.id=n.create.id(F,H)}n.inject.result(K,F,H);F++});H++})}else{c.each(G,function(J,K){var I=G[J];if(I.id===d){I.id=n.create.id(F)}n.inject.result(I,F);F++})}return G}},save:{results:function(F){n.verbose("Saving current search results to metadata",F);r.data(t.results,F)}},write:{cache:function(G,H){var F=(r.data(t.cache)!==d)?r.data(t.cache):{};if(D.cache){n.verbose("Writing generated html to cache",G,H);F[G]=H;r.data(t.cache,F)}}},addResults:function(F){if(c.isFunction(D.onResultsAdd)){if(D.onResultsAdd.call(q,F)===false){n.debug("onResultsAdd callback cancelled default action");return false}}q.html(F);n.showResults()},showResults:function(){if(!n.is.visible()&&n.is.focused()&&!n.is.empty()){if(n.can.transition()){n.debug("Showing results with css animations");q.transition({animation:D.transition+" in",debug:D.debug,verbose:D.verbose,duration:D.duration,queue:true})}else{n.debug("Showing results with javascript");q.stop().fadeIn(D.duration,D.easing)}D.onResultsOpen.call(q)}},hideResults:function(){if(n.is.visible()){if(n.can.transition()){n.debug("Hiding results with css animations");q.transition({animation:D.transition+" out",debug:D.debug,verbose:D.verbose,duration:D.duration,queue:true})}else{n.debug("Hiding results with javascript");q.stop().fadeOut(D.duration,D.easing)}D.onResultsClose.call(q)}},generateResults:function(F){n.debug("Generating html from response",F);var J=D.templates[D.type],I=(c.isPlainObject(F.results)&&!c.isEmptyObject(F.results)),H=(c.isArray(F.results)&&F.results.length>0),G="";if(I||H){if(D.maxResults>0){if(I){if(D.type=="standard"){n.error(z.maxResults)}}else{F.results=F.results.slice(0,D.maxResults)}}if(c.isFunction(J)){G=J(F)}else{n.error(z.noTemplate,false)}}else{G=n.displayMessage(z.noResults,"empty")}D.onResults.call(o,F);return G},displayMessage:function(G,F){F=F||"standard";n.debug("Displaying message",G,F);n.addResults(D.templates.message(G,F));return D.templates.message(G,F)},setting:function(F,G){if(c.isPlainObject(F)){c.extend(true,D,F)}else{if(G!==d){D[F]=G}else{return D[F]}}},internal:function(F,G){if(c.isPlainObject(F)){c.extend(true,n,F)}else{if(G!==d){n[F]=G}else{return n[F]}}},debug:function(){if(D.debug){if(D.performance){n.performance.log(arguments)}else{n.debug=Function.prototype.bind.call(console.info,console,D.name+":");n.debug.apply(console,arguments)}}},verbose:function(){if(D.verbose&&D.debug){if(D.performance){n.performance.log(arguments)}else{n.verbose=Function.prototype.bind.call(console.info,console,D.name+":");n.verbose.apply(console,arguments)}}},error:function(){n.error=Function.prototype.bind.call(console.error,console,D.name+":");n.error.apply(console,arguments)},performance:{log:function(H){var G,I,F;if(D.performance){G=new Date().getTime();F=f||G;I=G-F;f=G;j.push({Name:H[0],Arguments:[].slice.call(H,1)||"",Element:o,"Execution Time":I})}clearTimeout(n.performance.timer);n.performance.timer=setTimeout(n.performance.display,500)},display:function(){var G=D.name+":",F=0;f=false;clearTimeout(n.performance.timer);c.each(j,function(H,I){F+=I["Execution Time"]});G+=" "+F+"ms";if(h){G+=" '"+h+"'"}if(k.length>1){G+=" ("+k.length+")"}if((console.group!==d||console.table!==d)&&j.length>0){console.groupCollapsed(G);if(console.table){console.table(j)}else{c.each(j,function(H,I){console.log(I.Name+": "+I["Execution Time"]+"ms")})}console.groupEnd()}j=[]}},invoke:function(K,G,I){var H=E,L,J,F;G=G||l;I=o||I;if(typeof K=="string"&&H!==d){K=K.split(/[\. ]/);L=K.length-1;c.each(K,function(O,N){var M=(O!=L)?N+K[O+1].charAt(0).toUpperCase()+K[O+1].slice(1):K;if(c.isPlainObject(H[M])&&(O!=L)){H=H[M]}else{if(H[M]!==d){J=H[M];return false}else{if(c.isPlainObject(H[N])&&(O!=L)){H=H[N]}else{if(H[N]!==d){J=H[N];return false}else{return false}}}}})}if(c.isFunction(J)){F=J.apply(I,G)}else{if(J!==d){F=J}}if(c.isArray(g)){g.push(F)}else{if(g!==d){g=[g,F]}else{if(F!==d){g=F}}}return J}};if(e){if(E===d){n.initialize()}n.invoke(i)}else{if(E!==d){E.invoke("destroy")}n.initialize()}});return(g!==d)?g:this};c.fn.search.settings={name:"Search",namespace:"search",debug:false,verbose:false,performance:true,type:"standard",minCharacters:1,apiSettings:false,source:false,searchFields:["title","description"],searchFullText:true,automatic:true,hideDelay:0,searchDelay:200,maxResults:7,cache:true,transition:"scale",duration:200,easing:"easeOutExpo",onSelect:false,onResultsAdd:false,onSearchQuery:function(){},onResults:function(e){},onResultsOpen:function(){},onResultsClose:function(){},className:{active:"active",empty:"empty",focus:"focus",loading:"loading",results:"results",pressed:"down"},error:{source:"Cannot search. No source used, and Semantic API module was not included",noResults:"Your search returned no results",logging:"Error in debug logging, exiting.",noEndpoint:"No search endpoint was specified",noTemplate:"A valid template name was not specified.",serverError:"There was an issue querying the server.",maxResults:"Results must be an array to use maxResults setting",method:"The method you called is not defined."},metadata:{cache:"cache",results:"results",result:"result"},regExp:{escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,beginsWith:"(?:s|^)"},selector:{prompt:".prompt",searchButton:".search.button",results:".results",category:".category",result:".result",title:".title, .name"},templates:{escape:function(f){var h=/[&<>"'`]/g,i=/[&<>"'`]/,g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},e=function(j){return g[j]};if(i.test(f)){return f.replace(h,e)}return f},message:function(g,f){var e="";if(g!==d&&f!==d){e+='<div class="message '+f+'">';if(f=="empty"){e+='<div class="header">No Results</div class="header"><div class="description">'+g+'</div class="description">'}else{e+=' <div class="description">'+g+"</div>"}e+="</div>"}return e},category:function(e){var f="",g=c.fn.search.settings.templates.escape;if(e.results!==d){c.each(e.results,function(h,i){if(i.results!==d&&i.results.length>0){f+='<div class="category"><div class="name">'+i.name+"</div>";c.each(i.results,function(k,j){f+='<div class="result">';if(j.url){f+='<a href="'+j.url+'"></a>'}if(j.image!==d){j.image=g(j.image);f+='<div class="image"> <img src="'+j.image+'" alt=""></div>'}f+='<div class="content">';if(j.price!==d){j.price=g(j.price);f+='<div class="price">'+j.price+"</div>"}if(j.title!==d){j.title=g(j.title);f+='<div class="title">'+j.title+"</div>"}if(j.description!==d){f+='<div class="description">'+j.description+"</div>"}f+="</div></div>"});f+="</div>"}});if(e.action){f+='<a href="'+e.action.url+'" class="action">'+e.action.text+"</a>"}return f}return false},standard:function(e){var f="";if(e.results!==d){c.each(e.results,function(h,g){if(g.url){f+='<a class="result" href="'+g.url+'">'}else{f+='<a class="result">'}if(g.image!==d){f+='<div class="image"> <img src="'+g.image+'"></div>'}f+='<div class="content">';if(g.price!==d){f+='<div class="price">'+g.price+"</div>"}if(g.title!==d){f+='<div class="title">'+g.title+"</div>"}if(g.description!==d){f+='<div class="description">'+g.description+"</div>"}f+="</div>";f+="</a>"});if(e.action){f+='<a href="'+e.action.url+'" class="action">'+e.action.text+"</a>"}return f}return false}}}})(jQuery,window,document);