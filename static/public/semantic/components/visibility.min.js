/*!
 * # Semantic UI x.x - Visibility
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(c,b,a,d){c.fn.visibility=function(m){var k=c(this),h=k.selector||"",f=new Date().getTime(),j=[],i=arguments[0],e=(typeof i=="string"),l=[].slice.call(arguments,1),g;k.each(function(){var D=(c.isPlainObject(m))?c.extend(true,{},c.fn.visibility.settings,m):c.extend({},c.fn.visibility.settings),p=D.className,v=D.namespace,A=D.error,u=D.metadata,z="."+v,w="module-"+v,x=c(b),s=c(this),y=c(D.context),t,C=s.selector||"",E=s.data(w),q=b.requestAnimationFrame||b.mozRequestAnimationFrame||b.webkitRequestAnimationFrame||b.msRequestAnimationFrame||function(F){setTimeout(F,0)},o=this,r=false,B,n;n={initialize:function(){n.debug("Initializing",D);n.setup.cache();if(n.should.trackChanges()){if(D.type=="image"){n.setup.image()}if(D.type=="fixed"){n.setup.fixed()}if(D.observeChanges){n.observeChanges()}n.bind.events()}n.save.position();if(!n.is.visible()){n.error(A.visible,s)}if(D.initialCheck){n.checkVisibility()}n.instantiate()},instantiate:function(){n.debug("Storing instance",n);s.data(w,n);E=n},destroy:function(){n.verbose("Destroying previous module");if(B){B.disconnect()}x.off("load"+z,n.event.load).off("resize"+z,n.event.resize);y.off("scrollchange"+z,n.event.scrollchange);s.off(z).removeData(w)},observeChanges:function(){if("MutationObserver" in b){B=new MutationObserver(function(F){n.verbose("DOM tree modified, updating visibility calculations");n.timer=setTimeout(function(){n.verbose("DOM tree modified, updating sticky menu");n.refresh()},100)});B.observe(o,{childList:true,subtree:true});n.debug("Setting up mutation observer",B)}},bind:{events:function(){n.verbose("Binding visibility events to scroll and resize");if(D.refreshOnLoad){x.on("load"+z,n.event.load)}x.on("resize"+z,n.event.resize);y.off("scroll"+z).on("scroll"+z,n.event.scroll).on("scrollchange"+z,n.event.scrollchange)}},event:{resize:function(){n.debug("Window resized");if(D.refreshOnResize){q(n.refresh)}},load:function(){n.debug("Page finished loading");q(n.refresh)},scroll:function(){if(D.throttle){clearTimeout(n.timer);n.timer=setTimeout(function(){y.triggerHandler("scrollchange"+z,[y.scrollTop()])},D.throttle)}else{q(function(){y.triggerHandler("scrollchange"+z,[y.scrollTop()])})}},scrollchange:function(G,F){n.checkVisibility(F)}},precache:function(G,L){if(!(G instanceof Array)){G=[G]}var K=G.length,J=0,H=[],F=a.createElement("img"),I=function(){J++;if(J>=G.length){if(c.isFunction(L)){L()}}};while(K--){F=a.createElement("img");F.onload=I;F.onerror=I;F.src=G[K];H.push(F)}},enableCallbacks:function(){n.debug("Allowing callbacks to occur");r=false},disableCallbacks:function(){n.debug("Disabling all callbacks temporarily");r=true},should:{trackChanges:function(){if(e){n.debug("One time query, no need to bind events");return false}n.debug("Callbacks being attached");return true}},setup:{cache:function(){n.cache={occurred:{},screen:{},element:{}}},image:function(){var F=s.data(u.src);if(F){n.verbose("Lazy loading image",F);D.once=true;D.observeChanges=false;D.onOnScreen=function(){n.debug("Image on screen",o);n.precache(F,function(){n.set.image(F)})}}},fixed:function(){n.debug("Setting up fixed");D.once=false;D.observeChanges=false;D.initialCheck=true;D.refreshOnLoad=true;if(!m.transition){D.transition=false}n.create.placeholder();n.debug("Added placeholder",t);D.onTopPassed=function(){n.debug("Element passed, adding fixed position",s);n.show.placeholder();n.set.fixed();if(D.transition){if(c.fn.transition!==d){s.transition(D.transition,D.duration)}}};D.onTopPassedReverse=function(){n.debug("Element returned to position, removing fixed",s);n.hide.placeholder();n.remove.fixed()}}},create:{placeholder:function(){n.verbose("Creating fixed position placeholder");t=s.clone(false).css("display","none").addClass(p.placeholder).insertAfter(s)}},show:{placeholder:function(){n.verbose("Showing placeholder");t.css("display","block").css("visibility","hidden")}},hide:{placeholder:function(){n.verbose("Hiding placeholder");t.css("display","none").css("visibility","")}},set:{fixed:function(){n.verbose("Setting element to fixed position");s.addClass(p.fixed).css({position:"fixed",top:D.offset+"px",left:"auto",zIndex:"1"})},image:function(F){s.attr("src",F);if(D.transition){if(c.fn.transition!==d){s.transition(D.transition,D.duration)}else{s.fadeIn(D.duration)}}else{s.show()}}},is:{onScreen:function(){var F=n.get.elementCalculations();return F.onScreen},offScreen:function(){var F=n.get.elementCalculations();return F.offScreen},visible:function(){if(n.cache&&n.cache.element){return !(n.cache.element.width===0&&n.cache.element.offset.top===0)}return false}},refresh:function(){n.debug("Refreshing constants (width/height)");if(D.type=="fixed"){n.remove.fixed();n.remove.occurred()}n.reset();n.save.position();if(D.checkOnRefresh){n.checkVisibility()}D.onRefresh.call(o)},reset:function(){n.verbose("Reseting all cached values");if(c.isPlainObject(n.cache)){n.cache.screen={};n.cache.element={}}},checkVisibility:function(F){n.verbose("Checking visibility of element",n.cache.element);if(!r&&n.is.visible()){n.save.scroll(F);n.save.calculations();n.passed();n.passingReverse();n.topVisibleReverse();n.bottomVisibleReverse();n.topPassedReverse();n.bottomPassedReverse();n.onScreen();n.offScreen();n.passing();n.topVisible();n.bottomVisible();n.topPassed();n.bottomPassed();if(D.onUpdate){D.onUpdate.call(o,n.get.elementCalculations())}}},passed:function(H,I){var G=n.get.elementCalculations(),F;if(H&&I){D.onPassed[H]=I}else{if(H!==d){return(n.get.pixelsPassed(H)>G.pixelsPassed)}else{if(G.passing){c.each(D.onPassed,function(J,K){if(G.bottomVisible||G.pixelsPassed>n.get.pixelsPassed(J)){n.execute(K,J)}else{if(!D.once){n.remove.occurred(K)}}})}}}},onScreen:function(G){var F=n.get.elementCalculations(),I=G||D.onOnScreen,H="onScreen";if(G){n.debug("Adding callback for onScreen",G);D.onOnScreen=G}if(F.onScreen){n.execute(I,H)}else{if(!D.once){n.remove.occurred(H)}}if(G!==d){return F.onOnScreen}},offScreen:function(G){var F=n.get.elementCalculations(),I=G||D.onOffScreen,H="offScreen";if(G){n.debug("Adding callback for offScreen",G);D.onOffScreen=G}if(F.offScreen){n.execute(I,H)}else{if(!D.once){n.remove.occurred(H)}}if(G!==d){return F.onOffScreen}},passing:function(G){var F=n.get.elementCalculations(),I=G||D.onPassing,H="passing";if(G){n.debug("Adding callback for passing",G);D.onPassing=G}if(F.passing){n.execute(I,H)}else{if(!D.once){n.remove.occurred(H)}}if(G!==d){return F.passing}},topVisible:function(G){var F=n.get.elementCalculations(),I=G||D.onTopVisible,H="topVisible";if(G){n.debug("Adding callback for top visible",G);D.onTopVisible=G}if(F.topVisible){n.execute(I,H)}else{if(!D.once){n.remove.occurred(H)}}if(G===d){return F.topVisible}},bottomVisible:function(G){var F=n.get.elementCalculations(),I=G||D.onBottomVisible,H="bottomVisible";if(G){n.debug("Adding callback for bottom visible",G);D.onBottomVisible=G}if(F.bottomVisible){n.execute(I,H)}else{if(!D.once){n.remove.occurred(H)}}if(G===d){return F.bottomVisible}},topPassed:function(G){var F=n.get.elementCalculations(),I=G||D.onTopPassed,H="topPassed";if(G){n.debug("Adding callback for top passed",G);D.onTopPassed=G}if(F.topPassed){n.execute(I,H)}else{if(!D.once){n.remove.occurred(H)}}if(G===d){return F.topPassed}},bottomPassed:function(G){var F=n.get.elementCalculations(),I=G||D.onBottomPassed,H="bottomPassed";if(G){n.debug("Adding callback for bottom passed",G);D.onBottomPassed=G}if(F.bottomPassed){n.execute(I,H)}else{if(!D.once){n.remove.occurred(H)}}if(G===d){return F.bottomPassed}},passingReverse:function(G){var F=n.get.elementCalculations(),I=G||D.onPassingReverse,H="passingReverse";if(G){n.debug("Adding callback for passing reverse",G);D.onPassingReverse=G}if(!F.passing){if(n.get.occurred("passing")){n.execute(I,H)}}else{if(!D.once){n.remove.occurred(H)}}if(G!==d){return !F.passing}},topVisibleReverse:function(G){var F=n.get.elementCalculations(),I=G||D.onTopVisibleReverse,H="topVisibleReverse";if(G){n.debug("Adding callback for top visible reverse",G);D.onTopVisibleReverse=G}if(!F.topVisible){if(n.get.occurred("topVisible")){n.execute(I,H)}}else{if(!D.once){n.remove.occurred(H)}}if(G===d){return !F.topVisible}},bottomVisibleReverse:function(G){var F=n.get.elementCalculations(),I=G||D.onBottomVisibleReverse,H="bottomVisibleReverse";if(G){n.debug("Adding callback for bottom visible reverse",G);D.onBottomVisibleReverse=G}if(!F.bottomVisible){if(n.get.occurred("bottomVisible")){n.execute(I,H)}}else{if(!D.once){n.remove.occurred(H)}}if(G===d){return !F.bottomVisible}},topPassedReverse:function(G){var F=n.get.elementCalculations(),I=G||D.onTopPassedReverse,H="topPassedReverse";if(G){n.debug("Adding callback for top passed reverse",G);D.onTopPassedReverse=G}if(!F.topPassed){if(n.get.occurred("topPassed")){n.execute(I,H)}}else{if(!D.once){n.remove.occurred(H)}}if(G===d){return !F.onTopPassed}},bottomPassedReverse:function(G){var F=n.get.elementCalculations(),I=G||D.onBottomPassedReverse,H="bottomPassedReverse";if(G){n.debug("Adding callback for bottom passed reverse",G);D.onBottomPassedReverse=G}if(!F.bottomPassed){if(n.get.occurred("bottomPassed")){n.execute(I,H)}}else{if(!D.once){n.remove.occurred(H)}}if(G===d){return !F.bottomPassed}},execute:function(I,H){var F=n.get.elementCalculations(),G=n.get.screenCalculations();I=I||false;if(I){if(D.continuous){n.debug("Callback being called continuously",H,F);I.call(o,F,G)}else{if(!n.get.occurred(H)){n.debug("Conditions met",H,F);I.call(o,F,G)}}}n.save.occurred(H)},remove:{fixed:function(){n.debug("Removing fixed position");s.removeClass(p.fixed).css({position:"",top:"",left:"",zIndex:""})},occurred:function(G){if(G){var F=n.cache.occurred;if(F[G]!==d&&F[G]===true){n.debug("Callback can now be called again",G);n.cache.occurred[G]=false}}else{n.cache.occurred={}}}},save:{calculations:function(){n.verbose("Saving all calculations necessary to determine positioning");n.save.direction();n.save.screenCalculations();n.save.elementCalculations()},occurred:function(F){if(F){if(n.cache.occurred[F]===d||(n.cache.occurred[F]!==true)){n.verbose("Saving callback occurred",F);n.cache.occurred[F]=true}}},scroll:function(F){F=F+D.offset||y.scrollTop()+D.offset;n.cache.scroll=F},direction:function(){var F=n.get.scroll(),G=n.get.lastScroll(),H;if(F>G&&G){H="down"}else{if(F<G&&G){H="up"}else{H="static"}}n.cache.direction=H;return n.cache.direction},elementPosition:function(){var G=n.cache.element,F=n.get.screenSize();n.verbose("Saving element position");G.fits=(G.height<F.height);G.offset=s.offset();G.width=s.outerWidth();G.height=s.outerHeight();n.cache.element=G;return G},elementCalculations:function(){var F=n.get.screenCalculations(),G=n.get.elementPosition();if(D.includeMargin){G.margin={};G.margin.top=parseInt(s.css("margin-top"),10);G.margin.bottom=parseInt(s.css("margin-bottom"),10);G.top=G.offset.top-G.margin.top;G.bottom=G.offset.top+G.height+G.margin.bottom}else{G.top=G.offset.top;G.bottom=G.offset.top+G.height}G.topVisible=(F.bottom>=G.top);G.topPassed=(F.top>=G.top);G.bottomVisible=(F.bottom>=G.bottom);G.bottomPassed=(F.top>=G.bottom);G.pixelsPassed=0;G.percentagePassed=0;G.onScreen=(G.topVisible&&!G.bottomPassed);G.passing=(G.topPassed&&!G.bottomPassed);G.offScreen=(!G.onScreen);if(G.passing){G.pixelsPassed=(F.top-G.top);G.percentagePassed=(F.top-G.top)/G.height}n.cache.element=G;n.verbose("Updated element calculations",G);return G},screenCalculations:function(){var F=n.get.scroll();n.save.direction();n.cache.screen.top=F;n.cache.screen.bottom=F+n.cache.screen.height;return n.cache.screen},screenSize:function(){n.verbose("Saving window position");n.cache.screen={height:y.height()}},position:function(){n.save.screenSize();n.save.elementPosition()}},get:{pixelsPassed:function(G){var F=n.get.elementCalculations();if(G.search("%")>-1){return(F.height*(parseInt(G,10)/100))}return parseInt(G,10)},occurred:function(F){return(n.cache.occurred!==d)?n.cache.occurred[F]||false:false},direction:function(){if(n.cache.direction===d){n.save.direction()}return n.cache.direction},elementPosition:function(){if(n.cache.element===d){n.save.elementPosition()}return n.cache.element},elementCalculations:function(){if(n.cache.element===d){n.save.elementCalculations()}return n.cache.element},screenCalculations:function(){if(n.cache.screen===d){n.save.screenCalculations()}return n.cache.screen},screenSize:function(){if(n.cache.screen===d){n.save.screenSize()}return n.cache.screen},scroll:function(){if(n.cache.scroll===d){n.save.scroll()}return n.cache.scroll},lastScroll:function(){if(n.cache.screen===d){n.debug("First scroll event, no last scroll could be found");return false}return n.cache.screen.top}},setting:function(F,G){if(c.isPlainObject(F)){c.extend(true,D,F)}else{if(G!==d){D[F]=G}else{return D[F]}}},internal:function(F,G){if(c.isPlainObject(F)){c.extend(true,n,F)}else{if(G!==d){n[F]=G}else{return n[F]}}},debug:function(){if(D.debug){if(D.performance){n.performance.log(arguments)}else{n.debug=Function.prototype.bind.call(console.info,console,D.name+":");n.debug.apply(console,arguments)}}},verbose:function(){if(D.verbose&&D.debug){if(D.performance){n.performance.log(arguments)}else{n.verbose=Function.prototype.bind.call(console.info,console,D.name+":");n.verbose.apply(console,arguments)}}},error:function(){n.error=Function.prototype.bind.call(console.error,console,D.name+":");n.error.apply(console,arguments)},performance:{log:function(H){var G,I,F;if(D.performance){G=new Date().getTime();F=f||G;I=G-F;f=G;j.push({Name:H[0],Arguments:[].slice.call(H,1)||"",Element:o,"Execution Time":I})}clearTimeout(n.performance.timer);n.performance.timer=setTimeout(n.performance.display,500)},display:function(){var G=D.name+":",F=0;f=false;clearTimeout(n.performance.timer);c.each(j,function(H,I){F+=I["Execution Time"]});G+=" "+F+"ms";if(h){G+=" '"+h+"'"}if((console.group!==d||console.table!==d)&&j.length>0){console.groupCollapsed(G);if(console.table){console.table(j)}else{c.each(j,function(H,I){console.log(I.Name+": "+I["Execution Time"]+"ms")})}console.groupEnd()}j=[]}},invoke:function(K,G,I){var H=E,L,J,F;G=G||l;I=o||I;if(typeof K=="string"&&H!==d){K=K.split(/[\. ]/);L=K.length-1;c.each(K,function(O,N){var M=(O!=L)?N+K[O+1].charAt(0).toUpperCase()+K[O+1].slice(1):K;if(c.isPlainObject(H[M])&&(O!=L)){H=H[M]}else{if(H[M]!==d){J=H[M];return false}else{if(c.isPlainObject(H[N])&&(O!=L)){H=H[N]}else{if(H[N]!==d){J=H[N];return false}else{n.error(A.method,K);return false}}}}})}if(c.isFunction(J)){F=J.apply(I,G)}else{if(J!==d){F=J}}if(c.isArray(g)){g.push(F)}else{if(g!==d){g=[g,F]}else{if(F!==d){g=F}}}return J}};if(e){if(E===d){n.initialize()}E.save.scroll();E.save.calculations();n.invoke(i)}else{if(E!==d){E.invoke("destroy")}n.initialize()}});return(g!==d)?g:this};c.fn.visibility.settings={name:"Visibility",namespace:"visibility",debug:false,verbose:false,performance:true,observeChanges:true,refreshOnLoad:true,once:true,continuous:false,offset:0,includeMargin:false,context:b,initialCheck:true,throttle:false,type:false,transition:"fade in",duration:1000,onPassed:{},checkOnRefresh:true,onOnScreen:false,onOffScreen:false,onPassing:false,onTopVisible:false,onBottomVisible:false,onTopPassed:false,onBottomPassed:false,onPassingReverse:false,onTopVisibleReverse:false,onBottomVisibleReverse:false,onTopPassedReverse:false,onBottomPassedReverse:false,onUpdate:false,onRefresh:function(){},metadata:{src:"src"},className:{fixed:"fixed",placeholder:"placeholder"},error:{method:"The method you called is not defined.",visible:"Element is hidden, you must call refresh after element becomes visible"}}})(jQuery,window,document);