/*!
 * # Semantic UI x.x - Form Validation
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(c,b,a,d){c.fn.form=function(n){var l=c(this),i=l.selector||"",f=new Date().getTime(),k=[],j=arguments[0],h=arguments[1],e=(typeof j=="string"),m=[].slice.call(arguments,1),g;l.each(function(){var t=c(this),p=this,H=[],r=false,B,J,I,D,A,s,x,F,u,w,E,q,C,v,y,z,G,o;o={initialize:function(){o.get.settings();if(e){if(G===d){o.instantiate()}o.invoke(j)}else{o.verbose("Initializing form validation",t,F);o.bindEvents();o.set.defaults();o.instantiate()}},instantiate:function(){o.verbose("Storing instance of module",o);G=o;t.data(y,o)},destroy:function(){o.verbose("Destroying previous module",G);o.removeEvents();t.removeData(y)},refresh:function(){o.verbose("Refreshing selector cache");B=t.find(E.field);J=t.find(E.group);I=t.find(E.message);D=t.find(E.prompt);A=t.find(E.submit);s=t.find(E.clear);x=t.find(E.reset)},submit:function(){o.verbose("Submitting form",t);t.submit()},attachEvents:function(K,L){L=L||"submit";c(K).on("click"+z,function(M){o[L]();M.preventDefault()})},bindEvents:function(){o.verbose("Attaching form events");t.on("submit"+z,o.validate.form).on("blur"+z,E.field,o.event.field.blur).on("click"+z,E.submit,o.submit).on("click"+z,E.reset,o.reset).on("click"+z,E.clear,o.clear);if(F.keyboardShortcuts){t.on("keydown"+z,E.field,o.event.field.keydown)}B.each(function(){var M=c(this),K=M.prop("type"),L=o.get.changeEvent(K,M);c(this).on(L+z,o.event.field.change)})},clear:function(){B.each(function(){var O=c(this),L=O.parent(),P=O.closest(J),M=P.find(E.prompt),K=O.data(w.defaultValue)||"",N=L.is(E.uiCheckbox),Q=L.is(E.uiDropdown),R=P.hasClass(q.error);if(R){o.verbose("Resetting error on field",P);P.removeClass(q.error);M.remove()}if(Q){o.verbose("Resetting dropdown value",L,K);L.dropdown("clear")}else{if(N){O.prop("checked",false)}else{o.verbose("Resetting field value",O,K);O.val("")}}})},reset:function(){B.each(function(){var O=c(this),L=O.parent(),P=O.closest(J),M=P.find(E.prompt),K=O.data(w.defaultValue),N=L.is(E.uiCheckbox),Q=L.is(E.uiDropdown),R=P.hasClass(q.error);if(K===d){return}if(R){o.verbose("Resetting error on field",P);P.removeClass(q.error);M.remove()}if(Q){o.verbose("Resetting dropdown value",L,K);L.dropdown("restore defaults")}else{if(N){o.verbose("Resetting checkbox value",L,K);O.prop("checked",K)}else{o.verbose("Resetting field value",O,K);O.val(K)}}})},is:{valid:function(){var K=true;o.verbose("Checking if form is valid");c.each(u,function(M,L){if(!(o.validate.field(L))){K=false}});return K}},removeEvents:function(){t.off(z);B.off(z);A.off(z);B.off(z)},event:{field:{keydown:function(M){var L=c(this),K=M.which,N={enter:13,escape:27};if(K==N.escape){o.verbose("Escape key pressed blurring field");L.blur()}if(!M.ctrlKey&&K==N.enter&&L.is(E.input)&&L.not(E.checkbox).length>0){if(!r){L.one("keyup"+z,o.event.field.keyup);o.submit();o.debug("Enter pressed on input submitting form")}r=true}},keyup:function(){r=false},blur:function(){var L=c(this),M=L.closest(J),K=o.get.validation(L);if(M.hasClass(q.error)){o.debug("Revalidating field",L,K);o.validate.field(K)}else{if(F.on=="blur"||F.on=="change"){o.validate.field(K)}}},change:function(){var K=c(this),L=K.closest(J);if(F.on=="change"||(L.hasClass(q.error)&&F.revalidate)){clearTimeout(o.timer);o.timer=setTimeout(function(){o.debug("Revalidating field",K,o.get.validation(K));o.validate.field(o.get.validation(K))},F.delay)}}}},get:{changeEvent:function(K,L){if(K=="checkbox"||K=="radio"||K=="hidden"||L.is("select")){return"change"}else{return o.get.inputEvent()}},inputEvent:function(){return(a.createElement("input").oninput!==d)?"input":(a.createElement("input").onpropertychange!==d)?"propertychange":"keyup"},settings:function(){var L;if(c.isPlainObject(n)){var M=Object.keys(n),K=(M.length>0)?(n[M[0]].identifier!==d):false;if(K){F=c.extend(true,{},c.fn.form.settings,h);u=c.extend({},c.fn.form.settings.defaults,n);o.error(F.error.oldSyntax,p);o.verbose("Extending settings from legacy parameters",u,F)}else{F=c.extend(true,{},c.fn.form.settings,n);u=c.extend({},c.fn.form.settings.defaults,F.fields);o.verbose("Extending settings",u,F)}}else{F=c.fn.form.settings;u=c.fn.form.settings.defaults;o.verbose("Using default form validation",u,F)}v=F.namespace;w=F.metadata;E=F.selector;q=F.className;C=F.error;y="module-"+v;z="."+v;G=t.data(y);o.refresh()},field:function(K){o.verbose("Finding field with identifier",K);if(B.filter("#"+K).length>0){return B.filter("#"+K)}else{if(B.filter('[name="'+K+'"]').length>0){return B.filter('[name="'+K+'"]')}else{if(B.filter('[name="'+K+'[]"]').length>0){return B.filter('[name="'+K+'[]"]')}else{if(B.filter("[data-"+w.validate+'="'+K+'"]').length>0){return B.filter("[data-"+w.validate+'="'+K+'"]')}}}}return c("<input/>")},fields:function(K){var L=c();c.each(K,function(N,M){L=L.add(o.get.field(M))});return L},validation:function(K){var L;if(!u){return false}c.each(u,function(N,M){if(o.get.field(M.identifier)[0]==K[0]){L=M}});return L||false},value:function(M){var K=[],L;K.push(M);L=o.get.values.call(p,K);return L[M]},values:function(K){var M=c.isArray(K)?o.get.fields(K):B,L={};M.each(function(S,V){var U=c(V),T=U.prop("type"),O=U.prop("name"),W=U.val(),P=U.is(E.checkbox),N=U.is(E.radio),R=(O.indexOf("[]")!==-1),Q=(P)?U.is(":checked"):false;if(O){if(R){O=O.replace("[]","");if(!L[O]){L[O]=[]}if(P){if(Q){L[O].push(W)}else{o.debug("Omitted unchecked checkbox",U);return true}}else{L[O].push(W)}}else{if(N){if(Q){L[O]=W}}else{if(P){if(Q){L[O]=true}else{o.debug("Omitted unchecked checkbox",U);return true}}else{L[O]=W}}}}});return L}},has:{field:function(K){o.verbose("Checking for existence of a field with identifier",K);if(B.filter("#"+K).length>0){return true}else{if(B.filter('[name="'+K+'"]').length>0){return true}else{if(B.filter("[data-"+w.validate+'="'+K+'"]').length>0){return true}}}return false}},add:{prompt:function(M,P){var N=o.get.field(M),O=N.closest(J),L=O.children(E.prompt),K=(L.length!==0);P=(typeof P=="string")?[P]:P;o.verbose("Adding field error state",M);O.addClass(q.error);if(F.inline){if(!K){L=F.templates.prompt(P);L.appendTo(O)}L.html(P[0]);if(!K){if(F.transition&&c.fn.transition!==d&&t.transition("is supported")){o.verbose("Displaying error with css transition",F.transition);L.transition(F.transition+" in",F.duration)}else{o.verbose("Displaying error with fallback javascript animation");L.fadeIn(F.duration)}}else{o.verbose("Inline errors are disabled, no inline error added",M)}}},errors:function(K){o.debug("Adding form error messages",K);I.html(F.templates.error(K))}},remove:{prompt:function(N){var L=o.get.field(N.identifier),M=L.closest(J),K=M.children(E.prompt);M.removeClass(q.error);if(F.inline&&K.is(":visible")){o.verbose("Removing prompt for field",N);if(F.transition&&c.fn.transition!==d&&t.transition("is supported")){K.transition(F.transition+" out",F.duration,function(){K.remove()})}else{K.fadeOut(F.duration,function(){K.remove()})}}}},set:{success:function(){t.removeClass(q.error).addClass(q.success)},defaults:function(){B.each(function(){var L=c(this),K=(L.filter(E.checkbox).length>0),M=(K)?L.is(":checked"):L.val();L.data(w.defaultValue,M)})},error:function(){t.removeClass(q.success).addClass(q.error)},value:function(M,L){var K={};K[M]=L;return o.set.values.call(p,K)},values:function(K){if(c.isEmptyObject(K)){return}c.each(K,function(T,S){var Q=o.get.field(T),U=Q.parent(),N=c.isArray(S),M=U.is(E.uiCheckbox),P=U.is(E.uiDropdown),L=(Q.is(E.radio)&&M),R=(Q.length>0),O;if(R){if(N&&M){o.verbose("Selecting multiple",S,Q);U.checkbox("uncheck");c.each(S,function(V,W){O=Q.filter('[value="'+W+'"]');U=O.parent();if(O.length>0){U.checkbox("check")}})}else{if(L){o.verbose("Selecting radio value",S,Q);Q.filter('[value="'+S+'"]').parent(E.uiCheckbox).checkbox("check")}else{if(M){o.verbose("Setting checkbox value",S,U);if(S===true){U.checkbox("check")}else{U.checkbox("uncheck")}}else{if(P){o.verbose("Setting dropdown value",S,U);U.dropdown("set selected",S)}else{o.verbose("Setting field value",S,Q);Q.val(S)}}}}}})}},validate:{form:function(L){var K;if(r){return false}H=[];if(o.is.valid()){o.debug("Form has no validation errors, submitting");o.set.success();return F.onSuccess.call(p,L)}else{o.debug("Form has errors");o.set.error();if(!F.inline){o.add.errors(H)}if(t.data("moduleApi")!==d){L.stopImmediatePropagation()}return F.onFailure.call(p,H)}},field:function(N){var L=o.get.field(N.identifier),M=true,K=[];if(L.prop("disabled")){o.debug("Field is disabled. Skipping",N.identifier);M=true}else{if(N.optional&&c.trim(L.val())===""){o.debug("Field is optional and empty. Skipping",N.identifier);M=true}else{if(N.rules!==d){c.each(N.rules,function(O,P){if(o.has.field(N.identifier)&&!(o.validate.rule(N,P))){o.debug("Field is invalid",N.identifier,P.type);K.push(P.prompt);M=false}})}}}if(M){o.remove.prompt(N,K);F.onValid.call(L)}else{H=H.concat(K);o.add.prompt(N.identifier,K);F.onInvalid.call(L,K);return false}return true},rule:function(R,M){var Q=o.get.field(R.identifier),O=M.type,S=Q.val(),K=O.match(F.regExp.bracket),T=true,P,N,L;S=c.trim(Q.val()+"");if(K){N=""+K[1];L=O.replace(K[0],"");P=F.rules[L];if(!c.isFunction(P)){o.error(C.noRule,L);return}T=P.call(Q,S,N)}else{P=F.rules[O];if(!c.isFunction(P)){o.error(C.noRule,O);return}T=P.call(Q,S)}return T}},setting:function(K,L){if(c.isPlainObject(K)){c.extend(true,F,K)}else{if(L!==d){F[K]=L}else{return F[K]}}},internal:function(K,L){if(c.isPlainObject(K)){c.extend(true,o,K)}else{if(L!==d){o[K]=L}else{return o[K]}}},debug:function(){if(F.debug){if(F.performance){o.performance.log(arguments)}else{o.debug=Function.prototype.bind.call(console.info,console,F.name+":");o.debug.apply(console,arguments)}}},verbose:function(){if(F.verbose&&F.debug){if(F.performance){o.performance.log(arguments)}else{o.verbose=Function.prototype.bind.call(console.info,console,F.name+":");o.verbose.apply(console,arguments)}}},error:function(){o.error=Function.prototype.bind.call(console.error,console,F.name+":");o.error.apply(console,arguments)},performance:{log:function(M){var L,N,K;if(F.performance){L=new Date().getTime();K=f||L;N=L-K;f=L;k.push({Name:M[0],Arguments:[].slice.call(M,1)||"",Element:p,"Execution Time":N})}clearTimeout(o.performance.timer);o.performance.timer=setTimeout(o.performance.display,500)},display:function(){var L=F.name+":",K=0;f=false;clearTimeout(o.performance.timer);c.each(k,function(M,N){K+=N["Execution Time"]});L+=" "+K+"ms";if(i){L+=" '"+i+"'"}if(l.length>1){L+=" ("+l.length+")"}if((console.group!==d||console.table!==d)&&k.length>0){console.groupCollapsed(L);if(console.table){console.table(k)}else{c.each(k,function(M,N){console.log(N.Name+": "+N["Execution Time"]+"ms")})}console.groupEnd()}k=[]}},invoke:function(P,L,N){var M=G,Q,O,K;L=L||m;N=p||N;if(typeof P=="string"&&M!==d){P=P.split(/[\. ]/);Q=P.length-1;c.each(P,function(T,S){var R=(T!=Q)?S+P[T+1].charAt(0).toUpperCase()+P[T+1].slice(1):P;if(c.isPlainObject(M[R])&&(T!=Q)){M=M[R]}else{if(M[R]!==d){O=M[R];return false}else{if(c.isPlainObject(M[S])&&(T!=Q)){M=M[S]}else{if(M[S]!==d){O=M[S];return false}else{return false}}}}})}if(c.isFunction(O)){K=O.apply(N,L)}else{if(O!==d){K=O}}if(c.isArray(g)){g.push(K)}else{if(g!==d){g=[g,K]}else{if(K!==d){g=K}}}return O}};o.initialize()});return(g!==d)?g:this};c.fn.form.settings={name:"Form",namespace:"form",debug:false,verbose:false,performance:true,fields:false,keyboardShortcuts:true,on:"submit",inline:false,delay:200,revalidate:true,transition:"scale",duration:200,onValid:function(){},onInvalid:function(){},onSuccess:function(){return true},onFailure:function(){return false},metadata:{defaultValue:"default",validate:"validate"},regExp:{bracket:/\[(.*)\]/i,escape:/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,email:"[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?",integer:/^\-?\d+$/,flags:/^\/(.*)\/(.*)?/,url:/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/i},selector:{checkbox:'input[type="checkbox"], input[type="radio"]',clear:".clear",field:"input, textarea, select",group:".field",input:"input",message:".error.message",prompt:".prompt.label",radio:'input[type="radio"]',reset:'.reset:not([type="reset"])',submit:'.submit:not([type="submit"])',uiCheckbox:".ui.checkbox",uiDropdown:".ui.dropdown"},className:{error:"error",label:"ui prompt label",pressed:"down",success:"success"},error:{oldSyntax:"Starting in 2.0 forms now only take a single settings object. Validation settings converted to new syntax automatically.",noRule:"There is no rule matching the one you specified",method:"The method you called is not defined."},templates:{error:function(f){var e='<ul class="list">';c.each(f,function(g,h){e+="<li>"+h+"</li>"});e+="</ul>";return c(e)},prompt:function(e){return c("<div/>").addClass("ui red pointing prompt label").html(e[0])}},rules:{checked:function(){return(c(this).filter(":checked").length>0)},contains:function(e,f){f=f.replace(c.fn.form.settings.regExp.escape,"\\$&");return(e.search(new RegExp(f,"i"))!==-1)},containsExactly:function(e,f){f=f.replace(c.fn.form.settings.regExp.escape,"\\$&");return(e.search(new RegExp(f))!==-1)},email:function(e){var f=new RegExp(c.fn.form.settings.regExp.email,"i");return f.test(e)},empty:function(e){return !(e===d||""===e||c.isArray(e)&&e.length===0)},integer:function(i,f){var h=c.fn.form.settings.regExp.integer,g,e,j;if(f===d||f===""||f===".."){}else{if(f.indexOf("..")==-1){if(h.test(f)){g=e=f-0}}else{j=f.split("..",2);if(h.test(j[0])){g=j[0]-0}if(h.test(j[1])){e=j[1]-0}}}return(h.test(i)&&(g===d||i>=g)&&(e===d||i<=e))},is:function(e,f){f=(typeof f=="string")?f.toLowerCase():f;e=(typeof e=="string")?e.toLowerCase():e;return(e==f)},isExactly:function(e,f){return(e==f)},length:function(f,e){return(f!==d)?(f.length>=e):false},different:function(h,f){var e=c(this),g;if(c('[data-validate="'+f+'"]').length>0){g=c('[data-validate="'+f+'"]').val()}else{if(c("#"+f).length>0){g=c("#"+f).val()}else{if(c('[name="'+f+'"]').length>0){g=c('[name="'+f+'"]').val()}else{if(c('[name="'+f+'[]"]').length>0){g=c('[name="'+f+'[]"]')}}}}return(g!==d)?(h.toString()!==g.toString()):false},match:function(h,f){var e=c(this),g;if(c('[data-validate="'+f+'"]').length>0){g=c('[data-validate="'+f+'"]').val()}else{if(c("#"+f).length>0){g=c("#"+f).val()}else{if(c('[name="'+f+'"]').length>0){g=c('[name="'+f+'"]').val()}else{if(c('[name="'+f+'[]"]').length>0){g=c('[name="'+f+'[]"]')}}}}return(g!==d)?(h.toString()==g.toString()):false},maxCount:function(f,e){f=f.split(",");return(c.isArray(f)&&f.length<=e)},exactCount:function(f,e){f=f.split(",");return(c.isArray(f)&&f.length==e)},minCount:function(f,e){f=f.split(",");return(c.isArray(f)&&f.length>=e)},regExp:function(h,g){var f=g.match(c.fn.form.settings.regExp.flags),e;if(f){g=(f.length>=2)?f[1]:g;e=(f.length>=3)?f[2]:""}return h.match(new RegExp(g,e))},maxLength:function(f,e){return(f!==d)?(f.length<=e):false},not:function(f,e){f=(typeof f=="string")?f.toLowerCase():f;e=(typeof e=="string")?e.toLowerCase():e;return(f!=e)},notExactly:function(f,e){return(f!=e)},url:function(e){return c.fn.form.settings.regExp.url.match(e)}}}})(jQuery,window,document);