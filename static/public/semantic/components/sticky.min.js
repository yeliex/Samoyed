/*!
 * # Semantic UI x.x - Sticky
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Copyright 2015 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
;(function(c,b,a,d){c.fn.sticky=function(m){var k=c(this),h=k.selector||"",f=new Date().getTime(),j=[],i=arguments[0],e=(typeof i=="string"),l=[].slice.call(arguments,1),g;k.each(function(){var q=(c.isPlainObject(m))?c.extend(true,{},c.fn.sticky.settings,m):c.extend({},c.fn.sticky.settings),y=q.className,r=q.namespace,z=q.error,D="."+r,u="module-"+r,A=c(this),o=c(b),s=c(q.scrollContext),C,v,p=A.selector||"",B=A.data(u),x=b.requestAnimationFrame||b.mozRequestAnimationFrame||b.webkitRequestAnimationFrame||b.msRequestAnimationFrame||function(E){setTimeout(E,0)},t=this,w,n;n={initialize:function(){n.determineContainer();n.determineContext();n.verbose("Initializing sticky",q,C);n.save.positions();n.checkErrors();n.bind.events();if(q.observeChanges){n.observeChanges()}n.instantiate()},instantiate:function(){n.verbose("Storing instance of module",n);B=n;A.data(u,n)},destroy:function(){n.verbose("Destroying previous instance");n.reset();if(w){w.disconnect()}o.off("load"+D,n.event.load).off("resize"+D,n.event.resize);s.off("scrollchange"+D,n.event.scrollchange);A.removeData(u)},observeChanges:function(){var E=v[0];if("MutationObserver" in b){w=new MutationObserver(function(F){clearTimeout(n.timer);n.timer=setTimeout(function(){n.verbose("DOM tree modified, updating sticky menu",F);n.refresh()},100)});w.observe(t,{childList:true,subtree:true});w.observe(E,{childList:true,subtree:true});n.debug("Setting up mutation observer",w)}},determineContainer:function(){C=A.offsetParent()},determineContext:function(){if(q.context){v=c(q.context)}else{v=C}if(v.length===0){n.error(z.invalidContext,q.context,A);return}},checkErrors:function(){if(n.is.hidden()){n.error(z.visible,A)}if(n.cache.element.height>n.cache.context.height){n.reset();n.error(z.elementSize,A);return}},bind:{events:function(){o.on("load"+D,n.event.load).on("resize"+D,n.event.resize);s.off("scroll"+D).on("scroll"+D,n.event.scroll).on("scrollchange"+D,n.event.scrollchange)}},event:{load:function(){n.verbose("Page contents finished loading");x(n.refresh)},resize:function(){n.verbose("Window resized");x(n.refresh)},scroll:function(){x(function(){s.triggerHandler("scrollchange"+D,s.scrollTop())})},scrollchange:function(F,E){n.stick(E);q.onScroll.call(t)}},refresh:function(E){n.reset();if(!q.context){n.determineContext()}if(E){n.determineContainer()}n.save.positions();n.stick();q.onReposition.call(t)},supports:{sticky:function(){var E=c("<div/>"),F=E[0];E.addClass(y.supported);return(E.css("position").match("sticky"))}},save:{lastScroll:function(E){n.lastScroll=E},elementScroll:function(E){n.elementScroll=E},positions:function(){var H={height:o.height()},G={margin:{top:parseInt(A.css("margin-top"),10),bottom:parseInt(A.css("margin-bottom"),10)},offset:A.offset(),width:A.outerWidth(),height:A.outerHeight()},F={offset:v.offset(),height:v.outerHeight(),bottomPadding:parseInt(v.css("padding-bottom"),10)},E={height:C.outerHeight()};n.cache={fits:(G.height<H.height),window:{height:H.height},element:{margin:G.margin,top:G.offset.top-G.margin.top,left:G.offset.left,width:G.width,height:G.height,bottom:G.offset.top+G.height},context:{top:F.offset.top,height:F.height,bottomPadding:F.bottomPadding,bottom:F.offset.top+F.height-F.bottomPadding}};n.set.containerSize();n.set.size();n.stick();n.debug("Caching element positions",n.cache)}},get:{direction:function(E){var F="down";E=E||s.scrollTop();if(n.lastScroll!==d){if(n.lastScroll<E){F="down"}else{if(n.lastScroll>E){F="up"}}}return F},scrollChange:function(E){E=E||s.scrollTop();return(n.lastScroll)?(E-n.lastScroll):0},currentElementScroll:function(){if(n.elementScroll){return n.elementScroll}return(n.is.top())?Math.abs(parseInt(A.css("top"),10))||0:Math.abs(parseInt(A.css("bottom"),10))||0},elementScroll:function(E){E=E||s.scrollTop();var F=n.cache.element,I=n.cache.window,K=n.get.scrollChange(E),H=(F.height-I.height+q.offset),G=n.get.currentElementScroll(),J=(G+K);if(n.cache.fits||J<0){G=0}else{if(J>H){G=H}else{G=J}}return G}},remove:{lastScroll:function(){delete n.lastScroll},elementScroll:function(E){delete n.elementScroll},offset:function(){A.css("margin-top","")}},set:{offset:function(){n.verbose("Setting offset on element",q.offset);A.css("margin-top",q.offset)},containerSize:function(){var E=C.get(0).tagName;if(E==="HTML"||E=="body"){n.determineContainer()}else{if(Math.abs(C.outerHeight()-n.cache.context.height)>q.jitter){n.debug("Context has padding, specifying exact height for container",n.cache.context.height);C.css({height:n.cache.context.height})}}},minimumSize:function(){var E=n.cache.element;C.css("min-height",E.height)},scroll:function(E){n.debug("Setting scroll on element",E);if(n.elementScroll==E){return}if(n.is.top()){A.css("bottom","").css("top",-E)}if(n.is.bottom()){A.css("top","").css("bottom",E)}},size:function(){if(n.cache.element.height!==0&&n.cache.element.width!==0){A.css({width:n.cache.element.width,height:n.cache.element.height})}}},is:{top:function(){return A.hasClass(y.top)},bottom:function(){return A.hasClass(y.bottom)},initialPosition:function(){return(!n.is.fixed()&&!n.is.bound())},hidden:function(){return(!A.is(":visible"))},bound:function(){return A.hasClass(y.bound)},fixed:function(){return A.hasClass(y.fixed)}},stick:function(O){var M=O||s.scrollTop(),E=n.cache,P=E.fits,I=E.element,L=E.window,F=E.context,H=(n.is.bottom()&&q.pushing)?q.bottomOffset:q.offset,O={top:M+H,bottom:M+H+L.height},N=n.get.direction(O.top),J=(P)?0:n.get.elementScroll(O.top),G=!P,K=(I.height!==0);if(K){if(n.is.initialPosition()){if(O.top>F.bottom){n.debug("Element bottom of container");n.bindBottom()}else{if(O.top>I.top){n.debug("Element passed, fixing element to page");n.fixTop()}}}else{if(n.is.fixed()){if(n.is.top()){if(O.top<I.top){n.debug("Fixed element reached top of container");n.setInitialPosition()}else{if((I.height+O.top-J)>F.bottom){n.debug("Fixed element reached bottom of container");n.bindBottom()}else{if(G){n.set.scroll(J)}}}}else{if(n.is.bottom()){if((O.bottom-I.height)<I.top){n.debug("Bottom fixed rail has reached top of container");n.setInitialPosition()}else{if(O.bottom>F.bottom){n.debug("Bottom fixed rail has reached bottom of container");n.bindBottom()}else{if(G){n.set.scroll(J)}}}}}}else{if(n.is.bottom()){if(q.pushing){if(n.is.bound()&&O.bottom<F.bottom){n.debug("Fixing bottom attached element to bottom of browser.");n.fixBottom()}}else{if(n.is.bound()&&(O.top<F.bottom-I.height)){n.debug("Fixing bottom attached element to top of browser.");n.fixTop()}}}}}}n.save.lastScroll(O.top);n.save.elementScroll(J)},bindTop:function(){n.debug("Binding element to top of parent container");n.remove.offset();A.css({left:"",top:"",marginBottom:""}).removeClass(y.fixed).removeClass(y.bottom).addClass(y.bound).addClass(y.top);q.onTop.call(t);q.onUnstick.call(t)},bindBottom:function(){n.debug("Binding element to bottom of parent container");n.remove.offset();A.css({left:"",top:"",marginBottom:n.cache.context.bottomPadding}).removeClass(y.fixed).removeClass(y.top).addClass(y.bound).addClass(y.bottom);q.onBottom.call(t);q.onUnstick.call(t)},setInitialPosition:function(){n.unfix();n.unbind()},fixTop:function(){n.debug("Fixing element to top of page");n.set.minimumSize();n.set.offset();A.css({left:n.cache.element.left,bottom:"",marginBottom:""}).removeClass(y.bound).removeClass(y.bottom).addClass(y.fixed).addClass(y.top);q.onStick.call(t)},fixBottom:function(){n.debug("Sticking element to bottom of page");n.set.minimumSize();n.set.offset();A.css({left:n.cache.element.left,bottom:"",marginBottom:""}).removeClass(y.bound).removeClass(y.top).addClass(y.fixed).addClass(y.bottom);q.onStick.call(t)},unbind:function(){n.debug("Removing absolute position on element");n.remove.offset();A.removeClass(y.bound).removeClass(y.top).removeClass(y.bottom)},unfix:function(){n.debug("Removing fixed position on element");n.remove.offset();A.removeClass(y.fixed).removeClass(y.top).removeClass(y.bottom);q.onUnstick.call(t)},reset:function(){n.debug("Reseting elements position");n.unbind();n.unfix();n.resetCSS();n.remove.offset();n.remove.lastScroll()},resetCSS:function(){A.css({width:"",height:""});C.css({height:""})},setting:function(E,F){if(c.isPlainObject(E)){c.extend(true,q,E)}else{if(F!==d){q[E]=F}else{return q[E]}}},internal:function(E,F){if(c.isPlainObject(E)){c.extend(true,n,E)}else{if(F!==d){n[E]=F}else{return n[E]}}},debug:function(){if(q.debug){if(q.performance){n.performance.log(arguments)}else{n.debug=Function.prototype.bind.call(console.info,console,q.name+":");n.debug.apply(console,arguments)}}},verbose:function(){if(q.verbose&&q.debug){if(q.performance){n.performance.log(arguments)}else{n.verbose=Function.prototype.bind.call(console.info,console,q.name+":");n.verbose.apply(console,arguments)}}},error:function(){n.error=Function.prototype.bind.call(console.error,console,q.name+":");n.error.apply(console,arguments)},performance:{log:function(G){var F,H,E;if(q.performance){F=new Date().getTime();E=f||F;H=F-E;f=F;j.push({Name:G[0],Arguments:[].slice.call(G,1)||"",Element:t,"Execution Time":H})}clearTimeout(n.performance.timer);n.performance.timer=setTimeout(n.performance.display,0)},display:function(){var F=q.name+":",E=0;f=false;clearTimeout(n.performance.timer);c.each(j,function(G,H){E+=H["Execution Time"]});F+=" "+E+"ms";if(h){F+=" '"+h+"'"}if((console.group!==d||console.table!==d)&&j.length>0){console.groupCollapsed(F);if(console.table){console.table(j)}else{c.each(j,function(G,H){console.log(H.Name+": "+H["Execution Time"]+"ms")})}console.groupEnd()}j=[]}},invoke:function(J,F,H){var G=B,K,I,E;F=F||l;H=t||H;if(typeof J=="string"&&G!==d){J=J.split(/[\. ]/);K=J.length-1;c.each(J,function(N,M){var L=(N!=K)?M+J[N+1].charAt(0).toUpperCase()+J[N+1].slice(1):J;if(c.isPlainObject(G[L])&&(N!=K)){G=G[L]}else{if(G[L]!==d){I=G[L];return false}else{if(c.isPlainObject(G[M])&&(N!=K)){G=G[M]}else{if(G[M]!==d){I=G[M];return false}else{return false}}}}})}if(c.isFunction(I)){E=I.apply(H,F)}else{if(I!==d){E=I}}if(c.isArray(g)){g.push(E)}else{if(g!==d){g=[g,E]}else{if(E!==d){g=E}}}return I}};if(e){if(B===d){n.initialize()}n.invoke(i)}else{if(B!==d){B.invoke("destroy")}n.initialize()}});return(g!==d)?g:this};c.fn.sticky.settings={name:"Sticky",namespace:"sticky",debug:false,verbose:true,performance:true,pushing:false,context:false,scrollContext:b,offset:0,bottomOffset:0,jitter:5,observeChanges:false,onReposition:function(){},onScroll:function(){},onStick:function(){},onUnstick:function(){},onTop:function(){},onBottom:function(){},error:{container:"Sticky element must be inside a relative container",visible:"Element is hidden, you must call refresh after element becomes visible",method:"The method you called is not defined.",invalidContext:"Context specified does not exist",elementSize:"Sticky element is larger than its container, cannot create sticky."},className:{bound:"bound",fixed:"fixed",supported:"native",top:"top",bottom:"bottom"}}})(jQuery,window,document);